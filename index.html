<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sayed's Lamp - Wholesale Management System</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #10B981;
      --primary-dark: #059669;
      --primary-light: #34D399;
      --background: #0a0a0a;
      --surface: rgba(255, 255, 255, 0.05);
      --surface-hover: rgba(255, 255, 255, 0.08);
      --glass: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text: #F1F5F9;
      --text-secondary: #94A3B8;
      --border: rgba(255, 255, 255, 0.08);
      --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --sidebar-width: 280px;
    }

    [data-theme="light"] {
      --background: #f8fafc;
      --surface: rgba(255, 255, 255, 0.8);
      --surface-hover: rgba(255, 255, 255, 0.95);
      --glass: rgba(255, 255, 255, 0.7);
      --glass-border: rgba(0, 0, 0, 0.08);
      --text: #1e293b;
      --text-secondary: #64748b;
      --border: rgba(0, 0, 0, 0.08);
      --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    }

    html, body {
      width: 100%;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, var(--background) 0%, var(--background) 100%);
      color: var(--text);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .app-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Glass Effect */
    .glass {
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
    }

    /* Login */
    .login-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, var(--background) 100%);
    }

    .login-box {
      width: 100%;
      max-width: 420px;
      padding: 3rem;
      border-radius: var(--radius);
    }

    .login-logo {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .logo-icon-box {
      width: 72px;
      height: 72px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.25rem;
      box-shadow: 0 12px 32px rgba(16, 185, 129, 0.4);
    }

    .logo-icon-box svg {
      width: 36px;
      height: 36px;
      stroke: white;
      stroke-width: 2;
      fill: none;
    }

    .logo-title {
      font-size: 2rem;
      font-weight: 900;
      color: var(--text);
      letter-spacing: -0.8px;
      margin-bottom: 0.375rem;
    }

    .logo-subtitle {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .form-field {
      margin-bottom: 1.25rem;
    }

    .field-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .field-input, .field-select, .field-textarea {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 0.9375rem;
      background: var(--surface);
      color: var(--text);
      font-family: inherit;
      transition: var(--transition);
    }

    .field-input:focus, .field-select:focus, .field-textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: var(--surface-hover);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
    }

    .field-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .btn {
      width: 100%;
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: 12px;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--surface-hover);
    }

    .btn-sm {
      padding: 0.625rem 1rem;
      font-size: 0.875rem;
      width: auto;
    }

    /* Main Layout */
    .main-container {
      width: 100%;
      height: 100%;
      display: flex;
      overflow: hidden;
      position: relative;
    }

    .sidebar {
      width: var(--sidebar-width);
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      z-index: 100;
      overflow: hidden;
    }

    .sidebar.collapsed {
      width: 0;
      border-right: none;
    }

    .content-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      transition: var(--transition);
      width: calc(100% - var(--sidebar-width));
    }

    .sidebar.collapsed ~ .content-area {
      width: 100%;
    }

    .sidebar-brand {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .brand-content {
      display: flex;
      align-items: center;
      gap: 0.875rem;
    }

    .brand-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .brand-icon svg {
      width: 22px;
      height: 22px;
      stroke: white;
      stroke-width: 2;
      fill: none;
    }

    .brand-text h1 {
      font-size: 1.125rem;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.3px;
      white-space: nowrap;
    }

    .brand-text p {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.125rem;
      white-space: nowrap;
    }

    .sidebar-menu {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .menu-section {
      margin-bottom: 1.5rem;
    }

    .menu-label {
      padding: 0 1rem 0.5rem;
      font-size: 0.6875rem;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      white-space: nowrap;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      margin: 0 0.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition);
      border-radius: 10px;
      font-size: 0.9375rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .menu-item:hover {
      background: var(--surface);
      color: var(--text);
    }

    .menu-item.active {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 100%);
      color: var(--primary-light);
      font-weight: 600;
    }

    .menu-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      stroke-width: 2;
      stroke: currentColor;
      fill: none;
    }

    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid var(--border);
      flex-shrink: 0;
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      padding: 0.75rem;
      background: var(--surface);
      border-radius: 10px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.875rem;
      color: white;
      flex-shrink: 0;
    }

    .user-info {
      flex: 1;
      min-width: 0;
    }

    .user-info h4 {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-info p {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.125rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Header */
    .header-bar {
      padding: 1rem 1.5rem;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.5px;
    }

    .icon-button {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      flex-shrink: 0;
    }

    .icon-button:hover {
      background: var(--surface-hover);
      border-color: var(--primary);
      color: var(--primary-light);
      transform: translateY(-2px);
    }

    .icon {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }

    /* Content */
    .content-main {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      padding: 1.5rem;
      border-radius: var(--radius);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--primary) 0%, transparent 100%);
      opacity: 0;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
    }

    .stat-card:hover::before {
      opacity: 0.05;
    }

    .stat-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }

    .stat-label {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(16, 185, 129, 0.1);
    }

    .stat-icon svg {
      width: 20px;
      height: 20px;
      stroke: var(--primary);
    }

    .stat-value {
      font-size: 1.875rem;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -1px;
      margin-bottom: 0.375rem;
      position: relative;
      z-index: 1;
    }

    .stat-change {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-secondary);
      position: relative;
      z-index: 1;
    }

    /* Module Header */
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .module-title {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.4px;
    }

    .module-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    /* Search */
    .search-section {
      display: flex;
      gap: 0.875rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 240px;
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      width: 18px;
      height: 18px;
      pointer-events: none;
    }

    .search-input {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 3rem;
    }

    /* Table */
    .table-wrapper {
      border-radius: var(--radius);
      overflow: hidden;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table thead {
      background: var(--surface);
    }

    .data-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 700;
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    .data-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      color: var(--text);
      font-size: 0.9375rem;
    }

    .data-table tbody tr {
      transition: var(--transition);
      background: var(--glass);
    }

    .data-table tbody tr:hover {
      background: var(--surface);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.375rem 0.75rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.15);
      color: var(--primary-light);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.15);
      color: #FBBF24;
    }

    .badge-error {
      background: rgba(239, 68, 68, 0.15);
      color: #F87171;
    }

    .action-btns {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .action-btn:hover {
      background: rgba(16, 185, 129, 0.15);
      border-color: var(--primary);
      color: var(--primary-light);
    }

    /* Profile View */
    .profile-view {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 1.5rem;
    }

    .profile-sidebar {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .profile-card {
      padding: 2rem;
      border-radius: var(--radius);
      text-align: center;
    }

    .profile-avatar {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 800;
      color: white;
      margin: 0 auto 1.25rem;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
    }

    .profile-name {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text);
      margin-bottom: 0.375rem;
      letter-spacing: -0.5px;
    }

    .profile-id {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .info-section {
      padding: 1.5rem;
      border-radius: var(--radius);
    }

    .info-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 1rem;
    }

    .info-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.875rem 0;
      border-bottom: 1px solid var(--border);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-icon {
      width: 18px;
      height: 18px;
      color: var(--primary);
      flex-shrink: 0;
      margin-top: 2px;
    }

    .info-content {
      flex: 1;
    }

    .info-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .info-value {
      font-size: 0.9375rem;
      color: var(--text);
      font-weight: 500;
    }

    .profile-main {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .tab-nav {
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--surface);
      border-radius: 12px;
    }

    .tab-btn {
      flex: 1;
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.9375rem;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-family: inherit;
    }

    .tab-btn.active {
      background: var(--primary);
      color: white;
    }

    .tab-content {
      padding: 1.5rem;
      border-radius: var(--radius);
    }

    /* Settings */
    .settings-grid {
      display: grid;
      gap: 1.5rem;
    }

    .settings-section {
      padding: 1.5rem;
      border-radius: var(--radius);
    }

    .settings-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .settings-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: rgba(16, 185, 129, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .settings-icon svg {
      width: 18px;
      height: 18px;
      stroke: var(--primary);
    }

    .settings-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text);
    }

    .settings-desc {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    .logo-upload {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      padding: 1.5rem;
      background: var(--surface);
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    .logo-preview {
      width: 96px;
      height: 96px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .logo-preview svg {
      width: 48px;
      height: 48px;
      stroke: white;
      stroke-width: 2;
      fill: none;
    }

    .logo-info h4 {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .logo-info p {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .file-input {
      display: none;
    }

    .toggle-switch {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--surface);
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    .toggle-label {
      flex: 1;
    }

    .toggle-label h4 {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .toggle-label p {
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    .toggle-input {
      width: 52px;
      height: 28px;
      background: var(--border);
      border-radius: 14px;
      position: relative;
      cursor: pointer;
      transition: var(--transition);
    }

    .toggle-input.active {
      background: var(--primary);
    }

    .toggle-input::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: var(--transition);
    }

    .toggle-input.active::after {
      left: 26px;
    }

    .signature-pad {
      width: 100%;
      height: 200px;
      border: 2px dashed var(--border);
      border-radius: 12px;
      background: var(--surface);
      cursor: crosshair;
      margin-bottom: 1rem;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
    }

    .empty-icon {
      width: 72px;
      height: 72px;
      margin: 0 auto 1.25rem;
      background: var(--surface);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .empty-icon svg {
      width: 36px;
      height: 36px;
      stroke: var(--text-secondary);
      opacity: 0.5;
    }

    .empty-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .empty-text {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.6;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 1000;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-container {
      border-radius: var(--radius);
      max-width: 680px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
      animation: slideUp 0.3s;
    }

    .modal-container.large {
      max-width: 900px;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.3px;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--surface);
      color: var(--text);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      background: var(--surface);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-grid-full {
      grid-column: 1 / -1;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-width: 380px;
    }

    .toast {
      padding: 1rem;
      border-radius: 12px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 0.875rem;
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .toast-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.125rem;
      font-size: 0.9375rem;
    }

    .toast-message {
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    .toast.success {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .toast.error {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .hidden {
      display: none !important;
    }

    /* Dropdown Menu */
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 240px;
      overflow-y: auto;
      background: var(--background);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-top: 0.5rem;
      z-index: 1000;
      box-shadow: var(--shadow);
    }

    .field-wrapper {
      position: relative;
    }

    .dropdown-item {
      padding: 0.875rem 1rem;
      cursor: pointer;
      transition: var(--transition);
      border-bottom: 1px solid var(--border);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: var(--surface);
    }

    .dropdown-item h4 {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .dropdown-item p {
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    /* Purchase Items */
    .purchase-item {
      padding: 1.25rem;
      background: var(--surface);
      border-radius: 12px;
      margin-bottom: 1rem;
      position: relative;
    }

    .purchase-item-remove {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: #F87171;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .purchase-item-remove:hover {
      background: rgba(239, 68, 68, 0.15);
      border-color: #F87171;
    }

    /* Alert Bar */
    .alert-bar {
      padding: 1rem 1.5rem;
      border-radius: var(--radius);
      border-left: 4px solid;
      display: flex;
      align-items: center;
      gap: 0.875rem;
      margin-bottom: 0.75rem;
      animation: slideDown 0.3s;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .alert-bar.warning {
      background: rgba(245, 158, 11, 0.15);
      border-color: #F59E0B;
    }

    .alert-bar.error {
      background: rgba(239, 68, 68, 0.15);
      border-color: #EF4444;
    }

    .alert-bar.info {
      background: rgba(59, 130, 246, 0.15);
      border-color: #3B82F6;
    }

    .alert-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.125rem;
    }

    .alert-message {
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--surface);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--surface-hover);
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .profile-view {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        z-index: 1000;
      }

      .sidebar.collapsed {
        transform: translateX(-100%);
        width: var(--sidebar-width);
      }

      .content-area {
        width: 100%;
      }

      .content-main {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .module-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .search-section {
        flex-direction: column;
      }

      .search-box {
        min-width: 100%;
      }

      .data-table {
        font-size: 0.875rem;
      }

      .data-table th,
      .data-table td {
        padding: 0.75rem 0.5rem;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-wrapper" id="app"><!-- Login -->
   <div class="login-container" id="loginScreen">
    <div class="login-box glass">
     <div class="login-logo">
      <div class="logo-icon-box">
       <svg viewbox="0 0 24 24"><path d="M9 2l-1 3-3 1 3 1 1 3 1-3 3-1-3-1-1-3z"></path> <circle cx="12" cy="17" r="5"></circle>
       </svg>
      </div>
      <h1 class="logo-title" id="appTitle">Sayed's Lamp</h1>
      <p class="logo-subtitle" id="appSubtitle">Wholesale Management System</p>
     </div>
     <form id="loginForm">
      <div class="form-field"><label for="email" class="field-label">Email</label> <input type="email" id="email" class="field-input" placeholder="admin@sayedslamp.com" required>
      </div>
      <div class="form-field"><label for="password" class="field-label">Password</label> <input type="password" id="password" class="field-input" placeholder="Enter password" required>
      </div>
      <div class="form-field"><label for="role" class="field-label">Role</label> <select id="role" class="field-select"> <option value="admin">Administrator</option> <option value="manager">Manager</option> <option value="sales">Sales</option> </select>
      </div><button type="submit" class="btn btn-primary">Sign In</button>
     </form>
    </div>
   </div><!-- Main App -->
   <div class="main-container hidden" id="mainApp"><!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
     <div class="sidebar-brand">
      <div class="brand-content">
       <div class="brand-icon">
        <svg viewbox="0 0 24 24"><path d="M9 2l-1 3-3 1 3 1 1 3 1-3 3-1-3-1-1-3z"></path> <circle cx="12" cy="17" r="5"></circle>
        </svg>
       </div>
       <div class="brand-text">
        <h1 id="brandTitle">Sayed's Lamp</h1>
        <p>Wholesale System</p>
       </div>
      </div>
     </div>
     <nav class="sidebar-menu">
      <div class="menu-section">
       <div class="menu-label">
        Main
       </div>
       <div class="menu-item active" data-page="dashboard">
        <svg class="menu-icon" viewbox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect> <rect x="14" y="3" width="7" height="7"></rect> <rect x="14" y="14" width="7" height="7"></rect> <rect x="3" y="14" width="7" height="7"></rect>
        </svg><span>Dashboard</span>
       </div>
      </div>
      <div class="menu-section">
       <div class="menu-label">
        Inventory
       </div>
       <div class="menu-item" data-page="products">
        <svg class="menu-icon" viewbox="0 0 24 24"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"></path>
        </svg><span>Products</span>
       </div>
       <div class="menu-item" data-page="purchase">
        <svg class="menu-icon" viewbox="0 0 24 24"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path> <circle cx="8.5" cy="7" r="4"></circle> <polyline points="17 11 19 13 23 9"></polyline>
        </svg><span>Purchase Stock</span>
       </div>
       <div class="menu-item" data-page="suppliers">
        <svg class="menu-icon" viewbox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
        </svg><span>Suppliers</span>
       </div>
      </div>
      <div class="menu-section">
       <div class="menu-label">
        Sales
       </div>
       <div class="menu-item" data-page="customers">
        <svg class="menu-icon" viewbox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path> <circle cx="9" cy="7" r="4"></circle>
        </svg><span>Customers</span>
       </div>
       <div class="menu-item" data-page="invoices">
        <svg class="menu-icon" viewbox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path> <polyline points="14 2 14 8 20 8"></polyline>
        </svg><span>Invoices</span>
       </div>
      </div>
      <div class="menu-section">
       <div class="menu-label">
        System
       </div>
       <div class="menu-item" data-page="settings">
        <svg class="menu-icon" viewbox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle> <path d="M12 1v6m0 6v6m-5.2-5.2l-4.2 4.2m10.6-10.6l4.2-4.2m0 14.8l-4.2-4.2M6.8 6.8L2.6 2.6"></path>
        </svg><span>Settings</span>
       </div>
      </div>
     </nav>
     <div class="sidebar-footer">
      <div class="user-card">
       <div class="user-avatar" id="userAvatar">
        A
       </div>
       <div class="user-info">
        <h4 id="userName">Admin</h4>
        <p id="userRole">Administrator</p>
       </div>
      </div><button class="btn btn-secondary btn-sm" id="logoutBtn">Sign Out</button>
     </div>
    </aside><!-- Content Area -->
    <div class="content-area">
     <header class="header-bar">
      <div class="header-left"><button class="icon-button" id="toggleSidebar">
        <svg class="icon" viewbox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line> <line x1="3" y1="6" x2="21" y2="6"></line> <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg></button>
       <h1 class="header-title" id="pageTitle">Dashboard</h1>
      </div>
      <div class="header-right"><button class="icon-button" id="themeToggle">
        <svg class="icon" viewbox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg></button> <button class="icon-button" id="notificationBtn" style="position: relative;">
        <svg class="icon" viewbox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"></path> <path d="M13.73 21a2 2 0 01-3.46 0"></path>
        </svg><span id="notificationBadge" class="hidden" style="position: absolute; top: -4px; right: -4px; width: 18px; height: 18px; background: #EF4444; border-radius: 50%; font-size: 10px; font-weight: 700; color: white; display: flex; align-items: center; justify-content: center;"></span> </button> <button class="icon-button" id="exportBtn">
        <svg class="icon" viewbox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path> <polyline points="7 10 12 15 17 10"></polyline> <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg></button> <button class="icon-button" id="importBtn">
        <svg class="icon" viewbox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path> <polyline points="17 8 12 3 7 8"></polyline> <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg></button>
      </div>
     </header>
     <div class="content-main" id="mainContent"><!-- Dashboard -->
      <div id="dashboardPage">
       <div class="module-header">
        <h2 class="module-title">Dashboard Overview</h2><button class="btn btn-primary btn-sm" id="printDashboardBtn">
         <svg class="icon" viewbox="0 0 24 24"><polyline points="6 9 6 2 18 2 18 9"></polyline> <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"></path> <rect x="6" y="14" width="12" height="8"></rect>
         </svg> Print Report </button>
       </div>
       <div class="stats-grid">
        <div class="stat-card glass">
         <div class="stat-top">
          <div class="stat-label">
           Today's Sales
          </div>
          <div class="stat-icon">
           <svg viewbox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line> <path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"></path>
           </svg>
          </div>
         </div>
         <div class="stat-value" id="statTodaySales">
          ৳0
         </div>
         <div class="stat-change" id="statTodayProfit">
          Profit: ৳0
         </div>
        </div>
        <div class="stat-card glass">
         <div class="stat-top">
          <div class="stat-label">
           This Month
          </div>
          <div class="stat-icon">
           <svg viewbox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect> <line x1="16" y1="2" x2="16" y2="6"></line> <line x1="8" y1="2" x2="8" y2="6"></line> <line x1="3" y1="10" x2="21" y2="10"></line>
           </svg>
          </div>
         </div>
         <div class="stat-value" id="statMonthSales">
          ৳0
         </div>
         <div class="stat-change" id="statMonthProfit">
          Profit: ৳0
         </div>
        </div>
        <div class="stat-card glass">
         <div class="stat-top">
          <div class="stat-label">
           This Year
          </div>
          <div class="stat-icon">
           <svg viewbox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
           </svg>
          </div>
         </div>
         <div class="stat-value" id="statYearSales">
          ৳0
         </div>
         <div class="stat-change" id="statYearProfit">
          Profit: ৳0
         </div>
        </div>
        <div class="stat-card glass">
         <div class="stat-top">
          <div class="stat-label">
           Stock Value
          </div>
          <div class="stat-icon">
           <svg viewbox="0 0 24 24"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"></path>
           </svg>
          </div>
         </div>
         <div class="stat-value" id="statValue">
          ৳0
         </div>
         <div class="stat-change" id="statProducts">
          0 Products
         </div>
        </div>
       </div>
       <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
        <div class="glass" style="padding: 1.5rem; border-radius: var(--radius);">
         <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--text); margin-bottom: 1.5rem;">Monthly Sales Trend</h3>
         <canvas id="salesChart" style="max-height: 300px;"></canvas>
        </div>
        <div class="glass" style="padding: 1.5rem; border-radius: var(--radius);">
         <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--text); margin-bottom: 1.5rem;">Quick Stats</h3>
         <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div style="padding: 1rem; background: var(--surface); border-radius: 10px;">
           <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
            Total Customers
           </div>
           <div style="font-size: 1.5rem; font-weight: 800; color: var(--text);" id="statCustomers">
            0
           </div>
          </div>
          <div style="padding: 1rem; background: var(--surface); border-radius: 10px;">
           <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
            Total Suppliers
           </div>
           <div style="font-size: 1.5rem; font-weight: 800; color: var(--text);" id="statSuppliers">
            0
           </div>
          </div>
          <div style="padding: 1rem; background: var(--surface); border-radius: 10px;">
           <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
            Total Invoices
           </div>
           <div style="font-size: 1.5rem; font-weight: 800; color: var(--text);" id="statInvoices">
            0
           </div>
          </div>
          <div style="padding: 1rem; background: var(--surface); border-radius: 10px;">
           <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
            Total Due
           </div>
           <div style="font-size: 1.5rem; font-weight: 800; color: #F59E0B;" id="statDue">
            ৳0
           </div>
          </div>
         </div>
        </div>
       </div>
      </div><!-- Products -->
      <div id="productsPage" class="hidden">
       <div class="module-header">
        <h2 class="module-title">Products</h2>
        <div class="module-actions"><button class="btn btn-secondary btn-sm" id="bulkProductBtn">
          <svg class="icon" viewbox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path> <polyline points="17 8 12 3 7 8"></polyline> <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg> Bulk Import </button> <button class="btn btn-primary btn-sm" id="addProductBtn">
          <svg class="icon" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg> Add Product </button>
        </div>
       </div>
       <div class="search-section">
        <div class="search-box">
         <svg class="search-icon icon" viewbox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle> <path d="M21 21l-4.35-4.35"></path>
         </svg><input type="text" class="search-input field-input" id="productSearch" placeholder="Search products...">
        </div>
       </div>
       <div class="table-wrapper glass">
        <table class="data-table">
         <thead>
          <tr>
           <th>ID</th>
           <th>Name</th>
           <th>Category</th>
           <th>Stock</th>
           <th>Price</th>
           <th>Status</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="productsTable">
          <tr>
           <td colspan="7">
            <div class="empty-state">
             <div class="empty-icon">
              <svg viewbox="0 0 24 24"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"></path>
              </svg>
             </div>
             <div class="empty-title">
              No Products
             </div>
             <div class="empty-text">
              Add your first product to start managing inventory
             </div><button class="btn btn-primary btn-sm" onclick="document.getElementById('addProductBtn').click()">
              <svg class="icon" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg> Add Product </button>
            </div></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div><!-- Purchase List -->
      <div id="purchasePage" class="hidden">
       <div class="module-header">
        <h2 class="module-title">Purchase History</h2><button class="btn btn-primary btn-sm" id="newPurchaseBtn">
         <svg class="icon" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg> New Purchase </button>
       </div>
       <div class="table-wrapper glass">
        <table class="data-table">
         <thead>
          <tr>
           <th>ID</th>
           <th>Supplier</th>
           <th>Date</th>
           <th>Items</th>
           <th>Total</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="purchasesTable">
          <tr>
           <td colspan="6">
            <div class="empty-state">
             <div class="empty-icon">
              <svg viewbox="0 0 24 24"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path> <circle cx="8.5" cy="7" r="4"></circle> <polyline points="17 11 19 13 23 9"></polyline>
              </svg>
             </div>
             <div class="empty-title">
              No Purchases
             </div>
             <div class="empty-text">
              Start purchasing stock from suppliers
             </div><button class="btn btn-primary btn-sm" onclick="document.getElementById('newPurchaseBtn').click()">New Purchase</button>
            </div></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div><!-- Suppliers -->
      <div id="suppliersPage" class="hidden">
       <div class="module-header">
        <h2 class="module-title">Suppliers</h2><button class="btn btn-primary btn-sm" id="addSupplierBtn">
         <svg class="icon" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg> Add Supplier </button>
       </div>
       <div class="table-wrapper glass">
        <table class="data-table">
         <thead>
          <tr>
           <th>ID</th>
           <th>Name</th>
           <th>Contact</th>
           <th>Email</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="suppliersTable">
          <tr>
           <td colspan="5">
            <div class="empty-state">
             <div class="empty-icon">
              <svg viewbox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
              </svg>
             </div>
             <div class="empty-title">
              No Suppliers
             </div>
             <div class="empty-text">
              Add suppliers to manage purchase orders
             </div><button class="btn btn-primary btn-sm" onclick="document.getElementById('addSupplierBtn').click()">Add Supplier</button>
            </div></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div><!-- Customers -->
      <div id="customersPage" class="hidden">
       <div class="module-header">
        <h2 class="module-title">Customers</h2><button class="btn btn-primary btn-sm" id="addCustomerBtn">
         <svg class="icon" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg> Add Customer </button>
       </div>
       <div class="table-wrapper glass">
        <table class="data-table">
         <thead>
          <tr>
           <th>ID</th>
           <th>Name</th>
           <th>Contact</th>
           <th>Email</th>
           <th>Due</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="customersTable">
          <tr>
           <td colspan="6">
            <div class="empty-state">
             <div class="empty-icon">
              <svg viewbox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path> <circle cx="9" cy="7" r="4"></circle>
              </svg>
             </div>
             <div class="empty-title">
              No Customers
             </div>
             <div class="empty-text">
              Add customers to create invoices
             </div><button class="btn btn-primary btn-sm" onclick="document.getElementById('addCustomerBtn').click()">Add Customer</button>
            </div></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div><!-- Invoices -->
      <div id="invoicesPage" class="hidden">
       <div class="module-header">
        <h2 class="module-title">Invoices</h2><button class="btn btn-primary btn-sm" id="createInvoiceBtn">
         <svg class="icon" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
         </svg> Create Invoice </button>
       </div>
       <div class="table-wrapper glass">
        <table class="data-table">
         <thead>
          <tr>
           <th>ID</th>
           <th>Customer</th>
           <th>Date</th>
           <th>Amount</th>
           <th>Status</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="invoicesTable">
          <tr>
           <td colspan="6">
            <div class="empty-state">
             <div class="empty-icon">
              <svg viewbox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path> <polyline points="14 2 14 8 20 8"></polyline>
              </svg>
             </div>
             <div class="empty-title">
              No Invoices
             </div>
             <div class="empty-text">
              Create invoices to track sales
             </div><button class="btn btn-primary btn-sm" onclick="document.getElementById('createInvoiceBtn').click()">Create Invoice</button>
            </div></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div><!-- Settings -->
      <div id="settingsPage" class="hidden">
       <div class="settings-grid"><!-- Company Settings -->
        <div class="settings-section glass">
         <div class="settings-header">
          <div class="settings-icon">
           <svg viewbox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
           </svg>
          </div>
          <div>
           <h3 class="settings-title">Company Information</h3>
           <p class="settings-desc">Manage your business details and branding</p>
          </div>
         </div>
         <div class="logo-upload">
          <div class="logo-preview">
           <svg viewbox="0 0 24 24"><path d="M9 2l-1 3-3 1 3 1 1 3 1-3 3-1-3-1-1-3z"></path> <circle cx="12" cy="17" r="5"></circle>
           </svg>
          </div>
          <div class="logo-info">
           <h4>Company Logo</h4>
           <p>Upload your logo (PNG, JPG up to 2MB)</p><label for="logoUpload" class="btn btn-secondary btn-sm">
            <svg class="icon" viewbox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path> <polyline points="17 8 12 3 7 8"></polyline> <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> Upload Logo </label> <input type="file" id="logoUpload" class="file-input" accept="image/*">
          </div>
         </div>
         <div class="form-grid">
          <div class="form-field form-grid-full"><label class="field-label">Company Name</label> <input type="text" class="field-input" id="settingsCompanyName" placeholder="Sayed's Lamp">
          </div>
          <div class="form-field form-grid-full"><label class="field-label">Tagline</label> <input type="text" class="field-input" id="settingsTagline" placeholder="Wholesale Management System">
          </div>
          <div class="form-field"><label class="field-label">Email</label> <input type="email" class="field-input" id="settingsEmail" placeholder="info@sayedslamp.com">
          </div>
          <div class="form-field"><label class="field-label">Phone</label> <input type="tel" class="field-input" id="settingsPhone" placeholder="+880 1234 567890">
          </div>
          <div class="form-field form-grid-full"><label class="field-label">Address</label> <input type="text" class="field-input" id="settingsAddress" placeholder="123 Business Street, Dhaka">
          </div>
         </div>
        </div><!-- Appearance Settings -->
        <div class="settings-section glass">
         <div class="settings-header">
          <div class="settings-icon">
           <svg viewbox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line>
           </svg>
          </div>
          <div>
           <h3 class="settings-title">Appearance</h3>
           <p class="settings-desc">Customize how the app looks</p>
          </div>
         </div>
         <div class="toggle-switch">
          <div class="toggle-label">
           <h4>Dark Mode</h4>
           <p>Use dark theme for better visibility in low light</p>
          </div>
          <div class="toggle-input active" id="darkModeToggle"></div>
         </div>
        </div><!-- Signature Settings -->
        <div class="settings-section glass">
         <div class="settings-header">
          <div class="settings-icon">
           <svg viewbox="0 0 24 24"><path d="M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
           </svg>
          </div>
          <div>
           <h3 class="settings-title">Digital Signature</h3>
           <p class="settings-desc">Add your signature for invoices</p>
          </div>
         </div>
         <canvas class="signature-pad" id="signaturePad"></canvas>
         <div style="display: flex; gap: 0.75rem;"><button class="btn btn-secondary btn-sm" id="clearSignature">Clear</button> <button class="btn btn-primary btn-sm" id="saveSignature">Save Signature</button>
         </div>
        </div><!-- Data Management -->
        <div class="settings-section glass">
         <div class="settings-header">
          <div class="settings-icon">
           <svg viewbox="0 0 24 24"><path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"></path> <polyline points="13 2 13 9 20 9"></polyline>
           </svg>
          </div>
          <div>
           <h3 class="settings-title">Data Management</h3>
           <p class="settings-desc">Export and import your data</p>
          </div>
         </div>
         <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;"><button class="btn btn-primary btn-sm" id="exportDataBtn">
           <svg class="icon" viewbox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path> <polyline points="7 10 12 15 17 10"></polyline> <line x1="12" y1="15" x2="12" y2="3"></line>
           </svg> Export Data (JSON) </button> <label for="importDataFile" class="btn btn-secondary btn-sm">
           <svg class="icon" viewbox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path> <polyline points="17 8 12 3 7 8"></polyline> <line x1="12" y1="3" x2="12" y2="15"></line>
           </svg> Import Data (JSON) </label> <input type="file" id="importDataFile" class="file-input" accept=".json">
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Toast Container -->
   <div class="toast-container" id="toastContainer"></div>
  </div><!-- Product Modal -->
  <div class="modal-backdrop hidden" id="productModal">
   <div class="modal-container glass">
    <div class="modal-header">
     <h2 class="modal-title">Add Product</h2><button class="modal-close" onclick="closeModal('productModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <form id="productForm">
     <div class="modal-body">
      <div class="form-grid">
       <div class="form-field form-grid-full"><label class="field-label">Product Name</label> <input type="text" class="field-input" id="productName" required>
       </div>
       <div class="form-field"><label class="field-label">Category</label> <input type="text" class="field-input" id="productCategory" required>
       </div>
       <div class="form-field"><label class="field-label">Stock</label> <input type="number" class="field-input" id="productStock" min="0" value="0" required>
       </div>
       <div class="form-field"><label class="field-label">Buying Price (৳)</label> <input type="number" class="field-input" id="productBuyPrice" step="0.01" min="0" required>
       </div>
       <div class="form-field"><label class="field-label">Selling Price (৳)</label> <input type="number" class="field-input" id="productSellPrice" step="0.01" min="0" required>
       </div>
      </div>
     </div>
     <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('productModal')">Cancel</button> <button type="submit" class="btn btn-primary btn-sm">Save Product</button>
     </div>
    </form>
   </div>
  </div><!-- Supplier Modal -->
  <div class="modal-backdrop hidden" id="supplierModal">
   <div class="modal-container glass large">
    <div class="modal-header">
     <h2 class="modal-title">Add Supplier</h2><button class="modal-close" onclick="closeModal('supplierModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <form id="supplierForm">
     <div class="modal-body">
      <div class="form-grid">
       <div class="form-field"><label class="field-label">Company Name</label> <input type="text" class="field-input" id="supplierName" required>
       </div>
       <div class="form-field"><label class="field-label">Contact Person</label> <input type="text" class="field-input" id="supplierContactPerson" required>
       </div>
       <div class="form-field"><label class="field-label">Phone</label> <input type="tel" class="field-input" id="supplierContact" required>
       </div>
       <div class="form-field"><label class="field-label">Email</label> <input type="email" class="field-input" id="supplierEmail" required>
       </div>
       <div class="form-field form-grid-full"><label class="field-label">Address</label> <input type="text" class="field-input" id="supplierAddress">
       </div>
       <div class="form-field"><label class="field-label">City</label> <input type="text" class="field-input" id="supplierCity">
       </div>
       <div class="form-field"><label class="field-label">Country</label> <input type="text" class="field-input" id="supplierCountry" value="Bangladesh">
       </div>
       <div class="form-field form-grid-full"><label class="field-label">Notes</label> <textarea class="field-textarea" id="supplierNotes" rows="3"></textarea>
       </div>
      </div>
     </div>
     <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('supplierModal')">Cancel</button> <button type="submit" class="btn btn-primary btn-sm">Save Supplier</button>
     </div>
    </form>
   </div>
  </div><!-- Customer Modal -->
  <div class="modal-backdrop hidden" id="customerModal">
   <div class="modal-container glass large">
    <div class="modal-header">
     <h2 class="modal-title">Add Customer</h2><button class="modal-close" onclick="closeModal('customerModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <form id="customerForm">
     <div class="modal-body">
      <div class="form-grid">
       <div class="form-field"><label class="field-label">Full Name</label> <input type="text" class="field-input" id="customerName" required>
       </div>
       <div class="form-field"><label class="field-label">Business Name</label> <input type="text" class="field-input" id="customerBusiness">
       </div>
       <div class="form-field"><label class="field-label">Phone</label> <input type="tel" class="field-input" id="customerContact" required>
       </div>
       <div class="form-field"><label class="field-label">Email</label> <input type="email" class="field-input" id="customerEmail" required>
       </div>
       <div class="form-field form-grid-full"><label class="field-label">Address</label> <input type="text" class="field-input" id="customerAddress">
       </div>
       <div class="form-field"><label class="field-label">City</label> <input type="text" class="field-input" id="customerCity">
       </div>
       <div class="form-field"><label class="field-label">Credit Limit (৳)</label> <input type="number" class="field-input" id="customerCreditLimit" value="0" min="0">
       </div>
       <div class="form-field form-grid-full"><label class="field-label">Notes</label> <textarea class="field-textarea" id="customerNotes" rows="3"></textarea>
       </div>
      </div>
     </div>
     <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('customerModal')">Cancel</button> <button type="submit" class="btn btn-primary btn-sm">Save Customer</button>
     </div>
    </form>
   </div>
  </div><!-- Purchase Entry Modal -->
  <div class="modal-backdrop hidden" id="purchaseEntryModal">
   <div class="modal-container glass large">
    <div class="modal-header">
     <h2 class="modal-title">New Purchase Entry</h2><button class="modal-close" onclick="closeModal('purchaseEntryModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <div class="modal-body">
     <div class="form-grid">
      <div class="form-field"><label class="field-label">Purchase Date</label> <input type="date" class="field-input" id="modalPurchaseDate" required>
      </div>
      <div class="form-field field-wrapper"><label class="field-label">Supplier</label> <input type="text" class="field-input" id="modalSupplierSearch" placeholder="Search supplier..." autocomplete="off">
       <div id="modalSupplierDropdown" class="dropdown-menu hidden"></div><input type="hidden" id="modalSelectedSupplierId">
      </div>
     </div>
     <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
       <h3 style="font-size: 1rem; font-weight: 700; color: var(--text);">Products</h3><span id="modalItemCount" style="font-size: 0.875rem; color: var(--text-secondary);">0 items</span>
      </div>
      <div class="form-grid">
       <div class="form-field form-grid-full field-wrapper"><label class="field-label">Product</label> <input type="text" class="field-input" id="modalProductSearch" placeholder="Search product and press Enter..." autocomplete="off">
        <div id="modalProductDropdown" class="dropdown-menu hidden"></div>
       </div>
       <div class="form-field"><label class="field-label">Quantity</label> <input type="number" class="field-input" id="modalQuantity" min="1" value="1">
       </div>
       <div class="form-field"><label class="field-label">Purchase Price (৳)</label> <input type="number" class="field-input" id="modalPurchasePrice" step="0.01" min="0">
       </div>
       <div class="form-field"><label class="field-label">MFG Date</label> <input type="date" class="field-input" id="modalMfgDate">
       </div>
       <div class="form-field"><label class="field-label">Expiry Date</label> <input type="date" class="field-input" id="modalExpDate">
       </div>
      </div>
      <div id="modalPurchaseItemsList" style="margin-top: 1.5rem; max-height: 300px; overflow-y: auto;"></div>
     </div>
    </div>
    <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('purchaseEntryModal')">Cancel</button> <button type="button" class="btn btn-primary btn-sm" id="savePurchaseEntryBtn">
      <svg class="icon" viewbox="0 0 24 24"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
      </svg> Save Purchase </button>
    </div>
   </div>
  </div><!-- Notification Modal -->
  <div class="modal-backdrop hidden" id="notificationModal">
   <div class="modal-container glass">
    <div class="modal-header">
     <h2 class="modal-title">Notifications</h2><button class="modal-close" onclick="closeModal('notificationModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <div class="modal-body" id="notificationList" style="max-height: 60%; overflow-y: auto;">
     <div class="empty-state">
      <div class="empty-title">
       No Notifications
      </div>
      <div class="empty-text">
       You're all caught up!
      </div>
     </div>
    </div>
   </div>
  </div><!-- Invoice Modal -->
  <div class="modal-backdrop hidden" id="invoiceModal">
   <div class="modal-container glass">
    <div class="modal-header">
     <h2 class="modal-title">Create Invoice</h2><button class="modal-close" onclick="closeModal('invoiceModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <form id="invoiceForm">
     <div class="modal-body">
      <div class="form-grid">
       <div class="form-field form-grid-full"><label class="field-label">Customer</label> <select class="field-select" id="invoiceCustomer" required> <option value="">Select customer...</option> </select>
       </div>
       <div class="form-field form-grid-full"><label class="field-label">Product</label> <select class="field-select" id="invoiceProduct" required> <option value="">Select product...</option> </select>
       </div>
       <div class="form-field"><label class="field-label">Quantity</label> <input type="number" class="field-input" id="invoiceQty" min="1" value="1" required>
       </div>
       <div class="form-field"><label class="field-label">Price (৳)</label> <input type="number" class="field-input" id="invoicePrice" step="0.01" required placeholder="Enter selling price">
       </div>
      </div>
     </div>
     <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('invoiceModal')">Cancel</button> <button type="submit" class="btn btn-primary btn-sm">Create Invoice</button>
     </div>
    </form>
   </div>
  </div><!-- Bulk Product Import Modal -->
  <div class="modal-backdrop hidden" id="bulkProductModal">
   <div class="modal-container glass large">
    <div class="modal-header">
     <h2 class="modal-title">Bulk Import Products</h2><button class="modal-close" onclick="closeModal('bulkProductModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <div class="modal-body">
     <div style="padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.3); margin-bottom: 1.5rem;">
      <h4 style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text);">Format Instructions</h4>
      <p style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.6;">Enter one product per line in format:<br><strong>PRODUCT NAME - CATEGORY - STOCK - BUYING PRICE</strong><br>
        Example: LED Bulb 9W - Bulbs - 100 - 45<br><em>Note: If buying price is not provided, it will use the previous stock's buying price (if available).</em></p>
     </div>
     <div class="form-field"><label class="field-label">Paste Product Data</label> <textarea class="field-textarea" id="bulkProductData" rows="12" placeholder="LED Bulb 9W - Bulbs - 100 - 45
Tube Light 20W - Tubes - 50 - 120
Smart Bulb RGB - Smart - 30 - 350"></textarea>
     </div>
    </div>
    <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('bulkProductModal')">Cancel</button> <button type="button" class="btn btn-primary btn-sm" id="saveBulkProductBtn">
      <svg class="icon" viewbox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline>
      </svg> Import Products </button>
    </div>
   </div>
  </div><!-- Detail View Modal -->
  <div class="modal-backdrop hidden" id="detailViewModal">
   <div class="modal-container glass large" style="max-width: 1000px;">
    <div class="modal-header">
     <h2 class="modal-title" id="detailViewTitle">Details</h2><button class="modal-close" onclick="closeModal('detailViewModal')">
      <svg class="icon" viewbox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg></button>
    </div>
    <div class="modal-body" id="detailViewContent" style="max-height: 70%; overflow-y: auto;">
    </div>
    <div class="modal-footer"><button type="button" class="btn btn-secondary btn-sm" onclick="closeModal('detailViewModal')">Close</button> <button type="button" class="btn btn-secondary btn-sm" id="detailEditBtn">
      <svg class="icon" viewbox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"></path> <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg> Edit </button> <button type="button" class="btn btn-secondary btn-sm" id="detailDeleteBtn">
      <svg class="icon" viewbox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
      </svg> Delete </button> <button type="button" class="btn btn-primary btn-sm" id="detailPrintBtn">
      <svg class="icon" viewbox="0 0 24 24"><polyline points="6 9 6 2 18 2 18 9"></polyline> <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"></path> <rect x="6" y="14" width="12" height="8"></rect>
      </svg> Print </button>
    </div>
   </div>
  </div>
  <script>
    // Config
    const defaultConfig = {
      company_name: "Sayed's Lamp",
      company_tagline: "Wholesale Management System",
      primary_color: "#10B981",
      text_color: "#F1F5F9"
    };

    // State
    let userData = null;
    let allData = [];
    let idCounters = {
      product: 0,
      customer: 0,
      supplier: 0,
      invoice: 0,
      purchase: 0,
      batch: 0
    };
    let deletedIds = {
      product: [],
      customer: [],
      supplier: [],
      invoice: [],
      purchase: [],
      batch: []
    };
    let companySettings = {
      name: "Sayed's Lamp",
      tagline: "Wholesale Management System",
      email: "info@sayedslamp.com",
      phone: "+880 1234 567890",
      address: "123 Business Street, Dhaka",
      signature: null
    };

    // ID Generation with No Reuse of Deleted IDs
    function generateId(type) {
      idCounters[type]++;
      const prefixes = {
        product: 'PD',
        customer: 'CUS',
        supplier: 'SUP',
        invoice: 'INV',
        purchase: 'PUR',
        batch: 'BATCH'
      };
      return `${prefixes[type]}${String(idCounters[type]).padStart(3, '0')}`;
    }

    function markIdAsDeleted(type, id) {
      if (!deletedIds[type].includes(id)) {
        deletedIds[type].push(id);
        saveData();
      }
    }

    // LocalStorage
    function saveData() {
      try {
        localStorage.setItem('sayedslamp_data', JSON.stringify(allData));
        localStorage.setItem('sayedslamp_counters', JSON.stringify(idCounters));
        localStorage.setItem('sayedslamp_deleted_ids', JSON.stringify(deletedIds));
        localStorage.setItem('sayedslamp_settings', JSON.stringify(companySettings));
      } catch (e) {
        console.error('Save error:', e);
      }
    }

    function loadData() {
      try {
        const data = localStorage.getItem('sayedslamp_data');
        const counters = localStorage.getItem('sayedslamp_counters');
        const deleted = localStorage.getItem('sayedslamp_deleted_ids');
        const settings = localStorage.getItem('sayedslamp_settings');
        if (data) allData = JSON.parse(data);
        if (counters) idCounters = JSON.parse(counters);
        if (deleted) deletedIds = JSON.parse(deleted);
        if (settings) companySettings = JSON.parse(settings);
      } catch (e) {
        console.error('Load error:', e);
      }
    }

    // Stock Batch Management
    function getProductBatches(productId) {
      return allData
        .filter(item => item.type === 'batch' && JSON.parse(item.data).productId === productId)
        .map(item => JSON.parse(item.data))
        .sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));
    }

    function getTotalStock(productId) {
      const batches = getProductBatches(productId);
      return batches.reduce((sum, batch) => sum + batch.quantity, 0);
    }

    function deductStock(productId, quantity) {
      const batches = getProductBatches(productId).sort((a, b) => 
        new Date(a.expiryDate) - new Date(b.expiryDate)
      );

      let remaining = quantity;
      const updates = [];

      for (const batch of batches) {
        if (remaining <= 0) break;
        
        const batchRecord = allData.find(item => 
          item.type === 'batch' && JSON.parse(item.data).id === batch.id
        );

        if (batchRecord) {
          const batchData = JSON.parse(batchRecord.data);
          const deduct = Math.min(batchData.quantity, remaining);
          batchData.quantity -= deduct;
          remaining -= deduct;
          batchRecord.data = JSON.stringify(batchData);
          updates.push(batchRecord);
        }
      }

      return { success: remaining === 0, updates };
    }

    // Alert System
    let notifications = [];

    function checkAlerts() {
      notifications = [];
      const now = new Date();
      const oneYear = 365 * 24 * 60 * 60 * 1000;
      const oneAndHalfYears = 1.5 * oneYear;

      // Check expiring products
      allData.filter(item => item.type === 'batch').forEach(item => {
        const batch = JSON.parse(item.data);
        if (batch.quantity > 0) {
          const expiryDate = new Date(batch.expiryDate);
          const timeToExpiry = expiryDate - now;

          if (timeToExpiry < oneYear && timeToExpiry > 0) {
            notifications.push({
              type: 'error',
              title: 'Product Expiring Soon',
              message: `${batch.productName} (Batch: ${batch.id}) expires on ${expiryDate.toLocaleDateString()} - ${batch.quantity} units`,
              date: now.toISOString()
            });
          } else if (timeToExpiry < oneAndHalfYears && timeToExpiry > 0) {
            notifications.push({
              type: 'warning',
              title: 'Product Expiring',
              message: `${batch.productName} (Batch: ${batch.id}) expires on ${expiryDate.toLocaleDateString()} - ${batch.quantity} units`,
              date: now.toISOString()
            });
          } else if (timeToExpiry < 0) {
            notifications.push({
              type: 'error',
              title: 'Expired Product',
              message: `${batch.productName} (Batch: ${batch.id}) expired on ${expiryDate.toLocaleDateString()} - ${batch.quantity} units remaining`,
              date: now.toISOString()
            });
          }
        }
      });

      // Check low stock
      const products = allData.filter(item => item.type === 'product');
      products.forEach(item => {
        const product = JSON.parse(item.data);
        const totalStock = getTotalStock(product.id);
        if (totalStock < 10 && totalStock > 0) {
          notifications.push({
            type: 'warning',
            title: 'Low Stock Alert',
            message: `${product.name} has only ${totalStock} units remaining`,
            date: now.toISOString()
          });
        } else if (totalStock === 0) {
          notifications.push({
            type: 'error',
            title: 'Out of Stock',
            message: `${product.name} is out of stock`,
            date: now.toISOString()
          });
        }
      });

      // Check inactive customers
      const customers = allData.filter(item => item.type === 'customer');
      const invoices = allData.filter(item => item.type === 'invoice');
      
      customers.forEach(item => {
        const customer = JSON.parse(item.data);
        const customerInvoices = invoices.filter(inv => {
          const invData = JSON.parse(inv.data);
          return invData.customerId === customer.id;
        });

        if (customerInvoices.length > 0) {
          const lastInvoice = customerInvoices.sort((a, b) => 
            new Date(JSON.parse(b.data).date) - new Date(JSON.parse(a.data).date)
          )[0];
          const lastInvoiceDate = new Date(JSON.parse(lastInvoice.data).date);
          const daysSinceLastOrder = (now - lastInvoiceDate) / (24 * 60 * 60 * 1000);

          if (daysSinceLastOrder > 30) {
            notifications.push({
              type: 'info',
              title: 'Inactive Customer',
              message: `${customer.name} hasn't ordered in ${Math.floor(daysSinceLastOrder)} days`,
              date: now.toISOString()
            });
          }
        }
      });

      // Check products not sold in long time
      products.forEach(item => {
        const product = JSON.parse(item.data);
        const productInvoices = invoices.filter(inv => {
          const invData = JSON.parse(inv.data);
          return invData.productId === product.id;
        });

        if (productInvoices.length > 0) {
          const lastSale = productInvoices.sort((a, b) => 
            new Date(JSON.parse(b.data).date) - new Date(JSON.parse(a.data).date)
          )[0];
          const lastSaleDate = new Date(JSON.parse(lastSale.data).date);
          const daysSinceLastSale = (now - lastSaleDate) / (24 * 60 * 60 * 1000);

          if (daysSinceLastSale > 60) {
            notifications.push({
              type: 'info',
              title: 'Slow Moving Product',
              message: `${product.name} hasn't sold in ${Math.floor(daysSinceLastSale)} days`,
              date: now.toISOString()
            });
          }
        }
      });

      updateNotificationBadge();
    }

    function updateNotificationBadge() {
      const badge = document.getElementById('notificationBadge');
      if (notifications.length > 0) {
        badge.textContent = notifications.length;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
    }

    document.getElementById('notificationBtn').addEventListener('click', () => {
      showNotifications();
    });

    function showNotifications() {
      const modal = document.getElementById('notificationModal');
      const list = document.getElementById('notificationList');

      if (notifications.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="empty-title">No Notifications</div>
            <div class="empty-text">You're all caught up!</div>
          </div>
        `;
      } else {
        list.innerHTML = notifications.map(notif => `
          <div class="alert-bar ${notif.type} glass" style="margin-bottom: 0.75rem;">
            <svg class="alert-icon icon" viewBox="0 0 24 24">
              ${notif.type === 'error' ? '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>' :
                notif.type === 'warning' ? '<path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line>' :
                '<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line>'}
            </svg>
            <div class="alert-content">
              <div class="alert-title">${notif.title}</div>
              <div class="alert-message">${notif.message}</div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">${new Date(notif.date).toLocaleString()}</div>
            </div>
          </div>
        `).join('');
      }

      modal.classList.remove('hidden');
    }

    // Element SDK
    async function onConfigChange(config) {
      document.documentElement.style.setProperty('--primary', config.primary_color || defaultConfig.primary_color);
      document.documentElement.style.setProperty('--text', config.text_color || defaultConfig.text_color);
      
      const name = config.company_name || defaultConfig.company_name;
      document.getElementById('appTitle').textContent = name;
      document.getElementById('brandTitle').textContent = name;
      document.getElementById('appSubtitle').textContent = config.company_tagline || defaultConfig.company_tagline;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['company_name', config.company_name || defaultConfig.company_name],
          ['company_tagline', config.company_tagline || defaultConfig.company_tagline]
        ])
      });
    }

    // Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        saveData();
        updateViews();
      }
    };

    if (window.dataSdk) {
      window.dataSdk.init(dataHandler).then(result => {
        if (!result.isOk) {
          loadData();
          updateViews();
        }
      });
    } else {
      loadData();
      updateViews();
    }

    // Theme Toggle
    let isDarkMode = localStorage.getItem('theme') !== 'light';
    
    function updateTheme() {
      if (isDarkMode) {
        document.documentElement.removeAttribute('data-theme');
        document.getElementById('darkModeToggle').classList.add('active');
      } else {
        document.documentElement.setAttribute('data-theme', 'light');
        document.getElementById('darkModeToggle').classList.remove('active');
      }
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    }

    document.getElementById('themeToggle').addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      updateTheme();
    });

    document.getElementById('darkModeToggle').addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      updateTheme();
    });

    updateTheme();

    // Auth
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const role = document.getElementById('role').value;
      
      userData = {
        email,
        role,
        name: email.split('@')[0],
        avatar: email.charAt(0).toUpperCase()
      };

      document.getElementById('userName').textContent = userData.name;
      document.getElementById('userRole').textContent = role.charAt(0).toUpperCase() + role.slice(1);
      document.getElementById('userAvatar').textContent = userData.avatar;
      
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      
      loadSettingsForm();
      updateViews();
      showToast('Welcome', `Signed in as ${userData.name}`, 'success');
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      userData = null;
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('mainApp').classList.add('hidden');
      showToast('Signed Out', 'Successfully signed out', 'success');
    });

    // Navigation
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', () => {
        const page = item.dataset.page;
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        document.querySelectorAll('[id$="Page"]').forEach(p => p.classList.add('hidden'));
        document.getElementById(page + 'Page').classList.remove('hidden');
        
        const titles = {
          dashboard: 'Dashboard',
          products: 'Products',
          purchase: 'Purchase Stock Entry',
          suppliers: 'Suppliers',
          customers: 'Customers',
          invoices: 'Invoices',
          settings: 'Settings'
        };
        document.getElementById('pageTitle').textContent = titles[page];
      });
    });

    // Sidebar Toggle
    document.getElementById('toggleSidebar').addEventListener('click', () => {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('collapsed');
      localStorage.setItem('sidebar_collapsed', sidebar.classList.contains('collapsed'));
    });

    // Load sidebar state
    if (localStorage.getItem('sidebar_collapsed') === 'true') {
      document.getElementById('sidebar').classList.add('collapsed');
    }

    // Export Data
    document.getElementById('exportBtn').addEventListener('click', exportData);
    document.getElementById('exportDataBtn').addEventListener('click', exportData);

    function exportData() {
      const exportObj = {
        version: '1.0',
        timestamp: new Date().toISOString(),
        data: allData,
        counters: idCounters,
        settings: companySettings
      };
      
      const blob = new Blob([JSON.stringify(exportObj, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `sayedslamp-export-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('Export Complete', 'Data exported successfully', 'success');
    }

    // Import Data
    document.getElementById('importBtn').addEventListener('click', () => {
      document.getElementById('importDataFile').click();
    });

    document.getElementById('importDataFile').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      try {
        const text = await file.text();
        const importObj = JSON.parse(text);

        if (importObj.data) allData = importObj.data;
        if (importObj.counters) idCounters = importObj.counters;
        if (importObj.settings) companySettings = importObj.settings;

        saveData();
        loadSettingsForm();
        updateViews();
        
        showToast('Import Complete', 'Data imported successfully', 'success');
      } catch (error) {
        showToast('Import Failed', 'Invalid file format', 'error');
      }

      e.target.value = '';
    });

    // Settings
    function loadSettingsForm() {
      document.getElementById('settingsCompanyName').value = companySettings.name;
      document.getElementById('settingsTagline').value = companySettings.tagline;
      document.getElementById('settingsEmail').value = companySettings.email;
      document.getElementById('settingsPhone').value = companySettings.phone;
      document.getElementById('settingsAddress').value = companySettings.address;
    }

    document.getElementById('settingsCompanyName').addEventListener('change', (e) => {
      companySettings.name = e.target.value;
      saveData();
    });

    document.getElementById('settingsTagline').addEventListener('change', (e) => {
      companySettings.tagline = e.target.value;
      saveData();
    });

    document.getElementById('settingsEmail').addEventListener('change', (e) => {
      companySettings.email = e.target.value;
      saveData();
    });

    document.getElementById('settingsPhone').addEventListener('change', (e) => {
      companySettings.phone = e.target.value;
      saveData();
    });

    document.getElementById('settingsAddress').addEventListener('change', (e) => {
      companySettings.address = e.target.value;
      saveData();
    });

    // Signature Pad
    const canvas = document.getElementById('signaturePad');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;

    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    canvas.addEventListener('mousedown', (e) => {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      ctx.beginPath();
      ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--text');
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.stroke();
    });

    canvas.addEventListener('mouseup', () => {
      isDrawing = false;
    });

    canvas.addEventListener('mouseleave', () => {
      isDrawing = false;
    });

    document.getElementById('clearSignature').addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    document.getElementById('saveSignature').addEventListener('click', () => {
      companySettings.signature = canvas.toDataURL();
      saveData();
      showToast('Signature Saved', 'Digital signature saved successfully', 'success');
    });

    // Purchase Stock Entry
    let modalPurchaseItems = [];
    let currentSelectedProduct = null;

    document.getElementById('newPurchaseBtn').addEventListener('click', () => {
      modalPurchaseItems = [];
      currentSelectedProduct = null;
      document.getElementById('modalPurchaseDate').valueAsDate = new Date();
      document.getElementById('modalSupplierSearch').value = '';
      document.getElementById('modalSelectedSupplierId').value = '';
      document.getElementById('modalProductSearch').value = '';
      document.getElementById('modalQuantity').value = '1';
      document.getElementById('modalPurchasePrice').value = '';
      document.getElementById('modalMfgDate').value = '';
      document.getElementById('modalExpDate').value = '';
      document.getElementById('modalPurchaseItemsList').innerHTML = '';
      document.getElementById('modalItemCount').textContent = '0 items';
      document.getElementById('purchaseEntryModal').classList.remove('hidden');
      setTimeout(() => document.getElementById('modalSupplierSearch').focus(), 100);
    });

    // Modal Supplier Search
    document.getElementById('modalSupplierSearch').addEventListener('input', (e) => {
      const search = e.target.value.toLowerCase();
      const suppliers = allData.filter(item => item.type === 'supplier');
      const dropdown = document.getElementById('modalSupplierDropdown');

      if (search.length < 1) {
        dropdown.classList.add('hidden');
        return;
      }

      const filtered = suppliers.filter(item => {
        const data = JSON.parse(item.data);
        return data.name.toLowerCase().includes(search) || 
               data.contactPerson.toLowerCase().includes(search) ||
               data.id.toLowerCase().includes(search);
      });

      if (filtered.length === 0) {
        dropdown.classList.add('hidden');
        return;
      }

      dropdown.innerHTML = filtered.map(item => {
        const data = JSON.parse(item.data);
        return `
          <div class="dropdown-item" data-id="${data.id}">
            <h4>${data.name}</h4>
            <p>${data.id} - ${data.contactPerson}</p>
          </div>
        `;
      }).join('');

      dropdown.classList.remove('hidden');

      dropdown.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', () => {
          const id = item.dataset.id;
          const supplier = allData.find(s => s.type === 'supplier' && JSON.parse(s.data).id === id);
          if (supplier) {
            const data = JSON.parse(supplier.data);
            document.getElementById('modalSupplierSearch').value = data.name;
            document.getElementById('modalSelectedSupplierId').value = data.id;
            dropdown.classList.add('hidden');
            document.getElementById('modalProductSearch').focus();
          }
        });
      });
    });

    // Modal Product Search with Keyboard Navigation
    document.getElementById('modalProductSearch').addEventListener('input', (e) => {
      const search = e.target.value.toLowerCase();
      const products = allData.filter(item => item.type === 'product');
      const dropdown = document.getElementById('modalProductDropdown');

      if (search.length < 1) {
        dropdown.classList.add('hidden');
        return;
      }

      const filtered = products.filter(item => {
        const data = JSON.parse(item.data);
        return data.name.toLowerCase().includes(search) || 
               data.category.toLowerCase().includes(search) ||
               data.id.toLowerCase().includes(search);
      });

      if (filtered.length === 0) {
        dropdown.classList.add('hidden');
        return;
      }

      dropdown.innerHTML = filtered.map((item, index) => {
        const data = JSON.parse(item.data);
        return `
          <div class="dropdown-item" data-id="${data.id}" data-index="${index}">
            <h4>${data.name}</h4>
            <p>${data.id} - ${data.category}</p>
          </div>
        `;
      }).join('');

      dropdown.classList.remove('hidden');

      dropdown.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', () => {
          selectProduct(item.dataset.id);
        });
      });
    });

    document.getElementById('modalProductSearch').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const dropdown = document.getElementById('modalProductDropdown');
        const firstItem = dropdown.querySelector('.dropdown-item');
        if (firstItem) {
          selectProduct(firstItem.dataset.id);
        }
      }
    });

    function selectProduct(productId) {
      const product = allData.find(p => p.type === 'product' && JSON.parse(p.data).id === productId);
      if (product) {
        const data = JSON.parse(product.data);
        currentSelectedProduct = data;
        document.getElementById('modalProductSearch').value = data.name;
        document.getElementById('modalProductDropdown').classList.add('hidden');
        document.getElementById('modalQuantity').focus();
        document.getElementById('modalQuantity').select();
      }
    }

    // Keyboard navigation for quantity
    document.getElementById('modalQuantity').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('modalPurchasePrice').focus();
        document.getElementById('modalPurchasePrice').select();
      }
    });

    // Keyboard navigation for price
    document.getElementById('modalPurchasePrice').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('modalMfgDate').focus();
      }
    });

    // Keyboard navigation for MFG date
    document.getElementById('modalMfgDate').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('modalExpDate').focus();
      }
    });

    // Keyboard navigation for EXP date - Add item and go back to product search
    document.getElementById('modalExpDate').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addPurchaseItemToList();
      }
    });

    function addPurchaseItemToList() {
      if (!currentSelectedProduct) {
        showToast('Error', 'Please select a product', 'error');
        return;
      }

      const quantity = parseInt(document.getElementById('modalQuantity').value);
      const price = parseFloat(document.getElementById('modalPurchasePrice').value);
      const mfgDate = document.getElementById('modalMfgDate').value;
      const expDate = document.getElementById('modalExpDate').value;

      if (!quantity || !price || !mfgDate || !expDate) {
        showToast('Error', 'Please fill all fields', 'error');
        return;
      }

      const item = {
        id: Date.now(),
        productId: currentSelectedProduct.id,
        productName: currentSelectedProduct.name,
        quantity,
        price,
        mfgDate,
        expDate
      };

      modalPurchaseItems.push(item);
      updatePurchaseItemsList();

      // Clear and focus back on product search
      currentSelectedProduct = null;
      document.getElementById('modalProductSearch').value = '';
      document.getElementById('modalQuantity').value = '1';
      document.getElementById('modalPurchasePrice').value = '';
      document.getElementById('modalMfgDate').value = '';
      document.getElementById('modalExpDate').value = '';
      document.getElementById('modalProductSearch').focus();
    }

    function updatePurchaseItemsList() {
      const list = document.getElementById('modalPurchaseItemsList');
      document.getElementById('modalItemCount').textContent = `${modalPurchaseItems.length} items`;

      if (modalPurchaseItems.length === 0) {
        list.innerHTML = '';
        return;
      }

      list.innerHTML = modalPurchaseItems.map(item => `
        <div class="purchase-item" style="position: relative; padding: 1rem; background: var(--surface); border-radius: 12px; margin-bottom: 0.75rem;">
          <button onclick="removePurchaseItemFromList(${item.id})" style="position: absolute; top: 0.75rem; right: 0.75rem; width: 28px; height: 28px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: #F87171; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <svg class="icon" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem;">
            <div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Product</div>
              <div style="font-weight: 600; color: var(--text);">${item.productName}</div>
            </div>
            <div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Quantity</div>
              <div style="font-weight: 600; color: var(--text);">${item.quantity} units</div>
            </div>
            <div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Price</div>
              <div style="font-weight: 600; color: var(--text);">৳${item.price.toFixed(2)}</div>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
            <div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">MFG Date</div>
              <div style="font-weight: 500; color: var(--text);">${new Date(item.mfgDate).toLocaleDateString()}</div>
            </div>
            <div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">EXP Date</div>
              <div style="font-weight: 500; color: var(--text);">${new Date(item.expDate).toLocaleDateString()}</div>
            </div>
            <div>
              <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Total</div>
              <div style="font-weight: 700; color: var(--primary);">৳${(item.quantity * item.price).toFixed(2)}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    window.removePurchaseItemFromList = function(itemId) {
      modalPurchaseItems = modalPurchaseItems.filter(item => item.id !== itemId);
      updatePurchaseItemsList();
    };

    // Save Purchase Entry
    document.getElementById('savePurchaseEntryBtn').addEventListener('click', async () => {
      const supplierId = document.getElementById('modalSelectedSupplierId').value;
      const purchaseDate = document.getElementById('modalPurchaseDate').value;

      if (!supplierId) {
        showToast('Error', 'Please select a supplier', 'error');
        return;
      }

      if (!purchaseDate) {
        showToast('Error', 'Please select purchase date', 'error');
        return;
      }

      if (modalPurchaseItems.length === 0) {
        showToast('Error', 'Please add at least one product', 'error');
        return;
      }

      if (allData.length + modalPurchaseItems.length + 1 >= 999) {
        showToast('Limit Reached', 'Maximum 999 records allowed', 'error');
        return;
      }

      const purchaseId = generateId('purchase');
      const supplier = allData.find(s => s.type === 'supplier' && JSON.parse(s.data).id === supplierId);
      const supplierData = JSON.parse(supplier.data);

      const purchase = {
        id: purchaseId,
        type: 'purchase',
        user_id: userData?.email || 'guest',
        timestamp: new Date().toISOString(),
        reference_id: purchaseId,
        status: 'completed',
        data: JSON.stringify({
          id: purchaseId,
          supplierId,
          supplierName: supplierData.name,
          purchaseDate,
          items: modalPurchaseItems.map(item => ({
            productId: item.productId,
            productName: item.productName,
            quantity: item.quantity,
            price: item.price,
            mfgDate: item.mfgDate,
            expDate: item.expDate
          })),
          totalAmount: modalPurchaseItems.reduce((sum, item) => sum + (item.quantity * item.price), 0)
        })
      };

      const batches = [];
      for (const item of modalPurchaseItems) {
        const batchId = generateId('batch');
        const batch = {
          id: batchId,
          type: 'batch',
          user_id: userData?.email || 'guest',
          timestamp: new Date().toISOString(),
          reference_id: batchId,
          status: 'active',
          data: JSON.stringify({
            id: batchId,
            productId: item.productId,
            productName: item.productName,
            quantity: item.quantity,
            purchasePrice: item.price,
            mfgDate: item.mfgDate,
            expiryDate: item.expDate,
            purchaseId: purchaseId,
            purchaseDate: purchaseDate
          })
        };
        batches.push(batch);
      }

      if (window.dataSdk) {
        const purchaseResult = await window.dataSdk.create(purchase);
        if (!purchaseResult.isOk) {
          showToast('Error', 'Failed to save purchase', 'error');
          return;
        }

        for (const batch of batches) {
          const batchResult = await window.dataSdk.create(batch);
          if (!batchResult.isOk) {
            showToast('Error', 'Failed to save batch', 'error');
            return;
          }
        }
      } else {
        allData.push(purchase);
        batches.forEach(batch => allData.push(batch));
        saveData();
        updateViews();
      }

      showToast('Success', 'Purchase saved successfully', 'success');
      closeModal('purchaseEntryModal');
      checkAlerts();
    });

    // Old Purchase Item Code
    document.getElementById('addPurchaseItemBtn')?.addEventListener('click', () => {
      const itemId = Date.now();
      const itemHtml = `
        <div class="purchase-item" data-item-id="${itemId}">
          <button class="purchase-item-remove" onclick="removePurchaseItem(${itemId})">
            <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <div class="form-grid">
            <div class="form-field">
              <label class="field-label">Product</label>
              <input type="text" class="field-input product-search" placeholder="Search product..." autocomplete="off" data-item-id="${itemId}">
              <div class="dropdown-menu hidden" id="productDropdown${itemId}"></div>
              <input type="hidden" class="selected-product-id">
            </div>
            <div class="form-field">
              <label class="field-label">Quantity</label>
              <input type="number" class="field-input item-quantity" min="1" value="1" required>
            </div>
            <div class="form-field">
              <label class="field-label">Purchase Price (৳)</label>
              <input type="number" class="field-input item-price" step="0.01" min="0" required>
            </div>
            <div class="form-field">
              <label class="field-label">Manufacture Date</label>
              <input type="date" class="field-input item-mfg-date" required>
            </div>
            <div class="form-field">
              <label class="field-label">Expiry Date</label>
              <input type="date" class="field-input item-exp-date" required>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('purchaseItemsList').insertAdjacentHTML('beforeend', itemHtml);
      initProductSearch(itemId);
    });

    window.removePurchaseItem = function(itemId) {
      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      if (item) item.remove();
    };

    function initProductSearch(itemId) {
      const searchInput = document.querySelector(`.product-search[data-item-id="${itemId}"]`);
      const dropdown = document.getElementById(`productDropdown${itemId}`);

      searchInput.addEventListener('input', (e) => {
        const search = e.target.value.toLowerCase();
        const products = allData.filter(item => item.type === 'product');

        if (search.length < 2) {
          dropdown.classList.add('hidden');
          return;
        }

        const filtered = products.filter(item => {
          const data = JSON.parse(item.data);
          return data.name.toLowerCase().includes(search) || 
                 data.category.toLowerCase().includes(search) ||
                 data.id.toLowerCase().includes(search);
        });

        if (filtered.length === 0) {
          dropdown.classList.add('hidden');
          return;
        }

        dropdown.innerHTML = filtered.map(item => {
          const data = JSON.parse(item.data);
          return `
            <div class="dropdown-item" data-id="${data.id}">
              <h4>${data.name}</h4>
              <p>${data.id} - ${data.category}</p>
            </div>
          `;
        }).join('');

        dropdown.classList.remove('hidden');

        dropdown.querySelectorAll('.dropdown-item').forEach(item => {
          item.addEventListener('click', () => {
            const id = item.dataset.id;
            const product = allData.find(p => p.type === 'product' && JSON.parse(p.data).id === id);
            if (product) {
              const data = JSON.parse(product.data);
              searchInput.value = data.name;
              searchInput.closest('.purchase-item').querySelector('.selected-product-id').value = data.id;
              dropdown.classList.add('hidden');
            }
          });
        });
      });
    }

    // Save Purchase
    document.getElementById('savePurchaseBtn').addEventListener('click', async () => {
      const supplierId = document.getElementById('selectedSupplierId').value;
      const purchaseDate = document.getElementById('purchaseDate').value;

      if (!supplierId) {
        showToast('Error', 'Please select a supplier', 'error');
        return;
      }

      if (!purchaseDate) {
        showToast('Error', 'Please select purchase date', 'error');
        return;
      }

      const items = document.querySelectorAll('.purchase-item');
      if (items.length === 0) {
        showToast('Error', 'Please add at least one product', 'error');
        return;
      }

      const purchaseData = [];
      let hasError = false;

      items.forEach(item => {
        const productId = item.querySelector('.selected-product-id').value;
        const quantity = parseInt(item.querySelector('.item-quantity').value);
        const price = parseFloat(item.querySelector('.item-price').value);
        const mfgDate = item.querySelector('.item-mfg-date').value;
        const expDate = item.querySelector('.item-exp-date').value;

        if (!productId || !quantity || !price || !mfgDate || !expDate) {
          hasError = true;
          return;
        }

        const product = allData.find(p => p.type === 'product' && JSON.parse(p.data).id === productId);
        if (!product) {
          hasError = true;
          return;
        }

        purchaseData.push({
          productId,
          productName: JSON.parse(product.data).name,
          quantity,
          price,
          mfgDate,
          expDate
        });
      });

      if (hasError) {
        showToast('Error', 'Please fill all fields correctly', 'error');
        return;
      }

      if (allData.length + purchaseData.length + 1 >= 999) {
        showToast('Limit Reached', 'Maximum 999 records allowed', 'error');
        return;
      }

      // Create purchase record
      const purchaseId = generateId('purchase');
      const supplier = allData.find(s => s.type === 'supplier' && JSON.parse(s.data).id === supplierId);
      const supplierData = JSON.parse(supplier.data);

      const purchase = {
        id: purchaseId,
        type: 'purchase',
        user_id: userData?.email || 'guest',
        timestamp: new Date().toISOString(),
        reference_id: purchaseId,
        status: 'completed',
        data: JSON.stringify({
          id: purchaseId,
          supplierId,
          supplierName: supplierData.name,
          purchaseDate,
          items: purchaseData,
          totalAmount: purchaseData.reduce((sum, item) => sum + (item.quantity * item.price), 0)
        })
      };

      // Create batch records for each product
      const batches = [];
      for (const item of purchaseData) {
        const batchId = generateId('batch');
        const batch = {
          id: batchId,
          type: 'batch',
          user_id: userData?.email || 'guest',
          timestamp: new Date().toISOString(),
          reference_id: batchId,
          status: 'active',
          data: JSON.stringify({
            id: batchId,
            productId: item.productId,
            productName: item.productName,
            quantity: item.quantity,
            purchasePrice: item.price,
            mfgDate: item.mfgDate,
            expiryDate: item.expDate,
            purchaseId: purchaseId,
            purchaseDate: purchaseDate
          })
        };
        batches.push(batch);
      }

      // Save all data
      if (window.dataSdk) {
        const purchaseResult = await window.dataSdk.create(purchase);
        if (!purchaseResult.isOk) {
          showToast('Error', 'Failed to save purchase', 'error');
          return;
        }

        for (const batch of batches) {
          const batchResult = await window.dataSdk.create(batch);
          if (!batchResult.isOk) {
            showToast('Error', 'Failed to save batch', 'error');
            return;
          }
        }
      } else {
        allData.push(purchase);
        batches.forEach(batch => allData.push(batch));
        saveData();
        updateViews();
      }

      showToast('Success', 'Purchase saved successfully', 'success');
      
      // Clear form
      document.getElementById('purchaseSupplierSearch').value = '';
      document.getElementById('selectedSupplierId').value = '';
      document.getElementById('purchaseDate').valueAsDate = new Date();
      document.getElementById('purchaseItemsList').innerHTML = '';
      
      checkAlerts();
    });

    // Product
    document.getElementById('addProductBtn').addEventListener('click', () => {
      document.getElementById('productModal').classList.remove('hidden');
    });

    // Bulk Product Import
    document.getElementById('bulkProductBtn').addEventListener('click', () => {
      document.getElementById('bulkProductModal').classList.remove('hidden');
    });

    document.getElementById('saveBulkProductBtn').addEventListener('click', async () => {
      const data = document.getElementById('bulkProductData').value.trim();
      if (!data) {
        showToast('Error', 'Please enter product data', 'error');
        return;
      }

      const lines = data.split('\n').filter(line => line.trim());
      const products = [];
      let errors = [];

      for (let i = 0; i < lines.length; i++) {
        const parts = lines[i].split('-').map(p => p.trim());
        if (parts.length < 3) {
          errors.push(`Line ${i + 1}: Invalid format`);
          continue;
        }

        const name = parts[0];
        const category = parts[1];
        const stock = parseInt(parts[2]);
        const buyPrice = parts.length >= 4 ? parseFloat(parts[3]) : null;

        if (!name || !category || isNaN(stock)) {
          errors.push(`Line ${i + 1}: Missing or invalid data`);
          continue;
        }

        // Check if product exists
        const existingProduct = allData.find(p => 
          p.type === 'product' && JSON.parse(p.data).name.toLowerCase() === name.toLowerCase()
        );

        let finalBuyPrice = buyPrice;
        if (!finalBuyPrice && existingProduct) {
          // Use previous buying price
          const batches = getProductBatches(JSON.parse(existingProduct.data).id);
          if (batches.length > 0) {
            finalBuyPrice = batches[batches.length - 1].purchasePrice;
          }
        }

        if (!finalBuyPrice) {
          errors.push(`Line ${i + 1}: Buying price required for new product`);
          continue;
        }

        products.push({
          name,
          category,
          stock,
          buyPrice: finalBuyPrice,
          sellPrice: finalBuyPrice * 1.3, // 30% markup default
          existingId: existingProduct ? JSON.parse(existingProduct.data).id : null
        });
      }

      if (errors.length > 0) {
        showToast('Import Errors', `${errors.length} lines had errors. Check console.`, 'error');
        console.error('Import errors:', errors);
        return;
      }

      if (allData.length + products.length * 2 >= 999) {
        showToast('Limit Reached', 'Not enough space for all products', 'error');
        return;
      }

      // Create products and batches
      for (const prod of products) {
        let productId = prod.existingId;

        if (!productId) {
          // Create new product
          productId = generateId('product');
          const product = {
            id: productId,
            type: 'product',
            user_id: userData?.email || 'guest',
            timestamp: new Date().toISOString(),
            reference_id: productId,
            status: 'active',
            data: JSON.stringify({
              id: productId,
              name: prod.name,
              category: prod.category,
              buyPrice: prod.buyPrice,
              sellPrice: prod.sellPrice
            })
          };

          if (window.dataSdk) {
            await window.dataSdk.create(product);
          } else {
            allData.push(product);
          }
        }

        // Create batch
        const batchId = generateId('batch');
        const batch = {
          id: batchId,
          type: 'batch',
          user_id: userData?.email || 'guest',
          timestamp: new Date().toISOString(),
          reference_id: batchId,
          status: 'active',
          data: JSON.stringify({
            id: batchId,
            productId: productId,
            productName: prod.name,
            quantity: prod.stock,
            purchasePrice: prod.buyPrice,
            mfgDate: new Date().toISOString(),
            expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000 * 3).toISOString(), // 3 years default
            purchaseId: 'BULK_IMPORT',
            purchaseDate: new Date().toISOString()
          })
        };

        if (window.dataSdk) {
          await window.dataSdk.create(batch);
        } else {
          allData.push(batch);
        }
      }

      if (!window.dataSdk) {
        saveData();
        updateViews();
      }

      showToast('Success', `${products.length} products imported successfully`, 'success');
      closeModal('bulkProductModal');
      document.getElementById('bulkProductData').value = '';
      checkAlerts();
    });

    document.getElementById('productForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (allData.length >= 999) {
        showToast('Limit Reached', 'Maximum 999 records allowed', 'error');
        return;
      }

      const productId = generateId('product');
      const product = {
        id: productId,
        type: 'product',
        user_id: userData?.email || 'guest',
        timestamp: new Date().toISOString(),
        reference_id: productId,
        status: 'active',
        data: JSON.stringify({
          id: productId,
          name: document.getElementById('productName').value,
          category: document.getElementById('productCategory').value,
          buyPrice: parseFloat(document.getElementById('productBuyPrice').value),
          sellPrice: parseFloat(document.getElementById('productSellPrice').value)
        })
      };

      if (window.dataSdk) {
        const result = await window.dataSdk.create(product);
        if (result.isOk) {
          showToast('Success', 'Product added', 'success');
          closeModal('productModal');
          e.target.reset();
        } else {
          showToast('Error', 'Failed to add product', 'error');
        }
      } else {
        allData.push(product);
        saveData();
        updateViews();
        showToast('Success', 'Product added', 'success');
        closeModal('productModal');
        e.target.reset();
      }
    });

    // Supplier
    document.getElementById('addSupplierBtn').addEventListener('click', () => {
      document.getElementById('supplierModal').classList.remove('hidden');
    });

    document.getElementById('supplierForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (allData.length >= 999) {
        showToast('Limit Reached', 'Maximum 999 records allowed', 'error');
        return;
      }

      const supplierId = generateId('supplier');
      const supplier = {
        id: supplierId,
        type: 'supplier',
        user_id: userData?.email || 'guest',
        timestamp: new Date().toISOString(),
        reference_id: supplierId,
        status: 'active',
        data: JSON.stringify({
          id: supplierId,
          name: document.getElementById('supplierName').value,
          contactPerson: document.getElementById('supplierContactPerson').value,
          contact: document.getElementById('supplierContact').value,
          email: document.getElementById('supplierEmail').value,
          address: document.getElementById('supplierAddress').value,
          city: document.getElementById('supplierCity').value,
          country: document.getElementById('supplierCountry').value,
          notes: document.getElementById('supplierNotes').value
        })
      };

      if (window.dataSdk) {
        const result = await window.dataSdk.create(supplier);
        if (result.isOk) {
          showToast('Success', 'Supplier added', 'success');
          closeModal('supplierModal');
          e.target.reset();
        } else {
          showToast('Error', 'Failed to add supplier', 'error');
        }
      } else {
        allData.push(supplier);
        saveData();
        updateViews();
        showToast('Success', 'Supplier added', 'success');
        closeModal('supplierModal');
        e.target.reset();
      }
    });

    // Customer
    document.getElementById('addCustomerBtn').addEventListener('click', () => {
      document.getElementById('customerModal').classList.remove('hidden');
    });

    document.getElementById('customerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (allData.length >= 999) {
        showToast('Limit Reached', 'Maximum 999 records allowed', 'error');
        return;
      }

      const customerId = generateId('customer');
      const customer = {
        id: customerId,
        type: 'customer',
        user_id: userData?.email || 'guest',
        timestamp: new Date().toISOString(),
        reference_id: customerId,
        status: 'active',
        data: JSON.stringify({
          id: customerId,
          name: document.getElementById('customerName').value,
          business: document.getElementById('customerBusiness').value,
          contact: document.getElementById('customerContact').value,
          email: document.getElementById('customerEmail').value,
          address: document.getElementById('customerAddress').value,
          city: document.getElementById('customerCity').value,
          creditLimit: parseFloat(document.getElementById('customerCreditLimit').value),
          notes: document.getElementById('customerNotes').value,
          due: 0
        })
      };

      if (window.dataSdk) {
        const result = await window.dataSdk.create(customer);
        if (result.isOk) {
          showToast('Success', 'Customer added', 'success');
          closeModal('customerModal');
          e.target.reset();
        } else {
          showToast('Error', 'Failed to add customer', 'error');
        }
      } else {
        allData.push(customer);
        saveData();
        updateViews();
        showToast('Success', 'Customer added', 'success');
        closeModal('customerModal');
        e.target.reset();
      }
    });

    // Invoice
    document.getElementById('createInvoiceBtn').addEventListener('click', () => {
      updateInvoiceSelects();
      document.getElementById('invoiceModal').classList.remove('hidden');
    });

    document.getElementById('invoiceProduct').addEventListener('change', (e) => {
      const option = e.target.options[e.target.selectedIndex];
      document.getElementById('invoicePrice').value = option.dataset.price || 0;
    });

    document.getElementById('invoiceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (allData.length >= 999) {
        showToast('Limit Reached', 'Maximum 999 records allowed', 'error');
        return;
      }

      const customerId = document.getElementById('invoiceCustomer').value;
      const productId = document.getElementById('invoiceProduct').value;
      const qty = parseInt(document.getElementById('invoiceQty').value);
      const price = parseFloat(document.getElementById('invoicePrice').value);
      
      const customer = allData.find(c => c.type === 'customer' && JSON.parse(c.data).id === customerId);
      const product = allData.find(p => p.type === 'product' && JSON.parse(p.data).id === productId);
      
      if (!customer || !product) {
        showToast('Error', 'Invalid selection', 'error');
        return;
      }

      const productData = JSON.parse(product.data);
      const totalStock = getTotalStock(productId);
      
      if (totalStock < qty) {
        showToast('Error', `Insufficient stock. Available: ${totalStock} units`, 'error');
        return;
      }

      // Deduct stock from batches (FIFO by expiry date)
      const stockResult = deductStock(productId, qty);
      if (!stockResult.success) {
        showToast('Error', 'Failed to deduct stock', 'error');
        return;
      }

      const total = qty * price;
      const customerData = JSON.parse(customer.data);
      customerData.due += total;
      customer.data = JSON.stringify(customerData);

      const invoiceId = generateId('invoice');
      const invoice = {
        id: invoiceId,
        type: 'invoice',
        user_id: userData?.email || 'guest',
        timestamp: new Date().toISOString(),
        reference_id: invoiceId,
        customer_id: customerId,
        status: 'completed',
        amount: total,
        data: JSON.stringify({
          id: invoiceId,
          customerId,
          customerName: customerData.name,
          productId,
          productName: productData.name,
          qty,
          price,
          total,
          date: new Date().toISOString()
        })
      };

      if (window.dataSdk) {
        await window.dataSdk.update(customer);
        for (const batch of stockResult.updates) {
          await window.dataSdk.update(batch);
        }
        const result = await window.dataSdk.create(invoice);
        if (result.isOk) {
          showToast('Success', 'Invoice created', 'success');
          closeModal('invoiceModal');
          e.target.reset();
          checkAlerts();
        } else {
          showToast('Error', 'Failed to create invoice', 'error');
        }
      } else {
        allData.push(invoice);
        saveData();
        updateViews();
        showToast('Success', 'Invoice created', 'success');
        closeModal('invoiceModal');
        e.target.reset();
        checkAlerts();
      }
    });

    // Update Views
    function updateViews() {
      updateDashboard();
      updateProductsTable();
      updatePurchasesTable();
      updateSuppliersTable();
      updateCustomersTable();
      updateInvoicesTable();
      checkAlerts();
    }

    function updatePurchasesTable() {
      const purchases = allData.filter(i => i.type === 'purchase');
      const tbody = document.getElementById('purchasesTable');

      if (purchases.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline></svg></div><div class="empty-title">No Purchases</div><div class="empty-text">Start purchasing stock from suppliers</div><button class="btn btn-primary btn-sm" onclick="document.getElementById('newPurchaseBtn').click()">New Purchase</button></div></td></tr>`;
        return;
      }

      tbody.innerHTML = purchases.map(p => {
        const data = JSON.parse(p.data);
        const date = new Date(data.purchaseDate).toLocaleDateString();
        return `
          <tr>
            <td style="font-weight: 600;">${data.id}</td>
            <td>${data.supplierName}</td>
            <td>${date}</td>
            <td>${data.items.length} items</td>
            <td style="font-weight: 600;">৳${data.totalAmount.toFixed(2)}</td>
            <td><div class="action-btns"><button class="action-btn"><svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div></td>
          </tr>
        `;
      }).join('');
    }

    let salesChart = null;

    function updateDashboard() {
      const products = allData.filter(i => i.type === 'product');
      const customers = allData.filter(i => i.type === 'customer');
      const suppliers = allData.filter(i => i.type === 'supplier');
      const batches = allData.filter(i => i.type === 'batch');
      const invoices = allData.filter(i => i.type === 'invoice');

      // Calculate stock value
      let value = 0;
      batches.forEach(b => {
        const data = JSON.parse(b.data);
        value += data.quantity * data.purchasePrice;
      });

      // Calculate sales and profits
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
      const yearStart = new Date(now.getFullYear(), 0, 1);

      let todaySales = 0, todayProfit = 0;
      let monthSales = 0, monthProfit = 0;
      let yearSales = 0, yearProfit = 0;
      let totalDue = 0;

      invoices.forEach(inv => {
        const data = JSON.parse(inv.data);
        const invDate = new Date(data.date);
        const amount = data.total;
        
        // Calculate profit (selling price - buying price from FIFO batch)
        const product = allData.find(p => p.type === 'product' && JSON.parse(p.data).id === data.productId);
        if (product) {
          const productData = JSON.parse(product.data);
          const profit = (data.price - productData.buyPrice) * data.qty;
          
          if (invDate >= today) {
            todaySales += amount;
            todayProfit += profit;
          }
          if (invDate >= monthStart) {
            monthSales += amount;
            monthProfit += profit;
          }
          if (invDate >= yearStart) {
            yearSales += amount;
            yearProfit += profit;
          }
        }
      });

      // Calculate total due
      customers.forEach(c => {
        const data = JSON.parse(c.data);
        totalDue += data.due || 0;
      });

      // Update stats
      document.getElementById('statProducts').textContent = `${products.length} Products`;
      document.getElementById('statCustomers').textContent = customers.length;
      document.getElementById('statSuppliers').textContent = suppliers.length;
      document.getElementById('statInvoices').textContent = invoices.length;
      document.getElementById('statValue').textContent = `৳${value.toFixed(2)}`;
      document.getElementById('statDue').textContent = `৳${totalDue.toFixed(2)}`;
      
      document.getElementById('statTodaySales').textContent = `৳${todaySales.toFixed(2)}`;
      document.getElementById('statTodayProfit').textContent = `Profit: ৳${todayProfit.toFixed(2)}`;
      
      document.getElementById('statMonthSales').textContent = `৳${monthSales.toFixed(2)}`;
      document.getElementById('statMonthProfit').textContent = `Profit: ৳${monthProfit.toFixed(2)}`;
      
      document.getElementById('statYearSales').textContent = `৳${yearSales.toFixed(2)}`;
      document.getElementById('statYearProfit').textContent = `Profit: ৳${yearProfit.toFixed(2)}`;

      // Update sales chart
      updateSalesChart(invoices);
    }

    function updateSalesChart(invoices) {
      const ctx = document.getElementById('salesChart');
      if (!ctx) return;

      // Get last 6 months data
      const now = new Date();
      const monthlyData = [];
      const monthLabels = [];

      for (let i = 5; i >= 0; i--) {
        const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
        const monthName = date.toLocaleDateString('en-US', { month: 'short' });
        monthLabels.push(monthName);

        const monthStart = new Date(date.getFullYear(), date.getMonth(), 1);
        const monthEnd = new Date(date.getFullYear(), date.getMonth() + 1, 0);

        let monthTotal = 0;
        invoices.forEach(inv => {
          const data = JSON.parse(inv.data);
          const invDate = new Date(data.date);
          if (invDate >= monthStart && invDate <= monthEnd) {
            monthTotal += data.total;
          }
        });

        monthlyData.push(monthTotal);
      }

      if (salesChart) {
        salesChart.destroy();
      }

      salesChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: monthLabels,
          datasets: [{
            label: 'Sales (৳)',
            data: monthlyData,
            borderColor: '#10B981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: '#94A3B8'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: '#94A3B8'
              }
            }
          }
        }
      });
    }

    function updateProductsTable() {
      const products = allData.filter(i => i.type === 'product');
      const tbody = document.getElementById('productsTable');

      if (products.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"></path></svg></div><div class="empty-title">No Products</div><div class="empty-text">Add your first product</div><button class="btn btn-primary btn-sm" onclick="document.getElementById('addProductBtn').click()">Add Product</button></div></td></tr>`;
        return;
      }

      tbody.innerHTML = products.map(p => {
        const data = JSON.parse(p.data);
        const stock = getTotalStock(data.id);
        const status = stock === 0 ? 'badge-error' : stock < 10 ? 'badge-warning' : 'badge-success';
        const statusText = stock === 0 ? 'Out of Stock' : stock < 10 ? 'Low Stock' : 'In Stock';
        return `
          <tr>
            <td style="font-weight: 600;">${data.id}</td>
            <td>${data.name}</td>
            <td>${data.category}</td>
            <td style="font-weight: 600;">${stock}</td>
            <td style="font-weight: 600;">৳${data.sellPrice.toFixed(2)}</td>
            <td><span class="badge ${status}">${statusText}</span></td>
            <td><div class="action-btns"><button class="action-btn" onclick='viewDetail("product", "${data.id}")'><svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div></td>
          </tr>
        `;
      }).join('');
    }

    function updateSuppliersTable() {
      const suppliers = allData.filter(i => i.type === 'supplier');
      const tbody = document.getElementById('suppliersTable');

      if (suppliers.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path></svg></div><div class="empty-title">No Suppliers</div><div class="empty-text">Add suppliers to manage orders</div><button class="btn btn-primary btn-sm" onclick="document.getElementById('addSupplierBtn').click()">Add Supplier</button></div></td></tr>`;
        return;
      }

      tbody.innerHTML = suppliers.map(s => {
        const data = JSON.parse(s.data);
        return `
          <tr>
            <td style="font-weight: 600;">${data.id}</td>
            <td>${data.name}</td>
            <td>${data.contact}</td>
            <td>${data.email}</td>
            <td><div class="action-btns"><button class="action-btn"><svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div></td>
          </tr>
        `;
      }).join('');
    }

    function updateCustomersTable() {
      const customers = allData.filter(i => i.type === 'customer');
      const tbody = document.getElementById('customersTable');

      if (customers.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path><circle cx="9" cy="7" r="4"></circle></svg></div><div class="empty-title">No Customers</div><div class="empty-text">Add customers to create invoices</div><button class="btn btn-primary btn-sm" onclick="document.getElementById('addCustomerBtn').click()">Add Customer</button></div></td></tr>`;
        return;
      }

      tbody.innerHTML = customers.map(c => {
        const data = JSON.parse(c.data);
        return `
          <tr>
            <td style="font-weight: 600;">${data.id}</td>
            <td>${data.name}</td>
            <td>${data.contact}</td>
            <td>${data.email}</td>
            <td style="font-weight: 600; color: ${data.due > 0 ? '#F59E0B' : 'var(--primary)'};">৳${data.due.toFixed(2)}</td>
            <td><div class="action-btns"><button class="action-btn"><svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div></td>
          </tr>
        `;
      }).join('');
    }

    function updateInvoicesTable() {
      const invoices = allData.filter(i => i.type === 'invoice');
      const tbody = document.getElementById('invoicesTable');

      if (invoices.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg></div><div class="empty-title">No Invoices</div><div class="empty-text">Create invoices to track sales</div><button class="btn btn-primary btn-sm" onclick="document.getElementById('createInvoiceBtn').click()">Create Invoice</button></div></td></tr>`;
        return;
      }

      tbody.innerHTML = invoices.map(inv => {
        const data = JSON.parse(inv.data);
        const date = new Date(data.date).toLocaleDateString();
        return `
          <tr>
            <td style="font-weight: 600;">${data.id}</td>
            <td>${data.customerName}</td>
            <td>${date}</td>
            <td style="font-weight: 600;">৳${data.total.toFixed(2)}</td>
            <td><span class="badge badge-success">Completed</span></td>
            <td><div class="action-btns"><button class="action-btn"><svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div></td>
          </tr>
        `;
      }).join('');
    }

    function updateInvoiceSelects() {
      const customers = allData.filter(i => i.type === 'customer');
      const products = allData.filter(i => i.type === 'product');

      document.getElementById('invoiceCustomer').innerHTML = '<option value="">Select customer...</option>' + 
        customers.map(c => {
          const data = JSON.parse(c.data);
          return `<option value="${data.id}">${data.name}</option>`;
        }).join('');

      document.getElementById('invoiceProduct').innerHTML = '<option value="">Select product...</option>' + 
        products.map(p => {
          const data = JSON.parse(p.data);
          const stock = getTotalStock(data.id);
          return `<option value="${data.id}" data-price="${data.sellPrice}">${data.name} (Stock: ${stock})</option>`;
        }).join('');
    }

    // Detail View System
    let currentDetailItem = null;

    window.viewDetail = function(type, id) {
      const item = allData.find(i => i.type === type && JSON.parse(i.data).id === id);
      if (!item) return;

      currentDetailItem = item;
      const data = JSON.parse(item.data);
      const modal = document.getElementById('detailViewModal');
      const titleEl = document.getElementById('detailViewTitle');
      const contentEl = document.getElementById('detailViewContent');

      if (type === 'product') {
        titleEl.textContent = `Product: ${data.name}`;
        const batches = getProductBatches(data.id);
        const totalStock = getTotalStock(data.id);
        
        contentEl.innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
            <div class="glass" style="padding: 1.5rem; border-radius: 12px;">
              <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.5px;">Product Information</h4>
              <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <div><span style="color: var(--text-secondary); font-size: 0.875rem;">ID:</span> <strong>${data.id}</strong></div>
                <div><span style="color: var(--text-secondary); font-size: 0.875rem;">Name:</span> <strong>${data.name}</strong></div>
                <div><span style="color: var(--text-secondary); font-size: 0.875rem;">Category:</span> <strong>${data.category}</strong></div>
                <div><span style="color: var(--text-secondary); font-size: 0.875rem;">Buy Price:</span> <strong>৳${data.buyPrice.toFixed(2)}</strong></div>
                <div><span style="color: var(--text-secondary); font-size: 0.875rem;">Sell Price:</span> <strong>৳${data.sellPrice.toFixed(2)}</strong></div>
                <div><span style="color: var(--text-secondary); font-size: 0.875rem;">Total Stock:</span> <strong style="font-size: 1.25rem; color: var(--primary);">${totalStock} units</strong></div>
              </div>
            </div>
            <div class="glass" style="padding: 1.5rem; border-radius: 12px;">
              <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.5px;">Stock Batches (FIFO)</h4>
              <div style="max-height: 250px; overflow-y: auto;">
                ${batches.map(b => `
                  <div style="padding: 0.75rem; background: var(--surface); border-radius: 8px; margin-bottom: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                      <span style="font-size: 0.875rem; color: var(--text-secondary);">Batch ${b.id}</span>
                      <strong style="color: var(--primary);">${b.quantity} units</strong>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">
                      MFG: ${new Date(b.mfgDate).toLocaleDateString()} | EXP: ${new Date(b.expiryDate).toLocaleDateString()}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">
                      Purchase Price: ৳${b.purchasePrice.toFixed(2)}
                    </div>
                  </div>
                `).join('') || '<p style="color: var(--text-secondary); font-size: 0.875rem;">No batches available</p>'}
              </div>
            </div>
          </div>
        `;
      } else if (type === 'supplier') {
        titleEl.textContent = `Supplier: ${data.name}`;
        const purchases = allData.filter(p => p.type === 'purchase' && JSON.parse(p.data).supplierId === data.id);
        const totalPurchases = purchases.reduce((sum, p) => sum + JSON.parse(p.data).totalAmount, 0);
        
        contentEl.innerHTML = `
          <div class="glass" style="padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
            <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem;">Supplier Information</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div><span style="color: var(--text-secondary);">ID:</span> <strong>${data.id}</strong></div>
              <div><span style="color: var(--text-secondary);">Company:</span> <strong>${data.name}</strong></div>
              <div><span style="color: var(--text-secondary);">Contact Person:</span> <strong>${data.contactPerson}</strong></div>
              <div><span style="color: var(--text-secondary);">Phone:</span> <strong>${data.contact}</strong></div>
              <div><span style="color: var(--text-secondary);">Email:</span> <strong>${data.email}</strong></div>
              <div><span style="color: var(--text-secondary);">City:</span> <strong>${data.city}</strong></div>
              <div style="grid-column: 1 / -1;"><span style="color: var(--text-secondary);">Address:</span> <strong>${data.address}</strong></div>
              <div style="grid-column: 1 / -1;"><span style="color: var(--text-secondary);">Total Purchases:</span> <strong style="font-size: 1.25rem; color: var(--primary);">৳${totalPurchases.toFixed(2)}</strong></div>
            </div>
          </div>
          <div class="glass" style="padding: 1.5rem; border-radius: 12px;">
            <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem;">Purchase History</h4>
            ${purchases.length > 0 ? `
              <table style="width: 100%; font-size: 0.875rem;">
                <thead>
                  <tr style="border-bottom: 1px solid var(--border);">
                    <th style="padding: 0.5rem; text-align: left;">ID</th>
                    <th style="padding: 0.5rem; text-align: left;">Date</th>
                    <th style="padding: 0.5rem; text-align: right;">Items</th>
                    <th style="padding: 0.5rem; text-align: right;">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  ${purchases.map(p => {
                    const pData = JSON.parse(p.data);
                    return `
                      <tr style="border-bottom: 1px solid var(--border);">
                        <td style="padding: 0.5rem;">${pData.id}</td>
                        <td style="padding: 0.5rem;">${new Date(pData.purchaseDate).toLocaleDateString()}</td>
                        <td style="padding: 0.5rem; text-align: right;">${pData.items.length}</td>
                        <td style="padding: 0.5rem; text-align: right; font-weight: 600;">৳${pData.totalAmount.toFixed(2)}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            ` : '<p style="color: var(--text-secondary);">No purchases yet</p>'}
          </div>
        `;
      } else if (type === 'customer') {
        titleEl.textContent = `Customer: ${data.name}`;
        const invoices = allData.filter(inv => inv.type === 'invoice' && JSON.parse(inv.data).customerId === data.id);
        const totalSales = invoices.reduce((sum, inv) => sum + JSON.parse(inv.data).total, 0);
        let totalProfit = 0;
        
        invoices.forEach(inv => {
          const invData = JSON.parse(inv.data);
          const product = allData.find(p => p.type === 'product' && JSON.parse(p.data).id === invData.productId);
          if (product) {
            const prodData = JSON.parse(product.data);
            totalProfit += (invData.price - prodData.buyPrice) * invData.qty;
          }
        });
        
        contentEl.innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
            <div class="glass" style="padding: 1.5rem; border-radius: 12px;">
              <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem;">Customer Information</h4>
              <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <div><span style="color: var(--text-secondary);">ID:</span> <strong>${data.id}</strong></div>
                <div><span style="color: var(--text-secondary);">Name:</span> <strong>${data.name}</strong></div>
                <div><span style="color: var(--text-secondary);">Business:</span> <strong>${data.business || 'N/A'}</strong></div>
                <div><span style="color: var(--text-secondary);">Phone:</span> <strong>${data.contact}</strong></div>
                <div><span style="color: var(--text-secondary);">Email:</span> <strong>${data.email}</strong></div>
                <div><span style="color: var(--text-secondary);">Address:</span> <strong>${data.address || 'N/A'}</strong></div>
              </div>
            </div>
            <div class="glass" style="padding: 1.5rem; border-radius: 12px;">
              <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem;">Dashboard</h4>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div style="padding: 1rem; background: var(--surface); border-radius: 8px;">
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Total Sales</div>
                  <div style="font-size: 1.25rem; font-weight: 800; color: var(--primary);">৳${totalSales.toFixed(2)}</div>
                </div>
                <div style="padding: 1rem; background: var(--surface); border-radius: 8px;">
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Total Profit</div>
                  <div style="font-size: 1.25rem; font-weight: 800; color: var(--primary);">৳${totalProfit.toFixed(2)}</div>
                </div>
                <div style="padding: 1rem; background: var(--surface); border-radius: 8px;">
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Invoices</div>
                  <div style="font-size: 1.25rem; font-weight: 800; color: var(--text);">${invoices.length}</div>
                </div>
                <div style="padding: 1rem; background: var(--surface); border-radius: 8px;">
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Total Due</div>
                  <div style="font-size: 1.25rem; font-weight: 800; color: #F59E0B;">৳${data.due.toFixed(2)}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="glass" style="padding: 1.5rem; border-radius: 12px;">
            <h4 style="font-size: 0.875rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 1rem;">Invoice History</h4>
            ${invoices.length > 0 ? `
              <table style="width: 100%; font-size: 0.875rem;">
                <thead>
                  <tr style="border-bottom: 1px solid var(--border);">
                    <th style="padding: 0.5rem; text-align: left;">ID</th>
                    <th style="padding: 0.5rem; text-align: left;">Date</th>
                    <th style="padding: 0.5rem; text-align: left;">Product</th>
                    <th style="padding: 0.5rem; text-align: right;">Qty</th>
                    <th style="padding: 0.5rem; text-align: right;">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  ${invoices.map(inv => {
                    const invData = JSON.parse(inv.data);
                    return `
                      <tr style="border-bottom: 1px solid var(--border);">
                        <td style="padding: 0.5rem;">${invData.id}</td>
                        <td style="padding: 0.5rem;">${new Date(invData.date).toLocaleDateString()}</td>
                        <td style="padding: 0.5rem;">${invData.productName}</td>
                        <td style="padding: 0.5rem; text-align: right;">${invData.qty}</td>
                        <td style="padding: 0.5rem; text-align: right; font-weight: 600;">৳${invData.total.toFixed(2)}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            ` : '<p style="color: var(--text-secondary);">No invoices yet</p>'}
          </div>
        `;
      }

      modal.classList.remove('hidden');
    };

    // Print Detail
    document.getElementById('detailPrintBtn').addEventListener('click', () => {
      if (!currentDetailItem) return;
      
      const data = JSON.parse(currentDetailItem.data);
      const printWindow = window.open('', '_blank');
      const content = document.getElementById('detailViewContent').innerHTML;
      
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Print - ${data.name || data.id}</title>
          <style>
            @page { size: A4; margin: 20mm; }
            body { font-family: Arial, sans-serif; color: #000; background: #fff; }
            h1 { color: #10B981; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
            th { background: #f5f5f5; font-weight: bold; }
            .header { text-align: center; margin-bottom: 30px; }
            .header h1 { margin: 0; font-size: 24px; }
            .header p { margin: 5px 0; color: #666; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>${companySettings.name}</h1>
            <p>${companySettings.tagline}</p>
            <p>${companySettings.email} | ${companySettings.phone}</p>
          </div>
          ${content}
          <p style="margin-top: 30px; text-align: center; color: #999;">Generated on ${new Date().toLocaleString()}</p>
        </body>
        </html>
      `);
      
      printWindow.document.close();
      setTimeout(() => {
        printWindow.print();
      }, 250);
    });

    // Print Dashboard Report
    document.getElementById('printDashboardBtn').addEventListener('click', () => {
      const printWindow = window.open('', '_blank');
      
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Dashboard Report</title>
          <style>
            @page { size: A4; margin: 20mm; }
            body { font-family: Arial, sans-serif; color: #000; background: #fff; }
            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #10B981; padding-bottom: 20px; }
            .header h1 { margin: 0; font-size: 28px; color: #10B981; }
            .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
            .stat-box { padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
            .stat-box h3 { margin: 0 0 10px 0; color: #666; font-size: 14px; }
            .stat-box .value { font-size: 24px; font-weight: bold; color: #10B981; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>${companySettings.name}</h1>
            <p style="margin: 5px 0;">${companySettings.tagline}</p>
            <p style="margin: 5px 0; color: #666;">${companySettings.email} | ${companySettings.phone}</p>
            <h2 style="margin: 20px 0 0 0;">Dashboard Report</h2>
            <p style="color: #999;">Generated on ${new Date().toLocaleString()}</p>
          </div>
          
          <div class="stats">
            <div class="stat-box">
              <h3>TODAY'S SALES</h3>
              <div class="value">${document.getElementById('statTodaySales').textContent}</div>
              <p style="margin: 5px 0; color: #666;">${document.getElementById('statTodayProfit').textContent}</p>
            </div>
            <div class="stat-box">
              <h3>THIS MONTH</h3>
              <div class="value">${document.getElementById('statMonthSales').textContent}</div>
              <p style="margin: 5px 0; color: #666;">${document.getElementById('statMonthProfit').textContent}</p>
            </div>
            <div class="stat-box">
              <h3>THIS YEAR</h3>
              <div class="value">${document.getElementById('statYearSales').textContent}</div>
              <p style="margin: 5px 0; color: #666;">${document.getElementById('statYearProfit').textContent}</p>
            </div>
            <div class="stat-box">
              <h3>STOCK VALUE</h3>
              <div class="value">${document.getElementById('statValue').textContent}</div>
              <p style="margin: 5px 0; color: #666;">${document.getElementById('statProducts').textContent}</p>
            </div>
            <div class="stat-box">
              <h3>CUSTOMERS</h3>
              <div class="value">${document.getElementById('statCustomers').textContent}</div>
            </div>
            <div class="stat-box">
              <h3>SUPPLIERS</h3>
              <div class="value">${document.getElementById('statSuppliers').textContent}</div>
            </div>
            <div class="stat-box">
              <h3>TOTAL INVOICES</h3>
              <div class="value">${document.getElementById('statInvoices').textContent}</div>
            </div>
            <div class="stat-box">
              <h3>TOTAL DUE</h3>
              <div class="value" style="color: #F59E0B;">${document.getElementById('statDue').textContent}</div>
            </div>
          </div>
        </body>
        </html>
      `);
      
      printWindow.document.close();
      setTimeout(() => {
        printWindow.print();
      }, 250);
    });

    // Utilities
    function closeModal(id) {
      document.getElementById(id).classList.add('hidden');
    }

    function showToast(title, message, type) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast glass ${type}`;
      
      const icons = {
        success: '<path d="M22 11.08V12a10 10 0 11-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>',
        error: '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>'
      };

      toast.innerHTML = `
        <svg class="toast-icon icon" viewBox="0 0 24 24">${icons[type] || icons.success}</svg>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
      `;

      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Firebase Integration Ready (Add your Firebase config here)
    /*
    // Import Firebase SDK
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, set, get, update, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    // Replace localStorage functions with Firebase
    function saveData() {
      set(ref(database, 'data'), allData);
      set(ref(database, 'counters'), idCounters);
      set(ref(database, 'deleted_ids'), deletedIds);
      set(ref(database, 'settings'), companySettings);
    }
    
    function loadData() {
      get(ref(database, 'data')).then((snapshot) => {
        if (snapshot.exists()) allData = snapshot.val();
      });
      // Similar for other data
    }
    */
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a8a98ab03464e9c',t:'MTc2NDg0Mzg5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
