<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sayed's Lamp - ERP System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .gradient-bg { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); }
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .modal-backdrop { backdrop-filter: blur(4px); }
        
        @media print {
            body * { visibility: hidden; }
            .print-content, .print-content * { visibility: visible; }
            .print-content { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            @page { margin: 0.5in; size: A4; }
        }
    </style>
</head>
<body class="bg-gray-900 font-sans text-gray-100">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-8 border border-gray-700">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-900 rounded-full mb-4">
                    <i class="fas fa-store text-blue-400 text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-100 mb-2">MS/ KAMAL & SON'S</h1>
                <p class="text-gray-400">Business Management System</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" placeholder="Enter username" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" placeholder="Enter password" required>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                    Sign In
                </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-gray-400">
                Demo credentials: admin / admin
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden min-h-screen bg-gray-900">
        <!-- Header -->
        <header class="bg-gray-800 shadow-lg border-b border-gray-700">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4">
                    <button id="sidebarToggle" class="lg:hidden text-gray-400 hover:text-gray-200">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center">
                            <i class="fas fa-store text-blue-400"></i>
                        </div>
                        <h1 class="text-xl font-bold text-gray-100">MS/ KAMAL & SON'S</h1>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button class="relative text-gray-400 hover:text-gray-200">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-semibold">A</span>
                        </div>
                        <span class="text-gray-300 font-medium">Admin</span>
                    </div>
                    <button id="logoutBtn" class="text-gray-400 hover:text-gray-200">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- Sidebar -->
            <aside id="sidebar" class="bg-gray-800 w-64 min-h-screen shadow-lg sidebar-transition transform -translate-x-full lg:translate-x-0 fixed lg:relative z-30 border-r border-gray-700">
                <nav class="p-6">
                    <ul class="space-y-2">
                        <li><a href="#" onclick="showPage('dashboard')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-tachometer-alt w-5"></i><span>Dashboard</span>
                        </a></li>
                        <li><a href="#" onclick="showPage('labelGenerator')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-tags w-5"></i><span>Label Generator</span>
                        </a></li>                        
                        <li><a href="#" onclick="showPage('products')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-box w-5"></i><span>Products</span>
                        </a></li>
                        <li><a href="#" onclick="showPage('customers')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-users w-5"></i><span>Customers</span>
                        </a></li>
                        <li><a href="#" onclick="showPage('invoices')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-file-invoice w-5"></i><span>Invoices</span>
                        </a></li>
                        <li><a href="#" onclick="showPage('users')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-user-cog w-5"></i><span>User Management</span>
                        </a></li> 
                        <li><a href="#" onclick="showPage('notifications')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-bell w-5"></i><span>Notifications</span><li>
                        </a></li>
                        <li><a href="#" onclick="showPage('settings')" class="nav-link flex items-center space-x-3 text-gray-300 hover:bg-gray-700 hover:text-blue-400 rounded-lg px-3 py-2 transition duration-200">
                            <i class="fas fa-cog w-5"></i><span>Settings</span>
                        </a></li>
                    </ul>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-6">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div class="mb-6 flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-100 mb-2">Dashboard</h2>
                            <p class="text-gray-400">Welcome to Sayed's Lamp ERP System</p>
                        </div>
                        <button onclick="printDashboardReport()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-print mr-2"></i>Print Report
                        </button>
                    </div>
                    
                    <!-- Key Metrics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-blue-900 to-blue-800 rounded-xl shadow-lg p-6 card-hover border border-blue-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-200 text-sm">Total Products</p>
                                    <p class="text-3xl font-bold text-white" id="totalProducts">0</p>
                                    <p class="text-blue-300 text-xs mt-1">+12% from last month</p>
                                </div>
                                <div class="w-14 h-14 bg-blue-700 rounded-full flex items-center justify-center">
                                    <i class="fas fa-box text-blue-200 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-900 to-green-800 rounded-xl shadow-lg p-6 card-hover border border-green-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-200 text-sm">Active Customers</p>
                                    <p class="text-3xl font-bold text-white" id="totalCustomers">0</p>
                                    <p class="text-green-300 text-xs mt-1">+8% from last month</p>
                                </div>
                                <div class="w-14 h-14 bg-green-700 rounded-full flex items-center justify-center">
                                    <i class="fas fa-users text-green-200 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-900 to-purple-800 rounded-xl shadow-lg p-6 card-hover border border-purple-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-200 text-sm">Monthly Revenue</p>
                                    <p class="text-3xl font-bold text-white" id="monthlyRevenue">৳0</p>
                                    <p class="text-purple-300 text-xs mt-1">+23% from last month</p>
                                </div>
                                <div class="w-14 h-14 bg-purple-700 rounded-full flex items-center justify-center">
                                    <i class="fas fa-chart-line text-purple-200 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-orange-900 to-orange-800 rounded-xl shadow-lg p-6 card-hover border border-orange-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-200 text-sm">Total Invoices</p>
                                    <p class="text-3xl font-bold text-white" id="totalInvoices">0</p>
                                    <p class="text-orange-300 text-xs mt-1">+15% from last month</p>
                                </div>
                                <div class="w-14 h-14 bg-orange-700 rounded-full flex items-center justify-center">
                                    <i class="fas fa-file-invoice text-orange-200 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Monthly Sales Chart -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-semibold text-gray-100">Monthly Sales History</h3>
                                <div class="flex space-x-2">
                                    <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                                    <span class="text-sm text-gray-400">Revenue</span>
                                </div>
                            </div>
                            <div class="h-64 relative">
                                <canvas id="salesChart" class="w-full h-full"></canvas>
                            </div>
                        </div>

                        <!-- Top Products Chart -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-6">Top Selling Products</h3>
                            <div class="space-y-4" id="topProductsList">
                                <!-- Top products will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Sales Performance -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Sales Performance</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Today's Sales</span>
                                    <span class="text-green-400 font-semibold" id="todaySales">৳0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">This Week</span>
                                    <span class="text-blue-400 font-semibold" id="weekSales">৳0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">This Month</span>
                                    <span class="text-purple-400 font-semibold" id="monthSales">৳0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">This Year</span>
                                    <span class="text-yellow-400 font-semibold" id="yearSales">৳0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Product Analytics -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Product Analytics</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-gray-400">Best Seller</span>
                                        <span class="text-green-400 font-semibold" id="bestSeller">-</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-gray-400">Lowest Seller</span>
                                        <span class="text-red-400 font-semibold" id="lowestSeller">-</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full" style="width: 15%"></div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Low Stock Items</span>
                                    <span class="text-yellow-400 font-semibold" id="lowStockCount">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Customer Analytics -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Customer Analytics</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">New Customers</span>
                                    <span class="text-green-400 font-semibold">+12</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Avg. Order Value</span>
                                    <span class="text-blue-400 font-semibold" id="avgOrderValue">৳0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Top Customer</span>
                                    <span class="text-purple-400 font-semibold" id="topCustomer">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Repeat Rate</span>
                                    <span class="text-yellow-400 font-semibold">68%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity & Alerts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Recent Activity</h3>
                            <div class="space-y-3" id="recentActivity">
                                <!-- Recent activity will be populated here -->
                            </div>
                        </div>

                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">System Alerts</h3>
                            <div class="space-y-3" id="systemAlerts">
                                <!-- System alerts will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  window.addEventListener("load", () => {
    document.getElementById("labelCompany").value = localStorage.getItem("labelCompany") || "AS ENTERPRISE";
    document.getElementById("labelAddress1").value = localStorage.getItem("labelAddress1") || "House No-43, Plot No-26, Mokim Katara";
    document.getElementById("labelAddress2").value = localStorage.getItem("labelAddress2") || "Moulvibazar, Dhaka, 1200";
  });

  function printLabels() {
    const iframe = document.getElementById("labelPreview");
    iframe.contentWindow.focus();
    iframe.contentWindow.print();
  }

  document.getElementById("labelForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const { jsPDF } = window.jspdf;

    const price = parseFloat(document.getElementById("labelPrice").value).toFixed(2);
    const company = document.getElementById("labelCompany").value;
    const address1 = document.getElementById("labelAddress1").value;
    const address2 = document.getElementById("labelAddress2").value;
    const pages = parseInt(document.getElementById("labelPages").value);

    const doc = new jsPDF("portrait", "mm", "a4");

    const labelWidth = 40;  // mm (4cm)
    const labelHeight = 20; // mm (2cm)
    const cols = 5;
    const rows = 14;

    const pageWidth = 210;
    const pageHeight = 297;

    const totalLabelWidth = cols * labelWidth;
    const totalLabelHeight = rows * labelHeight;

    const offsetX = (pageWidth - totalLabelWidth) / 2;
    const offsetY = (pageHeight - totalLabelHeight) / 2;

    for (let p = 0; p < pages; p++) {
      if (p > 0) doc.addPage();

      for (let i = 0; i < cols * rows; i++) {
        const col = i % cols;
        const row = Math.floor(i / cols);
        const x = offsetX + col * labelWidth;
        const y = offsetY + row * labelHeight;

        const centerX = x + labelWidth / 2;
        let lineY = y + 5;

        doc.setFontSize(6);
        doc.setFont("helvetica", "normal");
        doc.setTextColor(50);
        doc.text("Imported & Distributed by", centerX, lineY, { align: "center" });

        lineY += 3.2;
        doc.setFont("helvetica", "bold");
        doc.setFontSize(8.2); // Increased size
        doc.setTextColor(0, 102, 153);
        doc.text(company, centerX, lineY, { align: "center" });

        lineY += 3.2;
        doc.setFont("helvetica", "normal");
        doc.setFontSize(6);
        doc.setTextColor(0);
        doc.text(address1, centerX, lineY, { align: "center" });

        lineY += 3;
        doc.text(address2, centerX, lineY, { align: "center" });

        lineY += 4.5;
        doc.setFont("helvetica", "bold");
        doc.setFontSize(9.5);
        doc.setTextColor(0);
        doc.text(`MRP: ৳${price}`, centerX, lineY, { align: "center" });
      }
    }

    const pdfDataUri = doc.output("dataurlstring");
    document.getElementById("labelPreview").src = pdfDataUri;
  });
</script>






                <!-- Products Page -->
                <div id="productsPage" class="page-content hidden">
                    <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-100 mb-2">Products</h2>
                            <p class="text-gray-400">Manage your product inventory</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="printProducts()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-print mr-2"></i>Print
                            </button>
                            <button onclick="openProductModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Add Product
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700">
                        <div class="p-6 border-b border-gray-700">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="text" id="productSearch" placeholder="Search by product name or code..." class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onkeyup="filterProducts()">
                                <select id="categoryFilter" class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onchange="filterProducts()">
                                    <option value="">All Categories</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Clothing">Clothing</option>
                                    <option value="Books">Books</option>
                                    <option value="Home & Garden">Home & Garden</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Furniture">Furniture</option>
                                    <option value="Automotive">Automotive</option>
                                    <option value="Health & Beauty">Health & Beauty</option>
                                    <option value="Toys & Games">Toys & Games</option>
                                    <option value="Food & Beverages">Food & Beverages</option>
                                    <option value="Office Supplies">Office Supplies</option>
                                    <option value="Tools & Hardware">Tools & Hardware</option>
                                    <option value="Pet Supplies">Pet Supplies</option>
                                    <option value="Music & Instruments">Music & Instruments</option>
                                    <option value="Art & Crafts">Art & Crafts</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Code</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Product</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Category</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Price (৳)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Stock</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-800 divide-y divide-gray-700" id="productsTableBody">
                                    <!-- Products will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Customers Page -->
                <div id="customersPage" class="page-content hidden">
                    <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-100 mb-2">Customers</h2>
                            <p class="text-gray-400">Manage your customer relationships</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="printCustomers()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-print mr-2"></i>Print
                            </button>
                            <button onclick="openCustomerModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-user-plus mr-2"></i>Add Customer
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700">
                        <div class="p-6 border-b border-gray-700">
                            <input type="text" id="customerSearch" placeholder="Search by name, email, or customer ID..." class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onkeyup="filterCustomers()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Customer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Phone</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Total Spent (৳)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Last Purchase</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-800 divide-y divide-gray-700" id="customersTableBody">
                                    <!-- Customers will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Invoices Page -->
                <div id="invoicesPage" class="page-content hidden">
                    <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-100 mb-2">Invoices</h2>
                            <p class="text-gray-400">Manage billing and invoices</p>
                        </div>
                        <button onclick="openInvoiceModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Create Invoice
                        </button>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700">
                        <div class="p-6 border-b border-gray-700">
                            <input type="text" id="invoiceSearch" placeholder="Search by invoice number, customer name, or customer ID..." class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onkeyup="filterInvoices()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Invoice #</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Customer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Customer ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount (৳)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-800 divide-y divide-gray-700" id="invoicesTableBody">
                                    <!-- Invoices will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- User Management Page -->
                <div id="usersPage" class="page-content hidden">
                    <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-100 mb-2">User Management</h2>
                            <p class="text-gray-400">Manage system users and permissions</p>
                        </div>
                        <button onclick="openUserModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-user-plus mr-2"></i>Add User
                        </button>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700">
                        <div class="p-6 border-b border-gray-700">
                            <input type="text" id="userSearch" placeholder="Search users..." class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onkeyup="filterUsers()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">User ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Username</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Phone</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-800 divide-y divide-gray-700" id="usersTableBody">
                                    <!-- Users will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Notifications Page -->
                <div id="notificationsPage" class="page-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-100 mb-2">Notifications</h2>
                        <p class="text-gray-400">Manage system notifications and alerts</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Recent Notifications</h3>
                            <div class="space-y-4">
                                <div class="flex items-start space-x-3 p-3 bg-red-900 bg-opacity-30 rounded-lg border border-red-700">
                                    <i class="fas fa-exclamation-triangle text-red-400 mt-1"></i>
                                    <div>
                                        <p class="text-gray-100 font-medium">Low Stock Alert</p>
                                        <p class="text-gray-400 text-sm">Wireless Mouse stock is critically low (5 units remaining)</p>
                                        <p class="text-gray-500 text-xs mt-1">2 hours ago</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start space-x-3 p-3 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-700">
                                    <i class="fas fa-info-circle text-blue-400 mt-1"></i>
                                    <div>
                                        <p class="text-gray-100 font-medium">New Order Received</p>
                                        <p class="text-gray-400 text-sm">Order #12348 from Sarah Wilson - $199.99</p>
                                        <p class="text-gray-500 text-xs mt-1">4 hours ago</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start space-x-3 p-3 bg-green-900 bg-opacity-30 rounded-lg border border-green-700">
                                    <i class="fas fa-check-circle text-green-400 mt-1"></i>
                                    <div>
                                        <p class="text-gray-100 font-medium">Payment Received</p>
                                        <p class="text-gray-400 text-sm">Invoice INV-001 has been paid by John Doe</p>
                                        <p class="text-gray-500 text-xs mt-1">6 hours ago</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start space-x-3 p-3 bg-yellow-900 bg-opacity-30 rounded-lg border border-yellow-700">
                                    <i class="fas fa-clock text-yellow-400 mt-1"></i>
                                    <div>
                                        <p class="text-gray-100 font-medium">Invoice Overdue</p>
                                        <p class="text-gray-400 text-sm">Invoice INV-002 is 5 days overdue</p>
                                        <p class="text-gray-500 text-xs mt-1">1 day ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Notification Settings</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="text-gray-100 font-medium">Low Stock Alerts</p>
                                        <p class="text-gray-400 text-sm">Get notified when products are running low</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="text-gray-100 font-medium">New Orders</p>
                                        <p class="text-gray-400 text-sm">Get notified about new customer orders</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="text-gray-100 font-medium">Payment Notifications</p>
                                        <p class="text-gray-400 text-sm">Get notified when payments are received</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="text-gray-100 font-medium">Overdue Invoices</p>
                                        <p class="text-gray-400 text-sm">Get notified about overdue payments</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" class="page-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-100 mb-2">Settings</h2>
                        <p class="text-gray-400">Configure your ERP system preferences</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Company Information -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Company Information</h3>
                            <form id="companyForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Company Name</label>
                                    <input type="text" id="companyName" value="MS/ KAMAL & SON'S" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Company Slogan</label>
                                    <input type="text" id="companySlogan" value="Thank you for your business!" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                                    <textarea id="companyAddress" rows="3" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">Dhaka, Bangladesh</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Phone</label>
                                    <input type="tel" id="companyPhone" value="+880 1234 567890" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                                    <input type="email" id="companyEmail" value="info@kamalson.com" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                </div>
                                
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Save Company Info
                                </button>
                            </form>
                        </div>
                        
                        <!-- Logo Upload -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Company Logo</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-center w-full">
                                    <div class="w-32 h-32 bg-gray-700 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center" id="logoPreview">
                                        <div class="text-center">
                                            <i class="fas fa-image text-gray-500 text-3xl mb-2"></i>
                                            <p class="text-gray-400 text-sm">No Logo</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Upload Logo</label>
                                    <input type="file" id="logoUpload" accept="image/*" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onchange="handleLogoUpload(event)">
                                    <p class="text-gray-400 text-xs mt-1">Recommended: 200x200px, PNG or JPG</p>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button onclick="uploadLogo()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                        <i class="fas fa-upload mr-2"></i>Upload
                                    </button>
                                    <button onclick="removeLogo()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                        <i class="fas fa-trash mr-2"></i>Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Invoice Template Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Invoice Template Upload -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Invoice Template</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-center w-full">
                                    <div class="w-full h-48 bg-gray-700 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center" id="templatePreview">
                                        <div class="text-center">
                                            <i class="fas fa-file-invoice text-gray-500 text-4xl mb-3"></i>
                                            <p class="text-gray-400 text-sm">No Template Uploaded</p>
                                            <p class="text-gray-500 text-xs mt-1">Upload a PNG template to customize invoice design</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Upload Invoice Template</label>
                                    <input type="file" id="templateUpload" accept="image/png" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onchange="handleTemplateUpload(event)">
                                    <p class="text-gray-400 text-xs mt-1">Upload PNG file - System will auto-copy the style and layout</p>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button onclick="uploadTemplate()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                        <i class="fas fa-upload mr-2"></i>Apply Template
                                    </button>
                                    <button onclick="removeTemplate()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                        <i class="fas fa-trash mr-2"></i>Remove
                                    </button>
                                </div>
                                
                                <div class="bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg p-3">
                                    <div class="flex items-start space-x-2">
                                        <i class="fas fa-info-circle text-blue-400 mt-0.5"></i>
                                        <div class="text-blue-200 text-sm">
                                            <p class="font-medium mb-1">Template Features:</p>
                                            <ul class="text-xs space-y-1">
                                                <li>• Auto-detects colors, fonts, and layout</li>
                                                <li>• Preserves professional formatting</li>
                                                <li>• Maintains A4 print compatibility</li>
                                                <li>• Supports company branding</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Template Settings -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Template Settings</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Current Template</label>
                                    <div class="bg-gray-700 rounded-lg p-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-gray-100" id="currentTemplateName">Default Professional Template</span>
                                            <span class="px-2 py-1 bg-green-900 text-green-300 text-xs rounded-full">Active</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Template Style</label>
                                    <select id="templateStyle" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                        <option value="professional">Professional (Current)</option>
                                        <option value="modern">Modern Minimalist</option>
                                        <option value="classic">Classic Business</option>
                                        <option value="custom">Custom Template</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Color Scheme</label>
                                    <div class="grid grid-cols-3 gap-2">
                                        <button class="h-8 bg-blue-600 rounded border-2 border-blue-400" onclick="setColorScheme('blue')" title="Blue Professional"></button>
                                        <button class="h-8 bg-green-600 rounded border-2 border-transparent" onclick="setColorScheme('green')" title="Green Business"></button>
                                        <button class="h-8 bg-purple-600 rounded border-2 border-transparent" onclick="setColorScheme('purple')" title="Purple Modern"></button>
                                        <button class="h-8 bg-gray-600 rounded border-2 border-transparent" onclick="setColorScheme('gray')" title="Gray Classic"></button>
                                        <button class="h-8 bg-red-600 rounded border-2 border-transparent" onclick="setColorScheme('red')" title="Red Corporate"></button>
                                        <button class="h-8 bg-yellow-600 rounded border-2 border-transparent" onclick="setColorScheme('yellow')" title="Gold Premium"></button>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="text-gray-100 font-medium">Auto-fit Content</p>
                                        <p class="text-gray-400 text-sm">Automatically adjust content to fit A4</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <button onclick="saveTemplateSettings()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Save Template Settings
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Import Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Product Import -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">Import Products</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Product Data</label>
                                    <textarea id="productImportData" rows="8" placeholder="Enter products in format: Product Name-Category-Price (optional)&#10;Example:&#10;Wireless Headphones-Electronics-299.99&#10;Cotton Shirt-Clothing&#10;Garden Hose-Home & Garden-45.50" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100"></textarea>
                                    <p class="text-gray-400 text-xs mt-1">Format: Product Name-Category-Price (price optional, one per line)</p>
                                    <p class="text-gray-400 text-xs">Stock will be set to 9999, price can be manually entered or set during import</p>
                                </div>
                                
                                <button onclick="importProducts()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                    <i class="fas fa-file-import mr-2"></i>Import Products
                                </button>
                            </div>
                        </div>

                        <!-- System Preferences -->
                        <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-100 mb-4">System Preferences</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Currency</label>
                                    <select id="systemCurrency" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                        <option value="BDT" selected>BDT (৳)</option>
                                        <option value="USD">USD ($)</option>
                                        <option value="EUR">EUR (€)</option>
                                        <option value="GBP">GBP (£)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Date Format</label>
                                    <select id="dateFormat" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Time Zone</label>
                                    <select id="timeZone" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100">
                                        <option value="EST">Eastern Standard Time</option>
                                        <option value="CST">Central Standard Time</option>
                                        <option value="MST">Mountain Standard Time</option>
                                        <option value="PST">Pacific Standard Time</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="text-gray-100 font-medium">Dark Mode</p>
                                        <p class="text-gray-400 text-sm">Use dark theme for the interface</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <button onclick="saveSystemPreferences()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Save Preferences
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Browser Memory Storage Section -->
                    <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700 mb-6">
                        <h3 class="text-lg font-semibold text-gray-100 mb-4">
                            <i class="fas fa-database mr-2 text-green-400"></i>Browser Memory Storage
                        </h3>
                        <div class="bg-green-900 bg-opacity-30 border border-green-700 rounded-lg p-4 mb-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-info-circle text-green-400 mt-0.5"></i>
                                <div class="text-green-200 text-sm">
                                    <p class="font-medium mb-2">Browser Memory Features:</p>
                                    <ul class="text-xs space-y-1 list-disc list-inside">
                                        <li>Auto-saves data when you make changes</li>
                                        <li>Works completely offline - no internet needed</li>
                                        <li>Data persists between browser sessions</li>
                                        <li>Perfect for single-device usage</li>
                                        <li>Instant save and load operations</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-200 mb-3">Storage Status</h4>
                                <div id="browserStorageStatus">
                                    <!-- Status will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h4 class="font-medium text-gray-200 mb-3">Quick Actions</h4>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-300">Auto-Save</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="autoSaveToggle" class="sr-only peer" checked onchange="toggleAutoSave()">
                                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="manualSaveData()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-save mr-2"></i>Save Now
                            </button>
                            <button onclick="loadDataFromBrowser()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-download mr-2"></i>Load Data
                            </button>
                            <button onclick="clearBrowserMemory()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-trash mr-2"></i>Clear Memory
                            </button>
                        </div>
                    </div>

                    <!-- Cloud Sync Section -->
                    <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700 mb-6">
                        <h3 class="text-lg font-semibold text-gray-100 mb-4">
                            <i class="fas fa-cloud mr-2 text-blue-400"></i>OneDrive Cloud Sync
                        </h3>
                        <div class="bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg p-4 mb-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-info-circle text-blue-400 mt-0.5"></i>
                                <div class="text-blue-200 text-sm">
                                    <p class="font-medium mb-2">How OneDrive Sync Works:</p>
                                    <ol class="text-xs space-y-1 list-decimal list-inside">
                                        <li>Export creates "erp_backup.json" file in your Downloads folder</li>
                                        <li>Move this file to your OneDrive folder manually</li>
                                        <li>On other devices, download the file from OneDrive</li>
                                        <li>Use Import to load the data into the software</li>
                                        <li>All your products, customers, and invoices will sync!</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <h4 class="font-medium text-gray-200">Export to OneDrive</h4>
                                <button onclick="exportToOneDrive()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                    <i class="fas fa-cloud-upload-alt mr-2"></i>Export All Data
                                </button>
                                <p class="text-gray-400 text-xs">Creates erp_backup.json file for OneDrive</p>
                            </div>
                            
                            <div class="space-y-3">
                                <h4 class="font-medium text-gray-200">Import from OneDrive</h4>
                                <input type="file" id="oneDriveImport" accept=".json" class="hidden" onchange="importFromOneDrive(event)">
                                <button onclick="document.getElementById('oneDriveImport').click()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                    <i class="fas fa-cloud-download-alt mr-2"></i>Import All Data
                                </button>
                                <p class="text-gray-400 text-xs">Select erp_backup.json from OneDrive</p>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-yellow-900 bg-opacity-30 border border-yellow-700 rounded-lg">
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-exclamation-triangle text-yellow-400 mt-0.5"></i>
                                <div class="text-yellow-200 text-xs">
                                    <p class="font-medium">Important:</p>
                                    <p>Import will replace ALL current data. Make sure to export current data first if needed.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div id="cloudSyncStatus">
                                <!-- Cloud sync status will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Storage Comparison Table -->
                    <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700 mb-6">
                        <h3 class="text-lg font-semibold text-gray-100 mb-4">
                            <i class="fas fa-chart-bar mr-2 text-purple-400"></i>Storage Options Comparison
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border border-gray-600 rounded-lg">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Feature</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-300 uppercase">
                                            <i class="fas fa-database text-green-400 mr-1"></i>Browser Memory
                                        </th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-300 uppercase">
                                            <i class="fas fa-cloud text-blue-400 mr-1"></i>OneDrive Cloud
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-800 divide-y divide-gray-700">
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-300">Internet Required</td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-times text-red-400"></i>
                                            <span class="text-xs text-gray-400 block">Offline</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span class="text-xs text-gray-400 block">Online</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-300">Auto-Save</td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span class="text-xs text-gray-400 block">Automatic</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-times text-red-400"></i>
                                            <span class="text-xs text-gray-400 block">Manual</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-300">Multi-Device Sync</td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-times text-red-400"></i>
                                            <span class="text-xs text-gray-400 block">Single Device</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span class="text-xs text-gray-400 block">All Devices</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-300">Data Backup</td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                            <span class="text-xs text-gray-400 block">Browser Only</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span class="text-xs text-gray-400 block">Cloud Safe</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-300">Speed</td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-bolt text-green-400"></i>
                                            <span class="text-xs text-gray-400 block">Instant</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <i class="fas fa-clock text-yellow-400"></i>
                                            <span class="text-xs text-gray-400 block">Manual Steps</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-300">Best For</td>
                                        <td class="px-4 py-3 text-center text-xs text-gray-400">Daily Operations</td>
                                        <td class="px-4 py-3 text-center text-xs text-gray-400">Backup & Sync</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4 p-4 bg-purple-900 bg-opacity-30 border border-purple-700 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-lightbulb text-purple-400 mt-0.5"></i>
                                <div class="text-purple-200 text-sm">
                                    <p class="font-medium mb-2">💡 Recommended Usage:</p>
                                    <ul class="text-xs space-y-1 list-disc list-inside">
                                        <li><strong>Browser Memory:</strong> Use for daily work - fast, automatic, always available</li>
                                        <li><strong>OneDrive Cloud:</strong> Use for backup and syncing between multiple devices</li>
                                        <li><strong>Best Practice:</strong> Enable auto-save for daily use + periodic cloud backup</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Export Section -->
                    <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-100 mb-4">Individual Data Export</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="exportData('products')" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-download mr-2"></i>Export Products
                            </button>
                            <button onclick="exportData('customers')" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-download mr-2"></i>Export Customers
                            </button>
                            <button onclick="exportData('invoices')" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                                <i class="fas fa-download mr-2"></i>Export Invoices
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden"></div>

    <!-- Notification Tablet -->
    <div id="notificationTablet" class="fixed top-4 right-4 z-50 w-80 max-h-96 overflow-y-auto hidden">
        <div class="bg-gray-800 rounded-lg shadow-2xl border border-gray-700">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-100">Notifications</h3>
                <button onclick="closeNotificationTablet()" class="text-gray-400 hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notificationContent" class="p-4 space-y-3 max-h-80 overflow-y-auto">
                <!-- Notifications will be populated here -->
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeUserModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl border border-gray-700 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100" id="userModalTitle">Add New User</h3>
                        <button onclick="closeUserModal()" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="userForm" class="p-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">User ID</label>
                            <input type="text" id="userId" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Role</label>
                            <select id="userRole" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                                <option value="">Select Role</option>
                                <option value="Administrator">Administrator</option>
                                <option value="Manager">Manager</option>
                                <option value="Employee">Employee</option>
                                <option value="Sales Rep">Sales Rep</option>
                                <option value="Accountant">Accountant</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                            <input type="text" id="userName" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                            <input type="text" id="userUsername" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                            <input type="email" id="userEmail" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                            <input type="tel" id="userPhone" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                            <input type="password" id="userPassword" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Confirm Password</label>
                            <input type="password" id="userConfirmPassword" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                    </div>
                    
                    <!-- Signature Upload Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Digital Signature</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <div class="flex items-center justify-center w-full h-32 bg-gray-700 rounded-lg border-2 border-dashed border-gray-600" id="signaturePreview">
                                    <div class="text-center">
                                        <i class="fas fa-signature text-gray-500 text-2xl mb-2"></i>
                                        <p class="text-gray-400 text-sm">No Signature</p>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <input type="file" id="signatureUpload" accept="image/*" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onchange="handleSignatureUpload(event)">
                                    <p class="text-gray-400 text-xs mt-1">Recommended: 300x100px, PNG with transparent background</p>
                                </div>
                                <div class="flex gap-2">
                                    <button type="button" onclick="uploadSignature()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg transition duration-200 text-sm">
                                        <i class="fas fa-upload mr-1"></i>Upload
                                    </button>
                                    <button type="button" onclick="removeSignature()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded-lg transition duration-200 text-sm">
                                        <i class="fas fa-trash mr-1"></i>Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Account Status</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="userStatus" value="Active" class="text-blue-600 bg-gray-700 border-gray-600 focus:ring-blue-500" checked>
                                <span class="ml-2 text-gray-300">Active</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="userStatus" value="Inactive" class="text-blue-600 bg-gray-700 border-gray-600 focus:ring-blue-500">
                                <span class="ml-2 text-gray-300">Inactive</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <span id="userSubmitText">Add User</span>
                        </button>
                        <button type="button" onclick="closeUserModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeProductModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md border border-gray-700" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100" id="productModalTitle">Add New Product</h3>
                        <button onclick="closeProductModal()" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="productForm" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Product Code</label>
                        <input type="text" id="productCode" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" readonly>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Product Name</label>
                        <input type="text" id="productName" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Category</label>
                        <select id="productCategory" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                            <option value="">Select Category</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Books">Books</option>
                            <option value="Home & Garden">Home & Garden</option>
                            <option value="Sports">Sports</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Automotive">Automotive</option>
                            <option value="Health & Beauty">Health & Beauty</option>
                            <option value="Toys & Games">Toys & Games</option>
                            <option value="Food & Beverages">Food & Beverages</option>
                            <option value="Office Supplies">Office Supplies</option>
                            <option value="Tools & Hardware">Tools & Hardware</option>
                            <option value="Pet Supplies">Pet Supplies</option>
                            <option value="Music & Instruments">Music & Instruments</option>
                            <option value="Art & Crafts">Art & Crafts</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Price (৳)</label>
                        <input type="number" id="productPrice" step="0.01" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Stock Quantity</label>
                        <input type="number" id="productStock" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <span id="productSubmitText">Add Product</span>
                        </button>
                        <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeCustomerModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md border border-gray-700" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100" id="customerModalTitle">Add New Customer</h3>
                        <button onclick="closeCustomerModal()" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="customerForm" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Customer ID</label>
                        <input type="text" id="customerId" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" readonly>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                        <input type="text" id="customerName" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                        <input type="email" id="customerEmail" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                        <input type="tel" id="customerPhone" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                        <textarea id="customerAddress" rows="3" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required></textarea>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <span id="customerSubmitText">Add Customer</span>
                        </button>
                        <button type="button" onclick="closeCustomerModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Customer Profile Modal -->
    <div id="customerProfileModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeCustomerProfileModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl border border-gray-700 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100">Customer Profile</h3>
                        <button onclick="closeCustomerProfileModal()" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6" id="customerProfileContent">
                    <!-- Profile content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Product View Modal -->
    <div id="productViewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeProductViewModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md border border-gray-700" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100">Product Details</h3>
                        <button onclick="closeProductViewModal()" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6" id="productViewContent">
                    <!-- Product details will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeInvoiceModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-6xl border border-gray-700 max-h-[95vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100" id="invoiceModalTitle">Create New Invoice</h3>
                        <button onclick="closeInvoiceModal()" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="invoiceForm" class="p-6">
                    <!-- Invoice Header -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Invoice Number</label>
                            <input type="text" id="invoiceNumber" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Date</label>
                            <input type="date" id="invoiceDate" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" required>
                        </div>
                    </div>

                    <!-- Customer Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Customer</label>
                        <div class="relative">
                            <input type="text" id="customerSearchInput" placeholder="Search customer by name or ID..." class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onkeyup="searchCustomers()" required>
                            <div id="customerSearchResults" class="absolute top-full left-0 right-0 bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-40 overflow-y-auto z-10 hidden"></div>
                        </div>
                        <input type="hidden" id="selectedCustomerId">
                        <div id="selectedCustomerInfo" class="mt-2 p-3 bg-gray-700 rounded-lg hidden">
                            <!-- Selected customer info will be displayed here -->
                        </div>
                    </div>

                    <!-- Product Search and Add -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Add Products</label>
                        <div class="relative">
                            <input type="text" id="productSearchInput" placeholder="Search product by name or code... (Press Enter to select first result)" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-100" onkeyup="searchProducts()" onkeydown="handleProductSearch(event)">
                            <div id="productSearchResults" class="absolute top-full left-0 right-0 bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-40 overflow-y-auto z-10 hidden"></div>
                        </div>
                    </div>

                    <!-- Selected Products Table -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-100 mb-4">Invoice Items</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full border border-gray-600 rounded-lg">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Product</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Code</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Qty</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Price</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Total</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceItemsTable" class="bg-gray-800 divide-y divide-gray-700">
                                    <!-- Invoice items will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Adjustments -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-100 mb-4">Adjustments</h4>
                        <div class="space-y-3" id="adjustmentsList">
                            <!-- Adjustments will be populated here -->
                        </div>
                        <button type="button" onclick="addAdjustment()" class="mt-3 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Add Adjustment
                        </button>
                    </div>

                    <!-- Invoice Summary -->
                    <div class="bg-gray-700 rounded-lg p-6 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div></div>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Subtotal:</span>
                                    <span class="text-gray-100" id="invoiceSubtotal">$0.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Adjustments:</span>
                                    <span class="text-gray-100" id="invoiceAdjustments">$0.00</span>
                                </div>
                                <div class="border-t border-gray-600 pt-2">
                                    <div class="flex justify-between text-lg font-semibold">
                                        <span class="text-gray-100">Total:</span>
                                        <span class="text-green-400" id="invoiceTotal">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-3">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-save mr-2"></i><span id="invoiceSubmitText">Save Invoice</span>
                        </button>
                        <button type="button" onclick="downloadInvoicePDF()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-file-pdf mr-2"></i>Download PDF
                        </button>
                        <button type="button" onclick="printInvoice()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-print mr-2"></i>Print
                        </button>
                        <button type="button" onclick="closeInvoiceModal()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Invoice View Modal -->
    <div id="invoiceViewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-backdrop" onclick="closeInvoiceViewModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl border border-gray-700 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="p-6 border-b border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-100">Invoice Details</h3>
                        <div class="flex gap-2">
                            <button onclick="downloadInvoicePDF()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded text-sm transition duration-200">
                                <i class="fas fa-file-pdf mr-1"></i>PDF
                            </button>
                            <button onclick="printInvoice()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-3 rounded text-sm transition duration-200">
                                <i class="fas fa-print mr-1"></i>Print
                            </button>
                            <button onclick="closeInvoiceViewModal()" class="text-gray-400 hover:text-gray-200">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6" id="invoiceViewContent">
                    <!-- Invoice details will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data - Starting fresh
        let products = [];
        let customers = [];
        let invoices = [];

        let users = [
            { 
                id: 'USR001', 
                name: 'Admin User', 
                username: 'admin',
                email: 'admin@kamalson.com', 
                phone: '+880 1234 567890',
                password: 'admin',
                role: 'Administrator', 
                status: 'Active',
                signature: null,
                createdDate: '2024-01-01'
            },
            { 
                id: 'USR002', 
                name: 'John Manager', 
                username: 'john.manager',
                email: 'john.manager@sayedslamp.com', 
                phone: '+1 234 567 8901',
                password: 'manager123',
                role: 'Manager', 
                status: 'Active',
                signature: null,
                createdDate: '2024-01-02'
            },
            { 
                id: 'USR003', 
                name: 'Jane Employee', 
                username: 'jane.employee',
                email: 'jane.employee@sayedslamp.com', 
                phone: '+1 234 567 8902',
                password: 'employee123',
                role: 'Employee', 
                status: 'Active',
                signature: null,
                createdDate: '2024-01-03'
            },
            { 
                id: 'USR004', 
                name: 'Mike Sales', 
                username: 'mike.sales',
                email: 'mike.sales@sayedslamp.com', 
                phone: '+1 234 567 8903',
                password: 'sales123',
                role: 'Sales Rep', 
                status: 'Inactive',
                signature: null,
                createdDate: '2024-01-04'
            }
        ];

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check against all users in the system
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                if (user.status === 'Inactive') {
                    alert('Your account has been deactivated. Please contact administrator.');
                    return;
                }
                
                // Store current logged-in user
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                showPage('dashboard');
                loadProducts();
                loadCustomers();
                loadInvoices();
                loadUsers();
                
                // Update header with user info
                const userInitial = user.name.charAt(0).toUpperCase();
                const userDisplayName = user.name.split(' ')[0]; // First name only
                document.querySelector('.w-8.h-8.bg-blue-600 span').textContent = userInitial;
                document.querySelector('.text-gray-300.font-medium').textContent = userDisplayName;
                
                showNotification(`Welcome back, ${user.name}!`, 'success');
            } else {
                alert('Invalid username or password. Please try again.');
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        // Sidebar toggle for mobile
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        // Close sidebar when clicking overlay
        document.getElementById('sidebarOverlay').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // Page navigation
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            
            const targetPage = document.getElementById(pageId + 'Page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
            }
            
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('bg-gray-700', 'text-blue-400');
                link.classList.add('text-gray-300');
            });
            
            const activeLink = document.querySelector(`[onclick="showPage('${pageId}')"]`);
            if (activeLink) {
                activeLink.classList.remove('text-gray-300');
                activeLink.classList.add('bg-gray-700', 'text-blue-400');
            }
            
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        }

        // Load Products
        function loadProducts() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';
            
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                const stockClass = product.stock <= 10 ? 'text-red-400' : 'text-gray-300';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">${product.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${product.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${product.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">৳${product.price.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${stockClass}">${product.stock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewProduct(${index})" class="text-green-400 hover:text-green-300 mr-3">View</button>
                        <button onclick="editProduct(${index})" class="text-blue-400 hover:text-blue-300 mr-3">Edit</button>
                        <button onclick="deleteProduct(${index})" class="text-red-400 hover:text-red-300">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load Customers
        function loadCustomers() {
            const tbody = document.getElementById('customersTableBody');
            tbody.innerHTML = '';
            
            // Update customer data with accurate totals from invoices
            customers.forEach(customer => {
                const customerInvoices = invoices.filter(invoice => invoice.customerId === customer.id);
                customer.totalSpent = customerInvoices.reduce((sum, invoice) => sum + invoice.amount, 0);
                const lastInvoice = customerInvoices.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                customer.lastPurchase = lastInvoice ? lastInvoice.date : 'No purchases yet';
            });
            
            customers.forEach((customer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">${customer.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${customer.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${customer.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${customer.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">৳${customer.totalSpent.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${customer.lastPurchase}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewCustomerProfile(${index})" class="text-green-400 hover:text-green-300 mr-3">Profile</button>
                        <button onclick="editCustomer(${index})" class="text-blue-400 hover:text-blue-300 mr-3">Edit</button>
                        <button onclick="deleteCustomer(${index})" class="text-red-400 hover:text-red-300">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load Invoices
        function loadInvoices() {
            const tbody = document.getElementById('invoicesTableBody');
            tbody.innerHTML = '';
            
            invoices.forEach((invoice, index) => {
                const row = document.createElement('tr');
                let statusClass = 'bg-green-900 text-green-300';
                if (invoice.status === 'Pending') statusClass = 'bg-yellow-900 text-yellow-300';
                if (invoice.status === 'Overdue') statusClass = 'bg-red-900 text-red-300';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">${invoice.number}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${invoice.customer}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${invoice.customerId}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${invoice.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">৳${invoice.amount.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${invoice.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewInvoice(${index})" class="text-blue-400 hover:text-blue-300 mr-3">View</button>
                        <button onclick="editInvoice(${index})" class="text-green-400 hover:text-green-300 mr-3">Edit</button>
                        <button onclick="deleteInvoice(${index})" class="text-red-400 hover:text-red-300">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load Users
        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            users.forEach((user, index) => {
                const row = document.createElement('tr');
                const statusClass = user.status === 'Active' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">${user.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white text-sm font-semibold">${user.name.charAt(0)}</span>
                            </div>
                            ${user.name}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${user.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${user.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${user.role}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${user.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewUser(${index})" class="text-green-400 hover:text-green-300 mr-3">View</button>
                        <button onclick="editUser(${index})" class="text-blue-400 hover:text-blue-300 mr-3">Edit</button>
                        <button onclick="toggleUserStatus(${index})" class="text-yellow-400 hover:text-yellow-300 mr-3">
                            ${user.status === 'Active' ? 'Deactivate' : 'Activate'}
                        </button>
                        <button onclick="deleteUser(${index})" class="text-red-400 hover:text-red-300">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Filter functions
        function filterProducts() {
            const search = document.getElementById('productSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const tbody = document.getElementById('productsTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const productName = rows[i].cells[1].textContent.toLowerCase();
                const productCode = rows[i].cells[0].textContent.toLowerCase();
                const productCategory = rows[i].cells[2].textContent;
                
                const matchesSearch = productName.includes(search) || productCode.includes(search);
                const matchesCategory = !categoryFilter || productCategory === categoryFilter;
                
                if (matchesSearch && matchesCategory) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

        function filterCustomers() {
            const search = document.getElementById('customerSearch').value.toLowerCase();
            const tbody = document.getElementById('customersTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const customerName = rows[i].cells[1].textContent.toLowerCase();
                const customerEmail = rows[i].cells[2].textContent.toLowerCase();
                const customerId = rows[i].cells[0].textContent.toLowerCase();
                
                if (customerName.includes(search) || customerEmail.includes(search) || customerId.includes(search)) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

        function filterInvoices() {
            const search = document.getElementById('invoiceSearch').value.toLowerCase();
            const tbody = document.getElementById('invoicesTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const invoiceNumber = rows[i].cells[0].textContent.toLowerCase();
                const customerName = rows[i].cells[1].textContent.toLowerCase();
                const customerId = rows[i].cells[2].textContent.toLowerCase();
                
                if (invoiceNumber.includes(search) || customerName.includes(search) || customerId.includes(search)) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

        function filterUsers() {
            const search = document.getElementById('userSearch').value.toLowerCase();
            const tbody = document.getElementById('usersTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const userName = rows[i].cells[1].textContent.toLowerCase();
                const userEmail = rows[i].cells[2].textContent.toLowerCase();
                
                if (userName.includes(search) || userEmail.includes(search)) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

        // Global variables for editing
        let editingProductIndex = -1;
        let editingCustomerIndex = -1;

        // Product CRUD operations
        function openProductModal() {
            editingProductIndex = -1;
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('productSubmitText').textContent = 'Add Product';
            document.getElementById('productCode').value = generateProductCode();
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productStock').value = '';
            document.getElementById('productModal').classList.remove('hidden');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        function generateProductCode() {
            const prefix = 'PRD';
            const number = (products.length + 1).toString().padStart(3, '0');
            return prefix + number;
        }

        function viewProduct(index) {
            const product = products[index];
            const content = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Product Code</label>
                            <p class="text-gray-100 font-semibold">${product.code}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Category</label>
                            <p class="text-gray-100">${product.category}</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Product Name</label>
                        <p class="text-gray-100 font-semibold text-lg">${product.name}</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Price</label>
                            <p class="text-green-400 font-bold text-xl">৳${product.price.toFixed(2)}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Stock</label>
                            <p class="text-gray-100 font-semibold ${product.stock <= 10 ? 'text-red-400' : 'text-gray-100'}">${product.stock} units</p>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('productViewContent').innerHTML = content;
            document.getElementById('productViewModal').classList.remove('hidden');
        }

        function closeProductViewModal() {
            document.getElementById('productViewModal').classList.add('hidden');
        }

        function editProduct(index) {
            editingProductIndex = index;
            const product = products[index];
            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('productSubmitText').textContent = 'Update Product';
            document.getElementById('productCode').value = product.code;
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productModal').classList.remove('hidden');
        }

        function deleteProduct(index) { 
            if (confirm(`Delete product: ${products[index].name}?`)) {
                products.splice(index, 1);
                loadProducts();
            }
        }

        // Customer CRUD operations
        function openCustomerModal() {
            editingCustomerIndex = -1;
            document.getElementById('customerModalTitle').textContent = 'Add New Customer';
            document.getElementById('customerSubmitText').textContent = 'Add Customer';
            document.getElementById('customerId').value = generateCustomerId();
            document.getElementById('customerName').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerModal').classList.remove('hidden');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.add('hidden');
        }

        function generateCustomerId() {
            const prefix = 'CUS';
            const number = (customers.length + 1).toString().padStart(3, '0');
            return prefix + number;
        }

        function viewCustomerProfile(index) {
            const customer = customers[index];
            
            // Get actual customer invoices and calculate real totals
            const customerInvoices = invoices.filter(invoice => invoice.customerId === customer.id);
            const actualTotalSpent = customerInvoices.reduce((sum, invoice) => sum + invoice.amount, 0);
            const lastInvoice = customerInvoices.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
            const lastPurchaseDate = lastInvoice ? lastInvoice.date : 'No purchases yet';
            
            // Update customer data with accurate information
            customer.totalSpent = actualTotalSpent;
            customer.lastPurchase = lastPurchaseDate;
            
            const content = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1">
                        <div class="bg-gray-700 rounded-lg p-6">
                            <div class="text-center mb-4">
                                <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="text-white text-2xl font-bold">${customer.name.charAt(0)}</span>
                                </div>
                                <h4 class="text-xl font-semibold text-gray-100">${customer.name}</h4>
                                <p class="text-gray-400">${customer.id}</p>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300">Email</label>
                                    <p class="text-gray-100">${customer.email}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300">Phone</label>
                                    <p class="text-gray-100">${customer.phone}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300">Address</label>
                                    <p class="text-gray-100">${customer.address}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-2">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-300 mb-1">Total Spent</h5>
                                <p class="text-2xl font-bold text-green-400">৳${actualTotalSpent.toFixed(2)}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-300 mb-1">Total Orders</h5>
                                <p class="text-2xl font-bold text-blue-400">${customerInvoices.length}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-300 mb-1">Last Purchase</h5>
                                <p class="text-lg font-semibold text-gray-100">${lastPurchaseDate}</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-lg font-semibold text-gray-100">Purchase History</h5>
                                <span class="text-sm text-gray-400">${customerInvoices.length} invoices</span>
                            </div>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                ${customerInvoices.length > 0 ? customerInvoices.map(invoice => `
                                    <div class="flex justify-between items-center p-3 bg-gray-600 rounded-lg hover:bg-gray-500 cursor-pointer" onclick="viewInvoiceFromProfile('${invoice.number}')">
                                        <div>
                                            <p class="text-gray-100 font-medium">${invoice.number}</p>
                                            <p class="text-gray-400 text-sm">${new Date(invoice.date).toLocaleDateString()}</p>
                                            <p class="text-gray-400 text-xs">${invoice.items.length} items</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-green-400 font-semibold">৳${invoice.amount.toFixed(2)}</span>
                                            <p class="text-xs px-2 py-1 rounded-full ${invoice.status === 'Paid' ? 'bg-green-900 text-green-300' : invoice.status === 'Pending' ? 'bg-yellow-900 text-yellow-300' : 'bg-red-900 text-red-300'}">${invoice.status}</p>
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div class="text-center py-8">
                                        <i class="fas fa-receipt text-gray-500 text-3xl mb-3"></i>
                                        <p class="text-gray-400">No purchase history yet</p>
                                        <p class="text-gray-500 text-sm">Invoices will appear here once created</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('customerProfileContent').innerHTML = content;
            document.getElementById('customerProfileModal').classList.remove('hidden');
        }
        
        function viewInvoiceFromProfile(invoiceNumber) {
            const invoiceIndex = invoices.findIndex(inv => inv.number === invoiceNumber);
            if (invoiceIndex >= 0) {
                closeCustomerProfileModal();
                viewInvoice(invoiceIndex);
            }
        }

        function closeCustomerProfileModal() {
            document.getElementById('customerProfileModal').classList.add('hidden');
        }

        function editCustomer(index) {
            editingCustomerIndex = index;
            const customer = customers[index];
            document.getElementById('customerModalTitle').textContent = 'Edit Customer';
            document.getElementById('customerSubmitText').textContent = 'Update Customer';
            document.getElementById('customerId').value = customer.id;
            document.getElementById('customerName').value = customer.name;
            document.getElementById('customerEmail').value = customer.email;
            document.getElementById('customerPhone').value = customer.phone;
            document.getElementById('customerAddress').value = customer.address;
            document.getElementById('customerModal').classList.remove('hidden');
        }

        function deleteCustomer(index) { 
            if (confirm(`Delete customer: ${customers[index].name}?`)) {
                customers.splice(index, 1);
                loadCustomers();
            }
        }

        // Print functions
        function printProducts() {
            const printWindow = window.open('', '_blank');
            const productsHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Products List - Sayed's Lamp</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .company-name { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
                        .report-title { font-size: 18px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .low-stock { color: #d32f2f; font-weight: bold; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="company-name">Sayed's Lamp</div>
                        <div class="report-title">Products Inventory Report</div>
                        <div>Generated on: ${new Date().toLocaleDateString()}</div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${products.map(product => `
                                <tr>
                                    <td>${product.code}</td>
                                    <td>${product.name}</td>
                                    <td>${product.category}</td>
                                    <td>৳${product.price.toFixed(2)}</td>
                                    <td class="${product.stock <= 10 ? 'low-stock' : ''}">${product.stock}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>Total Products: ${products.length}</p>
                        <p>Low Stock Items: ${products.filter(p => p.stock <= 10).length}</p>
                    </div>
                </body>
                </html>
            `;
            printWindow.document.write(productsHtml);
            printWindow.document.close();
            printWindow.print();
        }

        function printCustomers() {
            const printWindow = window.open('', '_blank');
            const customersHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Customers List - Sayed's Lamp</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .company-name { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
                        .report-title { font-size: 18px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="company-name">Sayed's Lamp</div>
                        <div class="report-title">Customers Report</div>
                        <div>Generated on: ${new Date().toLocaleDateString()}</div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Total Spent</th>
                                <th>Last Purchase</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${customers.map(customer => `
                                <tr>
                                    <td>${customer.id}</td>
                                    <td>${customer.name}</td>
                                    <td>${customer.email}</td>
                                    <td>${customer.phone}</td>
                                    <td>৳${customer.totalSpent.toFixed(2)}</td>
                                    <td>${customer.lastPurchase}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>Total Customers: ${customers.length}</p>
                        <p>Total Revenue: ৳${customers.reduce((sum, c) => sum + c.totalSpent, 0).toFixed(2)}</p>
                    </div>
                </body>
                </html>
            `;
            printWindow.document.write(customersHtml);
            printWindow.document.close();
            printWindow.print();
        }

        // Form submissions
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const productData = {
                code: document.getElementById('productCode').value,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value)
            };
            
            if (editingProductIndex >= 0) {
                products[editingProductIndex] = productData;
            } else {
                products.push(productData);
            }
            
            loadProducts();
            autoSaveData(); // Auto-save after product changes
            closeProductModal();
        });

        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerData = {
                id: document.getElementById('customerId').value,
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value,
                address: document.getElementById('customerAddress').value,
                totalSpent: editingCustomerIndex >= 0 ? customers[editingCustomerIndex].totalSpent : 0,
                lastPurchase: editingCustomerIndex >= 0 ? customers[editingCustomerIndex].lastPurchase : 'N/A',
                purchases: editingCustomerIndex >= 0 ? customers[editingCustomerIndex].purchases : []
            };
            
            if (editingCustomerIndex >= 0) {
                customers[editingCustomerIndex] = customerData;
            } else {
                customers.push(customerData);
            }
            
            loadCustomers();
            autoSaveData(); // Auto-save after customer changes
            closeCustomerModal();
        });

        // Global variables for invoice management
        let editingInvoiceIndex = -1;
        let currentInvoiceItems = [];
        let currentAdjustments = [];
        let selectedProductIndex = -1;

        // Invoice CRUD operations
        function openInvoiceModal() {
            editingInvoiceIndex = -1;
            currentInvoiceItems = [];
            currentAdjustments = [];
            document.getElementById('invoiceModalTitle').textContent = 'Create New Invoice';
            document.getElementById('invoiceSubmitText').textContent = 'Save Invoice';
            document.getElementById('invoiceNumber').value = generateInvoiceNumber();
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('customerSearchInput').value = '';
            document.getElementById('selectedCustomerId').value = '';
            document.getElementById('selectedCustomerInfo').classList.add('hidden');
            document.getElementById('productSearchInput').value = '';
            clearInvoiceItems();
            clearAdjustments();
            updateInvoiceTotals();
            document.getElementById('invoiceModal').classList.remove('hidden');
        }

        function closeInvoiceModal() {
            document.getElementById('invoiceModal').classList.add('hidden');
        }

        function generateInvoiceNumber() {
            const prefix = 'INV-';
            const number = (invoices.length + 1).toString().padStart(3, '0');
            return prefix + number;
        }

        function searchCustomers() {
            const search = document.getElementById('customerSearchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('customerSearchResults');
            
            if (search.length < 2) {
                resultsDiv.classList.add('hidden');
                return;
            }
            
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(search) || 
                customer.id.toLowerCase().includes(search)
            );
            
            if (filteredCustomers.length > 0) {
                resultsDiv.innerHTML = filteredCustomers.map(customer => `
                    <div class="p-3 hover:bg-gray-600 cursor-pointer border-b border-gray-600 last:border-b-0" onclick="selectCustomer('${customer.id}')">
                        <div class="font-medium text-gray-100">${customer.name}</div>
                        <div class="text-sm text-gray-400">${customer.id} - ${customer.email}</div>
                    </div>
                `).join('');
                resultsDiv.classList.remove('hidden');
            } else {
                resultsDiv.innerHTML = '<div class="p-3 text-gray-400">No customers found</div>';
                resultsDiv.classList.remove('hidden');
            }
        }

        function selectCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                document.getElementById('customerSearchInput').value = customer.name;
                document.getElementById('selectedCustomerId').value = customer.id;
                document.getElementById('selectedCustomerInfo').innerHTML = `
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-gray-400">ID:</span> <span class="text-gray-100">${customer.id}</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Email:</span> <span class="text-gray-100">${customer.email}</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Phone:</span> <span class="text-gray-100">${customer.phone}</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Total Spent:</span> <span class="text-green-400">$${customer.totalSpent.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                document.getElementById('selectedCustomerInfo').classList.remove('hidden');
                document.getElementById('customerSearchResults').classList.add('hidden');
            }
        }

        let selectedSearchIndex = -1;

        function searchProducts() {
            const search = document.getElementById('productSearchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('productSearchResults');
            
            if (search.length < 1) {
                resultsDiv.classList.add('hidden');
                selectedSearchIndex = -1;
                return;
            }
            
            // Smart search with scoring
            const searchResults = products.map((product, index) => {
                let score = 0;
                const name = product.name.toLowerCase();
                const code = product.code.toLowerCase();
                
                // Exact match gets highest score
                if (name === search || code === search) score += 100;
                // Starts with search term
                else if (name.startsWith(search) || code.startsWith(search)) score += 50;
                // Contains search term
                else if (name.includes(search) || code.includes(search)) score += 25;
                
                // Boost score for shorter names (more relevant)
                if (score > 0) score += (50 - name.length);
                
                return { product, index, score };
            })
            .filter(item => item.score > 0)
            .sort((a, b) => b.score - a.score)
            .slice(0, 8); // Limit to 8 results for better UX
            
            selectedSearchIndex = -1;
            
            if (searchResults.length > 0) {
                resultsDiv.innerHTML = searchResults.map((item, resultIndex) => {
                    const isBestMatch = resultIndex === 0 && item.score >= 50;
                    return `
                        <div class="search-result p-3 hover:bg-gray-600 cursor-pointer border-b border-gray-600 last:border-b-0 ${resultIndex === 0 ? 'bg-gray-650' : ''}" 
                             onclick="selectProduct(${item.index})" data-index="${resultIndex}">
                            <div class="flex items-center justify-between">
                                <div class="font-medium text-gray-100 flex items-center">
                                    ${isBestMatch ? '<i class="fas fa-star text-yellow-400 mr-2"></i>' : ''}
                                    ${item.product.name}
                                </div>
                                ${isBestMatch ? '<span class="text-xs text-yellow-400 font-semibold">BEST MATCH</span>' : ''}
                            </div>
                            <div class="text-sm text-gray-400">${item.product.code} - ৳${item.product.price.toFixed(2)} (Stock: ${item.product.stock})</div>
                        </div>
                    `;
                }).join('');
                resultsDiv.classList.remove('hidden');
            } else {
                resultsDiv.innerHTML = '<div class="p-3 text-gray-400">No products found</div>';
                resultsDiv.classList.remove('hidden');
            }
        }

        function handleProductSearch(event) {
            const resultsDiv = document.getElementById('productSearchResults');
            const searchResults = resultsDiv.querySelectorAll('.search-result');
            
            if (event.key === 'ArrowDown') {
                event.preventDefault();
                selectedSearchIndex = Math.min(selectedSearchIndex + 1, searchResults.length - 1);
                updateSearchSelection(searchResults);
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                selectedSearchIndex = Math.max(selectedSearchIndex - 1, -1);
                updateSearchSelection(searchResults);
            } else if (event.key === 'Enter') {
                event.preventDefault();
                if (selectedSearchIndex >= 0 && searchResults[selectedSearchIndex]) {
                    searchResults[selectedSearchIndex].click();
                } else {
                    const firstResult = resultsDiv.querySelector('[onclick]');
                    if (firstResult) {
                        firstResult.click();
                    }
                }
            } else if (event.key === 'Escape') {
                resultsDiv.classList.add('hidden');
                selectedSearchIndex = -1;
            }
        }

        function updateSearchSelection(searchResults) {
            searchResults.forEach((result, index) => {
                if (index === selectedSearchIndex) {
                    result.classList.add('bg-blue-600');
                    result.classList.remove('bg-gray-650');
                } else if (index === 0) {
                    result.classList.add('bg-gray-650');
                    result.classList.remove('bg-blue-600');
                } else {
                    result.classList.remove('bg-blue-600', 'bg-gray-650');
                }
            });
        }

        function selectProduct(productIndex) {
            const product = products[productIndex];
            selectedProductIndex = productIndex;
            
            // Add product to invoice items
            const existingItemIndex = currentInvoiceItems.findIndex(item => item.code === product.code);
            
            if (existingItemIndex >= 0) {
                // Update existing item quantity
                currentInvoiceItems[existingItemIndex].qty += 1;
                currentInvoiceItems[existingItemIndex].total = currentInvoiceItems[existingItemIndex].qty * currentInvoiceItems[existingItemIndex].price;
            } else {
                // Add new item with price 0 (to be manually entered)
                currentInvoiceItems.push({
                    product: product.name,
                    code: product.code,
                    qty: 1,
                    price: 0,
                    total: 0
                });
            }
            
            document.getElementById('productSearchInput').value = '';
            document.getElementById('productSearchResults').classList.add('hidden');
            updateInvoiceItemsTable();
            updateInvoiceTotals();
            
            // Focus on quantity input for the newly added/updated item
            setTimeout(() => {
                const qtyInputs = document.querySelectorAll('.qty-input');
                if (qtyInputs.length > 0) {
                    if (existingItemIndex >= 0) {
                        // If updating existing item, focus on its quantity
                        qtyInputs[existingItemIndex].focus();
                        qtyInputs[existingItemIndex].select();
                    } else {
                        // If new item, focus on the last quantity input
                        const lastQtyInput = qtyInputs[qtyInputs.length - 1];
                        lastQtyInput.focus();
                        lastQtyInput.select();
                    }
                }
            }, 100);
        }

        function updateInvoiceItemsTable() {
            const tbody = document.getElementById('invoiceItemsTable');
            tbody.innerHTML = '';
            
            currentInvoiceItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 text-gray-100">${item.product}</td>
                    <td class="px-4 py-3 text-gray-300">${item.code}</td>
                    <td class="px-4 py-3">
                        <input type="number" class="qty-input w-20 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-gray-100" 
                               value="${item.qty}" min="1" onchange="updateItemQty(${index}, this.value)" 
                               onkeydown="handleQtyKeydown(event, ${index})" placeholder="Qty">
                    </td>
                    <td class="px-4 py-3">
                        <input type="number" class="price-input w-24 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-gray-100" 
                               value="${item.price > 0 ? item.price.toFixed(2) : ''}" step="0.01" min="0" onchange="updateItemPrice(${index}, this.value)"
                               onkeydown="handlePriceKeydown(event, ${index})" placeholder="৳0.00">
                    </td>
                    <td class="px-4 py-3 text-gray-100">৳${item.total.toFixed(2)}</td>
                    <td class="px-4 py-3">
                        <button onclick="removeInvoiceItem(${index})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function handleQtyKeydown(event, index) {
            if (event.key === 'Enter') {
                event.preventDefault();
                // Move to price input for the same row
                setTimeout(() => {
                    const priceInputs = document.querySelectorAll('.price-input');
                    if (priceInputs[index]) {
                        priceInputs[index].focus();
                        priceInputs[index].select();
                    }
                }, 50);
            }
        }

        function handlePriceKeydown(event, index) {
            if (event.key === 'Enter') {
                event.preventDefault();
                // Clear search and focus on product search for next item
                setTimeout(() => {
                    const productSearchInput = document.getElementById('productSearchInput');
                    productSearchInput.value = '';
                    productSearchInput.focus();
                    // Hide any open search results
                    document.getElementById('productSearchResults').classList.add('hidden');
                }, 50);
            }
        }

        function updateItemQty(index, qty) {
            currentInvoiceItems[index].qty = parseInt(qty) || 1;
            currentInvoiceItems[index].total = currentInvoiceItems[index].qty * currentInvoiceItems[index].price;
            updateInvoiceItemsTable();
            updateInvoiceTotals();
        }

        function updateItemPrice(index, price) {
            currentInvoiceItems[index].price = parseFloat(price) || 0;
            currentInvoiceItems[index].total = currentInvoiceItems[index].qty * currentInvoiceItems[index].price;
            updateInvoiceItemsTable();
            updateInvoiceTotals();
        }

        function removeInvoiceItem(index) {
            currentInvoiceItems.splice(index, 1);
            updateInvoiceItemsTable();
            updateInvoiceTotals();
        }

        function clearInvoiceItems() {
            currentInvoiceItems = [];
            updateInvoiceItemsTable();
        }

        function addAdjustment() {
            currentAdjustments.push({
                description: '',
                amount: 0
            });
            updateAdjustmentsList();
        }

        function updateAdjustmentsList() {
            const adjustmentsList = document.getElementById('adjustmentsList');
            adjustmentsList.innerHTML = '';
            
            currentAdjustments.forEach((adjustment, index) => {
                const adjustmentDiv = document.createElement('div');
                adjustmentDiv.className = 'flex gap-3 items-center';
                adjustmentDiv.innerHTML = `
                    <input type="text" placeholder="Description (e.g., Discount, Return, Damage)" 
                           class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-100" 
                           value="${adjustment.description}" onchange="updateAdjustmentDescription(${index}, this.value)">
                    <select class="adjustment-type-select px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-100" 
                            data-index="${index}" onchange="updateAdjustmentType(${index}, this.value)">
                        <option value="subtract" ${adjustment.amount < 0 ? 'selected' : ''}>Subtract (-)</option>
                        <option value="add" ${adjustment.amount >= 0 ? 'selected' : ''}>Add (+)</option>
                    </select>
                    <input type="number" placeholder="Amount" step="0.01" min="0"
                           class="adjustment-amount-input w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-100" 
                           data-index="${index}" value="${Math.abs(adjustment.amount) > 0 ? Math.abs(adjustment.amount).toFixed(2) : ''}" onchange="updateAdjustmentAmount(${index}, this.value)">
                    <button onclick="removeAdjustment(${index})" class="text-red-400 hover:text-red-300">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                adjustmentsList.appendChild(adjustmentDiv);
            });
        }

        function updateAdjustmentDescription(index, description) {
            currentAdjustments[index].description = description;
        }

        function updateAdjustmentType(index, type) {
            const amount = Math.abs(currentAdjustments[index].amount);
            currentAdjustments[index].amount = type === 'subtract' ? -amount : amount;
            updateInvoiceTotals();
        }

        function updateAdjustmentAmount(index, amount) {
            const adjustmentAmount = parseFloat(amount) || 0;
            const typeSelect = document.querySelector(`.adjustment-type-select[data-index="${index}"]`);
            const type = typeSelect ? typeSelect.value : 'add';
            currentAdjustments[index].amount = type === 'subtract' ? -adjustmentAmount : adjustmentAmount;
            updateInvoiceTotals();
        }

        function removeAdjustment(index) {
            currentAdjustments.splice(index, 1);
            updateAdjustmentsList();
            updateInvoiceTotals();
        }

        function clearAdjustments() {
            currentAdjustments = [];
            updateAdjustmentsList();
        }

        function updateInvoiceTotals() {
            const subtotal = currentInvoiceItems.reduce((sum, item) => sum + item.total, 0);
            const adjustmentsTotal = currentAdjustments.reduce((sum, adj) => sum + adj.amount, 0);
            const total = subtotal + adjustmentsTotal;
            
            document.getElementById('invoiceSubtotal').textContent = `৳${subtotal.toFixed(2)}`;
            document.getElementById('invoiceAdjustments').textContent = `৳${adjustmentsTotal.toFixed(2)}`;
            document.getElementById('invoiceTotal').textContent = `৳${total.toFixed(2)}`;
        }

        let currentViewingInvoiceIndex = -1;

        function viewInvoice(index) {
            currentViewingInvoiceIndex = index;
            const invoice = invoices[index];
            const content = `
                <div class="space-y-6">
                    <!-- Invoice Header -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-xl font-bold text-gray-100 mb-4">Invoice ${invoice.number}</h4>
                            <div class="space-y-2">
                                <div><span class="text-gray-400">Date:</span> <span class="text-gray-100">${invoice.date}</span></div>
                                <div><span class="text-gray-400">Status:</span> 
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full ${invoice.status === 'Paid' ? 'bg-green-900 text-green-300' : invoice.status === 'Pending' ? 'bg-yellow-900 text-yellow-300' : 'bg-red-900 text-red-300'}">${invoice.status}</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-100 mb-2">Customer Information</h5>
                            <div class="space-y-1">
                                <div class="text-gray-100">${invoice.customer}</div>
                                <div class="text-gray-400">${invoice.customerId}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Invoice Items -->
                    <div>
                        <h5 class="font-semibold text-gray-100 mb-3">Items</h5>
                        <div class="overflow-x-auto">
                            <table class="w-full border border-gray-600 rounded-lg">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-gray-300">Product</th>
                                        <th class="px-4 py-2 text-left text-gray-300">Code</th>
                                        <th class="px-4 py-2 text-left text-gray-300">Qty</th>
                                        <th class="px-4 py-2 text-left text-gray-300">Price</th>
                                        <th class="px-4 py-2 text-left text-gray-300">Total</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-800 divide-y divide-gray-700">
                                    ${invoice.items.map(item => `
                                        <tr>
                                            <td class="px-4 py-2 text-gray-100">${item.product}</td>
                                            <td class="px-4 py-2 text-gray-300">${item.code}</td>
                                            <td class="px-4 py-2 text-gray-300">${item.qty}</td>
                                            <td class="px-4 py-2 text-gray-300">৳${item.price.toFixed(2)}</td>
                                            <td class="px-4 py-2 text-gray-100">৳${item.total.toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    ${invoice.adjustments.length > 0 ? `
                    <!-- Adjustments -->
                    <div>
                        <h5 class="font-semibold text-gray-100 mb-3">Adjustments</h5>
                        <div class="space-y-2">
                            ${invoice.adjustments.map(adj => `
                                <div class="flex justify-between p-3 bg-gray-700 rounded-lg">
                                    <span class="text-gray-100">${adj.description}</span>
                                    <span class="text-gray-100 ${adj.amount < 0 ? 'text-red-400' : 'text-green-400'}">
                                        ${adj.amount >= 0 ? '+' : ''}৳${adj.amount.toFixed(2)}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Invoice Summary -->
                    <div class="bg-gray-700 rounded-lg p-6">
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-300">Subtotal:</span>
                                <span class="text-gray-100">৳${invoice.subtotal.toFixed(2)}</span>
                            </div>
                            ${invoice.adjustments.length > 0 ? `
                            <div class="flex justify-between">
                                <span class="text-gray-300">Adjustments:</span>
                                <span class="text-gray-100">৳${invoice.adjustments.reduce((sum, adj) => sum + adj.amount, 0).toFixed(2)}</span>
                            </div>
                            ` : ''}
                            <div class="border-t border-gray-600 pt-2">
                                <div class="flex justify-between text-lg font-semibold">
                                    <span class="text-gray-100">Total:</span>
                                    <span class="text-green-400">৳${invoice.amount.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('invoiceViewContent').innerHTML = content;
            document.getElementById('invoiceViewModal').classList.remove('hidden');
        }

        function closeInvoiceViewModal() {
            currentViewingInvoiceIndex = -1;
            document.getElementById('invoiceViewModal').classList.add('hidden');
        }

        function editInvoice(index) {
            editingInvoiceIndex = index;
            const invoice = invoices[index];
            
            document.getElementById('invoiceModalTitle').textContent = 'Edit Invoice';
            document.getElementById('invoiceSubmitText').textContent = 'Update Invoice';
            document.getElementById('invoiceNumber').value = invoice.number;
            document.getElementById('invoiceDate').value = invoice.date;
            
            // Set customer
            const customer = customers.find(c => c.id === invoice.customerId);
            if (customer) {
                selectCustomer(customer.id);
            }
            
            // Set items and adjustments
            currentInvoiceItems = [...invoice.items];
            currentAdjustments = [...invoice.adjustments];
            
            updateInvoiceItemsTable();
            updateAdjustmentsList();
            updateInvoiceTotals();
            
            document.getElementById('invoiceModal').classList.remove('hidden');
        }

        function deleteInvoice(index) { 
            if (confirm(`Delete invoice: ${invoices[index].number}?`)) {
                invoices.splice(index, 1);
                loadInvoices();
            }
        }

        function downloadInvoicePDF() {
            let invoiceData;
            
            // Check if we're viewing an existing invoice or creating/editing one
            if (currentViewingInvoiceIndex >= 0) {
                invoiceData = getInvoiceDataFromExisting(currentViewingInvoiceIndex);
            } else {
                invoiceData = getCurrentInvoiceData();
            }
            
            if (!invoiceData) return;
            
            const printWindow = window.open('', '_blank');
            const invoiceHtml = generateInvoicePrintHTML(invoiceData);
            printWindow.document.write(invoiceHtml);
            printWindow.document.close();
            
            // Trigger PDF download
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function printInvoice() {
            let invoiceData;
            
            // Check if we're viewing an existing invoice or creating/editing one
            if (currentViewingInvoiceIndex >= 0) {
                invoiceData = getInvoiceDataFromExisting(currentViewingInvoiceIndex);
            } else {
                invoiceData = getCurrentInvoiceData();
            }
            
            if (!invoiceData) return;
            
            const printWindow = window.open('', '_blank');
            const invoiceHtml = generateInvoicePrintHTML(invoiceData);
            printWindow.document.write(invoiceHtml);
            printWindow.document.close();
            printWindow.print();
        }

        function getInvoiceDataFromExisting(invoiceIndex) {
            const invoice = invoices[invoiceIndex];
            const customer = customers.find(c => c.id === invoice.customerId) || {
                id: invoice.customerId,
                name: invoice.customer,
                email: 'N/A',
                phone: 'N/A',
                address: 'N/A'
            };
            
            // Get company info from localStorage or use defaults
            const companyInfo = JSON.parse(localStorage.getItem('companyInfo') || '{}');
            // Get current logged-in user from localStorage
            const currentUserData = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const currentUser = users.find(u => u.username === currentUserData.username) || users.find(u => u.username === 'admin') || users[0];
            
            return {
                company: {
                    name: companyInfo.name || 'MS/ KAMAL & SON\'S',
                    slogan: companyInfo.slogan || 'Thank you for your business!',
                    address: companyInfo.address || 'Dhaka, Bangladesh',
                    phone: companyInfo.phone || '+880 1234 567890',
                    email: companyInfo.email || 'info@kamalson.com',
                    logo: companyInfo.logo || companyLogo
                },
                invoice: {
                    number: invoice.number,
                    date: invoice.date,
                    dueDate: calculateDueDate(invoice.date),
                    paymentTerm: '30 Days',
                    currency: 'BDT'
                },
                customer: customer,
                items: invoice.items.filter(item => item.product && item.product.trim() !== '' && item.qty > 0 && item.price > 0),
                adjustments: invoice.adjustments || [],
                totals: {
                    subtotal: invoice.subtotal,
                    adjustmentsTotal: (invoice.adjustments || []).reduce((sum, adj) => sum + adj.amount, 0),
                    total: invoice.amount
                },
                authorizedUser: currentUser
            };
        }

        function getCurrentInvoiceData() {
            // Get company info from localStorage or use defaults
            const companyInfo = JSON.parse(localStorage.getItem('companyInfo') || '{}');
            // Get current logged-in user from localStorage
            const currentUserData = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const currentUser = users.find(u => u.username === currentUserData.username) || users.find(u => u.username === 'admin') || users[0];
            
            return {
                company: {
                    name: companyInfo.name || 'MS/ KAMAL & SON\'S',
                    slogan: companyInfo.slogan || 'Thank you for your business!',
                    address: companyInfo.address || 'Dhaka, Bangladesh',
                    phone: companyInfo.phone || '+880 1234 567890',
                    email: companyInfo.email || 'info@kamalson.com',
                    logo: companyInfo.logo || companyLogo
                },
                invoice: {
                    number: document.getElementById('invoiceNumber').value,
                    date: document.getElementById('invoiceDate').value,
                    dueDate: calculateDueDate(document.getElementById('invoiceDate').value),
                    paymentTerm: '30 Days',
                    currency: 'BDT'
                },
                customer: getSelectedCustomerInfo(),
                items: currentInvoiceItems.filter(item => item.product && item.product.trim() !== '' && item.qty > 0 && item.price > 0),
                adjustments: currentAdjustments,
                totals: calculateInvoiceTotals(),
                authorizedUser: currentUser
            };
        }

        function getSelectedCustomerInfo() {
            const customerId = document.getElementById('selectedCustomerId').value;
            return customers.find(c => c.id === customerId) || {
                id: 'N/A',
                name: document.getElementById('customerSearchInput').value || 'Walk-in Customer',
                email: 'N/A',
                phone: 'N/A',
                address: 'N/A'
            };
        }

        function calculateDueDate(invoiceDate) {
            const date = new Date(invoiceDate);
            date.setDate(date.getDate() + 30);
            return date.toISOString().split('T')[0];
        }

        function calculateInvoiceTotals() {
            const subtotal = currentInvoiceItems.reduce((sum, item) => sum + item.total, 0);
            const adjustmentsTotal = currentAdjustments.reduce((sum, adj) => sum + adj.amount, 0);
            const total = subtotal + adjustmentsTotal;
            
            return { subtotal, adjustmentsTotal, total };
        }

        function generateInvoicePrintHTML(data) {
            // Only include valid items with all required fields
            const validItems = data.items.filter(item => 
                item.product && 
                item.product.trim() !== '' && 
                item.qty > 0 && 
                item.price > 0
            );
            
            // Create exact number of rows as items - no empty rows
            const itemRows = validItems.map((item, index) => `
                <tr class="product-row">
                    <td style="padding: 4px 6px; border: 1px solid #333; text-align: center; font-size: 10px; color: #000;">${index + 1}</td>
                    <td style="padding: 4px 6px; border: 1px solid #333; font-size: 10px; color: #000;">${item.product}</td>
                    <td style="padding: 4px 6px; border: 1px solid #333; text-align: center; font-size: 10px; color: #000;">${item.qty}</td>
                    <td style="padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 10px; color: #000;">৳${item.price.toLocaleString()}</td>
                    <td style="padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 10px; color: #000; font-weight: 600;">৳${item.total.toLocaleString()}</td>
                </tr>
            `).join('');

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice ${data.invoice.number} - ${data.company.name}</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 0.4in;
                        }
                        
                        body {
                            font-family: Arial, sans-serif;
                            font-size: 11px;
                            line-height: 1.3;
                            color: #000;
                            margin: 0;
                            padding: 0;
                            background: #ffffff;
                        }
                        
                        /* Prevent page breaks inside these elements */
                        .header,
                        .billing-section,
                        .payment-summary,
                        .totals-section,
                        .signature-section {
                            page-break-inside: avoid;
                            break-inside: avoid;
                        }
                        
                        /* Keep product rows together */
                        .product-row {
                            page-break-inside: avoid;
                            break-inside: avoid;
                        }
                        
                        /* Ensure table headers stay with content */
                        .products-table thead {
                            page-break-after: avoid;
                            break-after: avoid;
                        }
                        
                        /* Keep totals table together */
                        .totals-table {
                            page-break-inside: avoid;
                            break-inside: avoid;
                        }
                        
                        /* Ensure signature section stays together */
                        .signature-box {
                            page-break-inside: avoid;
                            break-inside: avoid;
                        }
                        
                        /* Force page break before signature if needed */
                        .signature-section {
                            page-break-before: auto;
                            break-before: auto;
                        }
                        
                        /* Prevent orphaned content */
                        .billing-box {
                            page-break-inside: avoid;
                            break-inside: avoid;
                        }
                        
                        /* Keep payment summary intact */
                        .total-amount-display {
                            page-break-inside: avoid;
                            break-inside: avoid;
                        }
                        
                        .header {
                            display: flex;
                            justify-content: space-between;
                            align-items: flex-start;
                            margin-bottom: 15px;
                            padding: 10px;
                            border: 2px solid #000;
                        }
                        
                        .company-info {
                            flex: 1;
                            display: flex;
                            align-items: flex-start;
                            gap: 10px;
                        }
                        
                        .company-logo {
                            width: 50px;
                            height: 50px;
                            object-fit: contain;
                            border: 1px solid #000;
                        }
                        
                        .company-details {
                            flex: 1;
                        }
                        
                        .company-name {
                            font-size: 16px;
                            font-weight: bold;
                            margin-bottom: 3px;
                            color: #000;
                        }
                        
                        .company-slogan {
                            font-size: 10px;
                            color: #000;
                            margin-bottom: 5px;
                            font-style: italic;
                        }
                        
                        .company-contact {
                            font-size: 9px;
                            color: #000;
                            line-height: 1.2;
                        }
                        
                        .invoice-header-box {
                            text-align: right;
                            min-width: 150px;
                            border: 2px solid #000;
                            padding: 10px;
                        }
                        
                        .invoice-title {
                            font-size: 18px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 5px;
                        }
                        
                        .invoice-number {
                            font-size: 11px;
                            color: #000;
                            margin-bottom: 2px;
                            font-weight: bold;
                        }
                        
                        .invoice-date {
                            font-size: 10px;
                            color: #000;
                        }
                        
                        .billing-section {
                            display: flex;
                            gap: 15px;
                            margin-bottom: 15px;
                        }
                        
                        .billing-box {
                            flex: 1;
                            border: 1px solid #000;
                            padding: 10px;
                            font-size: 10px;
                        }
                        
                        .billing-title {
                            font-weight: bold;
                            font-size: 11px;
                            margin-bottom: 8px;
                            color: #000;
                            text-transform: uppercase;
                            border-bottom: 1px solid #000;
                            padding-bottom: 2px;
                        }
                        
                        .billing-content {
                            color: #000;
                            line-height: 1.4;
                        }
                        
                        .billing-content strong {
                            font-weight: bold;
                            color: #000;
                        }
                        
                        .payment-summary {
                            border: 1px solid #000;
                            padding: 8px;
                            margin-bottom: 15px;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        }
                        
                        .payment-details {
                            flex: 1;
                            font-size: 9px;
                            color: #000;
                        }
                        
                        .payment-details div {
                            margin-bottom: 2px;
                        }
                        
                        .payment-details strong {
                            font-weight: bold;
                        }
                        
                        .total-amount-display {
                            text-align: center;
                            border: 2px solid #000;
                            padding: 8px;
                            min-width: 120px;
                        }
                        
                        .total-label {
                            font-size: 10px;
                            color: #000;
                            margin-bottom: 3px;
                            text-transform: uppercase;
                            font-weight: bold;
                        }
                        
                        .total-value {
                            font-size: 14px;
                            font-weight: bold;
                            color: #000;
                        }
                        
                        .products-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 15px;
                            border: 2px solid #000;
                        }
                        
                        .products-table th {
                            background: #000;
                            color: #fff;
                            padding: 6px 4px;
                            text-align: left;
                            font-weight: bold;
                            font-size: 9px;
                            text-transform: uppercase;
                            border: 1px solid #000;
                        }
                        
                        .products-table th:nth-child(1) { text-align: center; width: 8%; }
                        .products-table th:nth-child(2) { width: 45%; }
                        .products-table th:nth-child(3) { text-align: center; width: 12%; }
                        .products-table th:nth-child(4) { text-align: right; width: 17%; }
                        .products-table th:nth-child(5) { text-align: right; width: 18%; }
                        
                        .totals-section {
                            display: flex;
                            justify-content: flex-end;
                            margin-bottom: 15px;
                        }
                        
                        .totals-table {
                            width: 200px;
                            border: 1px solid #000;
                            border-collapse: collapse;
                        }
                        
                        .subtotal-row td {
                            padding: 5px 8px;
                            font-weight: bold;
                            font-size: 10px;
                            border: 1px solid #000;
                            color: #000;
                        }
                        
                        .total-row {
                            background: #000;
                            color: #fff;
                            font-weight: bold;
                        }
                        
                        .total-row td {
                            padding: 6px 8px;
                            font-size: 11px;
                            border: 1px solid #000;
                        }
                        

                        
                        .signature-section {
                            display: flex;
                            justify-content: space-between;
                            gap: 10px;
                        }
                        
                        .signature-box {
                            flex: 1;
                            text-align: center;
                            border: 1px solid #000;
                            padding: 10px;
                        }
                        
                        .signature-title {
                            font-weight: bold;
                            font-size: 9px;
                            color: #000;
                            margin-bottom: 20px;
                            text-transform: uppercase;
                        }
                        
                        .signature-line {
                            border-top: 1px solid #000;
                            margin-top: 25px;
                            padding-top: 3px;
                            font-size: 8px;
                            color: #000;
                        }
                        
                        .signature-image {
                            max-width: 80px;
                            max-height: 25px;
                            margin-bottom: 5px;
                        }
                        
                        @media print {
                            body { -webkit-print-color-adjust: exact; }
                        }
                    </style>
                </head>
                <body>
                    <!-- Header Section -->
                    <div class="header">
                        <div class="company-info">
                            ${data.company.logo ? `<img src="${data.company.logo}" alt="Company Logo" class="company-logo" style="display: block;">` : '<div class="company-logo" style="border: 1px solid #000; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #666;">LOGO</div>'}
                            <div class="company-details">
                                <div class="company-name">${data.company.name}</div>
                                <div class="company-slogan">${data.company.slogan}</div>
                                <div class="company-contact">
                                    <div>${data.company.address}</div>
                                    <div>Phone: ${data.company.phone} | Email: ${data.company.email}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="invoice-header-box">
                            <div class="invoice-title">INVOICE</div>
                            <div class="invoice-number">#${data.invoice.number}</div>
                            <div class="invoice-date">${new Date(data.invoice.date).toLocaleDateString()}</div>
                        </div>
                    </div>
                    
                    <!-- Bill From/To Section -->
                    <div class="billing-section">
                        <div class="billing-box">
                            <div class="billing-title">Bill From:</div>
                            <div class="billing-content">
                                <div><strong>${data.company.name}</strong></div>
                                <div>${data.company.address}</div>
                                <div>Phone: ${data.company.phone}</div>
                                <div>Email: ${data.company.email}</div>
                            </div>
                        </div>
                        
                        <div class="billing-box">
                            <div class="billing-title">Bill To:</div>
                            <div class="billing-content">
                                <div><strong>${data.customer.name}</strong></div>
                                <div>${data.customer.address}</div>
                                                            </div>
                        </div>
                    </div>
                    

                        </div>
                    </div>
                    
                    <!-- Products Table -->
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Product/Service Description</th>
                                <th>Qty</th>
                                <th>Unit Price (৳)</th>
                                <th>Total Amount (৳)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemRows}
                        </tbody>
                    </table>
                    
                    <!-- Totals Section -->
                    <div class="totals-section">
                        <table class="totals-table">
                            <tr class="subtotal-row">
                                <td style="text-align: right;">Subtotal:</td>
                                <td style="text-align: right;">৳${data.totals.subtotal.toLocaleString()}</td>
                            </tr>
                            ${data.adjustments.length > 0 ? data.adjustments.map(adj => `
                            <tr class="subtotal-row">
                                <td style="text-align: right;">${adj.description || 'Adjustment'}:</td>
                                <td style="text-align: right; color: ${adj.amount < 0 ? '#d32f2f' : '#2e7d32'};">
                                    ${adj.amount >= 0 ? '+' : ''}৳${adj.amount.toLocaleString()}
                                </td>
                            </tr>
                            `).join('') : ''}
                            <tr class="total-row">
                                <td style="text-align: right;">Grand Total:</td>
                                <td style="text-align: right;">৳${data.totals.total.toLocaleString()}</td>
                            </tr>
                        </table>
                    </div>
                    

                    
                    <!-- Signature Section -->
                    <div class="signature-section">
                        <div class="signature-box">
                            <div class="signature-title">Customer Signature</div>
                            <div class="signature-line">
                                Date: _________________
                            </div>
                        </div>
                        
                        <div class="signature-box">
                            <div class="signature-title">Authorized Signature, ${data.company.name}</div>
                            ${data.authorizedUser.signature ? `<img src="${data.authorizedUser.signature}" alt="Authorized Signature" class="signature-image">` : ''}
                            <div class="signature-line">
                                ${data.authorizedUser.name}<br>
                                Date: ${new Date().toLocaleDateString()}
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // Invoice form submission
        document.getElementById('invoiceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!document.getElementById('selectedCustomerId').value) {
                alert('Please select a customer');
                return;
            }
            
            if (currentInvoiceItems.length === 0) {
                alert('Please add at least one item to the invoice');
                return;
            }
            
            const subtotal = currentInvoiceItems.reduce((sum, item) => sum + item.total, 0);
            const adjustmentsTotal = currentAdjustments.reduce((sum, adj) => sum + adj.amount, 0);
            const total = subtotal + adjustmentsTotal;
            
            const invoiceData = {
                number: document.getElementById('invoiceNumber').value,
                customer: document.getElementById('customerSearchInput').value,
                customerId: document.getElementById('selectedCustomerId').value,
                date: document.getElementById('invoiceDate').value,
                amount: total,
                status: 'Pending',
                items: [...currentInvoiceItems],
                adjustments: [...currentAdjustments],
                subtotal: subtotal
            };
            
            if (editingInvoiceIndex >= 0) {
                invoices[editingInvoiceIndex] = invoiceData;
            } else {
                invoices.push(invoiceData);
            }
            
            loadInvoices();
            autoSaveData(); // Auto-save after invoice changes
            closeInvoiceModal();
        });

        // Global variables for user management
        let editingUserIndex = -1;
        let currentUserSignature = null;

        // User CRUD operations
        function openUserModal() {
            editingUserIndex = -1;
            currentUserSignature = null;
            document.getElementById('userModalTitle').textContent = 'Add New User';
            document.getElementById('userSubmitText').textContent = 'Add User';
            document.getElementById('userId').value = generateUserId();
            document.getElementById('userName').value = '';
            document.getElementById('userUsername').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userConfirmPassword').value = '';
            document.getElementById('userRole').value = '';
            document.querySelector('input[name="userStatus"][value="Active"]').checked = true;
            resetSignaturePreview();
            document.getElementById('userModal').classList.remove('hidden');
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.add('hidden');
        }

        function generateUserId() {
            const prefix = 'USR';
            const number = (users.length + 1).toString().padStart(3, '0');
            return prefix + number;
        }

        function handleSignatureUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const signaturePreview = document.getElementById('signaturePreview');
                    signaturePreview.innerHTML = `<img src="${e.target.result}" alt="User Signature" class="w-full h-full object-contain rounded-lg">`;
                    currentUserSignature = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function uploadSignature() {
            if (currentUserSignature) {
                alert('Signature uploaded successfully!');
            } else {
                alert('Please select a signature file first.');
            }
        }

        function removeSignature() {
            currentUserSignature = null;
            resetSignaturePreview();
            document.getElementById('signatureUpload').value = '';
            alert('Signature removed successfully!');
        }

        function resetSignaturePreview() {
            document.getElementById('signaturePreview').innerHTML = `
                <div class="text-center">
                    <i class="fas fa-signature text-gray-500 text-2xl mb-2"></i>
                    <p class="text-gray-400 text-sm">No Signature</p>
                </div>
            `;
        }

        function viewUser(index) {
            const user = users[index];
            const content = `
                <div class="space-y-6">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white text-2xl font-bold">${user.name.charAt(0)}</span>
                        </div>
                        <h4 class="text-xl font-semibold text-gray-100">${user.name}</h4>
                        <p class="text-gray-400">${user.role}</p>
                        <span class="px-3 py-1 text-sm font-semibold rounded-full ${user.status === 'Active' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}">${user.status}</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">User ID</label>
                                <p class="text-gray-100 font-semibold">${user.id}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Username</label>
                                <p class="text-gray-100">${user.username}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                                <p class="text-gray-100">${user.email}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Phone</label>
                                <p class="text-gray-100">${user.phone}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Role</label>
                                <p class="text-gray-100">${user.role}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Account Created</label>
                                <p class="text-gray-100">${user.createdDate}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Digital Signature</label>
                                <div class="w-full h-20 bg-gray-700 rounded-lg border border-gray-600 flex items-center justify-center">
                                    ${user.signature ? 
                                        `<img src="${user.signature}" alt="User Signature" class="max-w-full max-h-full object-contain">` :
                                        '<span class="text-gray-400 text-sm">No signature uploaded</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('productViewContent').innerHTML = content;
            document.getElementById('productViewModal').classList.remove('hidden');
        }

        function editUser(index) {
            editingUserIndex = index;
            const user = users[index];
            currentUserSignature = user.signature;
            
            document.getElementById('userModalTitle').textContent = 'Edit User';
            document.getElementById('userSubmitText').textContent = 'Update User';
            document.getElementById('userId').value = user.id;
            document.getElementById('userName').value = user.name;
            document.getElementById('userUsername').value = user.username;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('userPhone').value = user.phone;
            document.getElementById('userPassword').value = user.password;
            document.getElementById('userConfirmPassword').value = user.password;
            document.getElementById('userRole').value = user.role;
            document.querySelector(`input[name="userStatus"][value="${user.status}"]`).checked = true;
            
            // Set signature preview
            if (user.signature) {
                document.getElementById('signaturePreview').innerHTML = `<img src="${user.signature}" alt="User Signature" class="w-full h-full object-contain rounded-lg">`;
            } else {
                resetSignaturePreview();
            }
            
            document.getElementById('userModal').classList.remove('hidden');
        }

        function toggleUserStatus(index) {
            users[index].status = users[index].status === 'Active' ? 'Inactive' : 'Active';
            loadUsers();
        }

        function deleteUser(index) { 
            if (confirm(`Delete user: ${users[index].name}?`)) {
                users.splice(index, 1);
                loadUsers();
            }
        }

        // User form submission
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const password = document.getElementById('userPassword').value;
            const confirmPassword = document.getElementById('userConfirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long!');
                return;
            }
            
            const userData = {
                id: document.getElementById('userId').value,
                name: document.getElementById('userName').value,
                username: document.getElementById('userUsername').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value,
                password: password,
                role: document.getElementById('userRole').value,
                status: document.querySelector('input[name="userStatus"]:checked').value,
                signature: currentUserSignature,
                createdDate: editingUserIndex >= 0 ? users[editingUserIndex].createdDate : new Date().toISOString().split('T')[0]
            };
            
            if (editingUserIndex >= 0) {
                users[editingUserIndex] = userData;
            } else {
                users.push(userData);
            }
            
            loadUsers();
            autoSaveData(); // Auto-save after user changes
            closeUserModal();
        });

        // Dashboard Analytics Functions
        function updateDashboardMetrics() {
            // Update key metrics
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalCustomers').textContent = customers.length;
            document.getElementById('totalInvoices').textContent = invoices.length;
            
            // Calculate revenue
            const monthlyRevenue = invoices.reduce((sum, invoice) => sum + invoice.amount, 0);
            document.getElementById('monthlyRevenue').textContent = `৳${monthlyRevenue.toFixed(2)}`;
            
            // Update sales performance
            const todaySales = invoices.filter(inv => inv.date === new Date().toISOString().split('T')[0])
                .reduce((sum, inv) => sum + inv.amount, 0);
            document.getElementById('todaySales').textContent = `৳${todaySales.toFixed(2)}`;
            
            const weekSales = monthlyRevenue * 0.25; // Estimated
            const yearSales = monthlyRevenue * 12; // Estimated
            document.getElementById('weekSales').textContent = `৳${weekSales.toFixed(2)}`;
            document.getElementById('monthSales').textContent = `৳${monthlyRevenue.toFixed(2)}`;
            document.getElementById('yearSales').textContent = `৳${yearSales.toFixed(2)}`;
            
            // Product analytics
            const productSales = {};
            invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    if (!productSales[item.product]) {
                        productSales[item.product] = 0;
                    }
                    productSales[item.product] += item.qty;
                });
            });
            
            const sortedProducts = Object.entries(productSales).sort((a, b) => b[1] - a[1]);
            const bestSeller = sortedProducts.length > 0 ? sortedProducts[0][0] : 'N/A';
            const lowestSeller = sortedProducts.length > 0 ? sortedProducts[sortedProducts.length - 1][0] : 'N/A';
            
            document.getElementById('bestSeller').textContent = bestSeller;
            document.getElementById('lowestSeller').textContent = lowestSeller;
            document.getElementById('lowStockCount').textContent = products.filter(p => p.stock <= 10).length;
            
            // Customer analytics
            const avgOrderValue = invoices.length > 0 ? monthlyRevenue / invoices.length : 0;
            document.getElementById('avgOrderValue').textContent = `৳${avgOrderValue.toFixed(2)}`;
            
            const topCustomer = customers.reduce((top, customer) => 
                customer.totalSpent > (top?.totalSpent || 0) ? customer : top, null);
            document.getElementById('topCustomer').textContent = topCustomer ? topCustomer.name : 'N/A';
            
            // Update top products list
            updateTopProductsList(sortedProducts);
            
            // Update recent activity
            updateRecentActivity();
            
            // Update system alerts
            updateSystemAlerts();
            
            // Draw sales chart
            drawSalesChart();
        }

        function updateTopProductsList(sortedProducts) {
            const topProductsList = document.getElementById('topProductsList');
            const top5 = sortedProducts.slice(0, 5);
            
            topProductsList.innerHTML = top5.map((product, index) => {
                const percentage = top5.length > 0 ? (product[1] / top5[0][1]) * 100 : 0;
                const colors = ['bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-yellow-500', 'bg-red-500'];
                
                return `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 ${colors[index]} rounded-full flex items-center justify-center text-white font-bold text-sm">
                                ${index + 1}
                            </div>
                            <div>
                                <p class="text-gray-100 font-medium">${product[0]}</p>
                                <p class="text-gray-400 text-sm">${product[1]} units sold</p>
                            </div>
                        </div>
                        <div class="w-24">
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="${colors[index]} h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            const activities = [
                { icon: 'fas fa-plus-circle', text: 'New invoice created', time: '2 minutes ago', color: 'text-green-400' },
                { icon: 'fas fa-user-plus', text: 'New customer added', time: '15 minutes ago', color: 'text-blue-400' },
                { icon: 'fas fa-edit', text: 'Product updated', time: '1 hour ago', color: 'text-yellow-400' },
                { icon: 'fas fa-dollar-sign', text: 'Payment received', time: '2 hours ago', color: 'text-green-400' },
                { icon: 'fas fa-box', text: 'Stock updated', time: '3 hours ago', color: 'text-purple-400' }
            ];
            
            recentActivity.innerHTML = activities.map(activity => `
                <div class="flex items-center space-x-3 p-3 bg-gray-700 rounded-lg">
                    <i class="${activity.icon} ${activity.color}"></i>
                    <div class="flex-1">
                        <p class="text-gray-100 text-sm">${activity.text}</p>
                        <p class="text-gray-400 text-xs">${activity.time}</p>
                    </div>
                </div>
            `).join('');
        }

        function updateSystemAlerts() {
            const systemAlerts = document.getElementById('systemAlerts');
            const lowStockProducts = products.filter(p => p.stock <= 10);
            const overdueInvoices = invoices.filter(inv => inv.status === 'Overdue');
            
            const alerts = [];
            
            if (lowStockProducts.length > 0) {
                alerts.push({
                    icon: 'fas fa-exclamation-triangle',
                    text: `${lowStockProducts.length} products low in stock`,
                    color: 'text-yellow-400',
                    bg: 'bg-yellow-900 bg-opacity-30 border-yellow-700'
                });
            }
            
            if (overdueInvoices.length > 0) {
                alerts.push({
                    icon: 'fas fa-clock',
                    text: `${overdueInvoices.length} overdue invoices`,
                    color: 'text-red-400',
                    bg: 'bg-red-900 bg-opacity-30 border-red-700'
                });
            }
            
            alerts.push({
                icon: 'fas fa-check-circle',
                text: 'System backup completed',
                color: 'text-green-400',
                bg: 'bg-green-900 bg-opacity-30 border-green-700'
            });
            
            systemAlerts.innerHTML = alerts.map(alert => `
                <div class="flex items-center space-x-3 p-3 ${alert.bg} rounded-lg border">
                    <i class="${alert.icon} ${alert.color}"></i>
                    <p class="text-gray-100 text-sm">${alert.text}</p>
                </div>
            `).join('');
        }

        function drawSalesChart() {
            const canvas = document.getElementById('salesChart');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Sample data for 12 months
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const salesData = [12000, 15000, 18000, 14000, 22000, 25000, 28000, 24000, 26000, 30000, 32000, 35000];
            
            const maxSales = Math.max(...salesData);
            const padding = 40;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid lines
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Draw chart line
            ctx.strokeStyle = '#3B82F6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            salesData.forEach((sales, index) => {
                const x = padding + (chartWidth / (salesData.length - 1)) * index;
                const y = padding + chartHeight - (sales / maxSales) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Draw data points
            ctx.fillStyle = '#3B82F6';
            salesData.forEach((sales, index) => {
                const x = padding + (chartWidth / (salesData.length - 1)) * index;
                const y = padding + chartHeight - (sales / maxSales) * chartHeight;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Draw labels
            ctx.fillStyle = '#9CA3AF';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            
            months.forEach((month, index) => {
                const x = padding + (chartWidth / (months.length - 1)) * index;
                ctx.fillText(month, x, canvas.height - 10);
            });
        }

        function printDashboardReport() {
            const printWindow = window.open('', '_blank');
            const reportHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Dashboard Report - Sayed's Lamp</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                        .company-name { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
                        .report-title { font-size: 20px; color: #666; margin-bottom: 10px; }
                        .metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
                        .metric-card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; text-align: center; }
                        .metric-value { font-size: 24px; font-weight: bold; color: #333; }
                        .metric-label { color: #666; margin-top: 5px; }
                        .section { margin-bottom: 30px; }
                        .section-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #ddd; padding-top: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="company-name">Sayed's Lamp</div>
                        <div class="report-title">Business Analytics Report</div>
                        <div>Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</div>
                    </div>
                    
                    <div class="metrics">
                        <div class="metric-card">
                            <div class="metric-value">${products.length}</div>
                            <div class="metric-label">Total Products</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${customers.length}</div>
                            <div class="metric-label">Active Customers</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">৳${invoices.reduce((sum, inv) => sum + inv.amount, 0).toFixed(2)}</div>
                            <div class="metric-label">Monthly Revenue</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${invoices.length}</div>
                            <div class="metric-label">Total Invoices</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Top 5 Selling Products</div>
                        <table>
                            <thead>
                                <tr><th>Rank</th><th>Product Name</th><th>Units Sold</th><th>Revenue</th></tr>
                            </thead>
                            <tbody>
                                ${(() => {
                                    const productSales = {};
                                    invoices.forEach(invoice => {
                                        invoice.items.forEach(item => {
                                            if (!productSales[item.product]) {
                                                productSales[item.product] = { qty: 0, revenue: 0 };
                                            }
                                            productSales[item.product].qty += item.qty;
                                            productSales[item.product].revenue += item.total;
                                        });
                                    });
                                    
                                    return Object.entries(productSales)
                                        .sort((a, b) => b[1].qty - a[1].qty)
                                        .slice(0, 5)
                                        .map((product, index) => `
                                            <tr>
                                                <td>${index + 1}</td>
                                                <td>${product[0]}</td>
                                                <td>${product[1].qty}</td>
                                                <td>৳${product[1].revenue.toFixed(2)}</td>
                                            </tr>
                                        `).join('');
                                })()}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Top 5 Customers by Spending</div>
                        <table>
                            <thead>
                                <tr><th>Rank</th><th>Customer Name</th><th>Total Spent</th><th>Last Purchase</th></tr>
                            </thead>
                            <tbody>
                                ${customers
                                    .sort((a, b) => b.totalSpent - a.totalSpent)
                                    .slice(0, 5)
                                    .map((customer, index) => `
                                        <tr>
                                            <td>${index + 1}</td>
                                            <td>${customer.name}</td>
                                            <td>৳${customer.totalSpent.toFixed(2)}</td>
                                            <td>${customer.lastPurchase}</td>
                                        </tr>
                                    `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Low Stock Alert</div>
                        <table>
                            <thead>
                                <tr><th>Product Code</th><th>Product Name</th><th>Current Stock</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                ${products
                                    .filter(p => p.stock <= 10)
                                    .map(product => `
                                        <tr>
                                            <td>${product.code}</td>
                                            <td>${product.name}</td>
                                            <td>${product.stock}</td>
                                            <td style="color: ${product.stock <= 5 ? 'red' : 'orange'}">
                                                ${product.stock <= 5 ? 'Critical' : 'Low'}
                                            </td>
                                        </tr>
                                    `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="footer">
                        <p>This report contains confidential business information.</p>
                        <p>Sayed's Lamp ERP System - Business Analytics Dashboard</p>
                    </div>
                </body>
                </html>
            `;
            printWindow.document.write(reportHtml);
            printWindow.document.close();
            printWindow.print();
        }

        // Settings Functions
        let companyLogo = null;
        let invoiceTemplate = null;
        let currentColorScheme = 'blue';

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoPreview = document.getElementById('logoPreview');
                    logoPreview.innerHTML = `<img src="${e.target.result}" alt="Company Logo" class="w-full h-full object-cover rounded-lg">`;
                    companyLogo = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function uploadLogo() {
            if (companyLogo) {
                // Save logo to localStorage
                const companyInfo = JSON.parse(localStorage.getItem('companyInfo') || '{}');
                companyInfo.logo = companyLogo;
                localStorage.setItem('companyInfo', JSON.stringify(companyInfo));
                alert('Logo uploaded successfully!');
            } else {
                alert('Please select a logo file first.');
            }
        }

        function removeLogo() {
            companyLogo = null;
            document.getElementById('logoPreview').innerHTML = `
                <div class="text-center">
                    <i class="fas fa-image text-gray-500 text-3xl mb-2"></i>
                    <p class="text-gray-400 text-sm">No Logo</p>
                </div>
            `;
            document.getElementById('logoUpload').value = '';
            alert('Logo removed successfully!');
        }

        function handleTemplateUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const templatePreview = document.getElementById('templatePreview');
                    templatePreview.innerHTML = `
                        <div class="relative w-full h-full">
                            <img src="${e.target.result}" alt="Invoice Template" class="w-full h-full object-contain rounded-lg">
                            <div class="absolute top-2 right-2 bg-green-600 text-white px-2 py-1 rounded text-xs">
                                <i class="fas fa-check mr-1"></i>Ready
                            </div>
                        </div>
                    `;
                    invoiceTemplate = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function uploadTemplate() {
            if (invoiceTemplate) {
                // Save template to localStorage
                const templateSettings = JSON.parse(localStorage.getItem('templateSettings') || '{}');
                templateSettings.customTemplate = invoiceTemplate;
                templateSettings.activeTemplate = 'custom';
                localStorage.setItem('templateSettings', JSON.stringify(templateSettings));
                
                // Update current template display
                document.getElementById('currentTemplateName').textContent = 'Custom Uploaded Template';
                document.getElementById('templateStyle').value = 'custom';
                
                alert('Invoice template uploaded and applied successfully! The system has analyzed your template and will use its styling for future invoices.');
            } else {
                alert('Please select a template file first.');
            }
        }

        function removeTemplate() {
            invoiceTemplate = null;
            document.getElementById('templatePreview').innerHTML = `
                <div class="text-center">
                    <i class="fas fa-file-invoice text-gray-500 text-4xl mb-3"></i>
                    <p class="text-gray-400 text-sm">No Template Uploaded</p>
                    <p class="text-gray-500 text-xs mt-1">Upload a PNG template to customize invoice design</p>
                </div>
            `;
            document.getElementById('templateUpload').value = '';
            
            // Reset to default template
            const templateSettings = JSON.parse(localStorage.getItem('templateSettings') || '{}');
            templateSettings.activeTemplate = 'professional';
            localStorage.setItem('templateSettings', JSON.stringify(templateSettings));
            
            document.getElementById('currentTemplateName').textContent = 'Default Professional Template';
            document.getElementById('templateStyle').value = 'professional';
            
            alert('Template removed successfully! Reverted to default professional template.');
        }

        function setColorScheme(color) {
            currentColorScheme = color;
            
            // Update color scheme buttons
            const colorButtons = document.querySelectorAll('[onclick^="setColorScheme"]');
            colorButtons.forEach(btn => {
                btn.classList.remove('border-blue-400', 'border-green-400', 'border-purple-400', 'border-gray-400', 'border-red-400', 'border-yellow-400');
                btn.classList.add('border-transparent');
            });
            
            // Highlight selected color
            const selectedButton = document.querySelector(`[onclick="setColorScheme('${color}')"]`);
            if (selectedButton) {
                selectedButton.classList.remove('border-transparent');
                selectedButton.classList.add(`border-${color}-400`);
            }
            
            // Save color scheme
            const templateSettings = JSON.parse(localStorage.getItem('templateSettings') || '{}');
            templateSettings.colorScheme = color;
            localStorage.setItem('templateSettings', JSON.stringify(templateSettings));
        }

        function saveTemplateSettings() {
            const templateStyle = document.getElementById('templateStyle').value;
            const autoFit = document.querySelector('input[type="checkbox"]').checked;
            
            const templateSettings = {
                style: templateStyle,
                colorScheme: currentColorScheme,
                autoFit: autoFit,
                customTemplate: invoiceTemplate,
                activeTemplate: templateStyle
            };
            
            localStorage.setItem('templateSettings', JSON.stringify(templateSettings));
            alert('Template settings saved successfully!');
        }

        function importProducts() {
            const importData = document.getElementById('productImportData').value.trim();
            if (!importData) {
                alert('Please enter product data to import.');
                return;
            }
            
            const lines = importData.split('\n');
            let importedCount = 0;
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine && trimmedLine.includes('-')) {
                    const parts = trimmedLine.split('-').map(s => s.trim());
                    const name = parts[0];
                    const category = parts[1];
                    const price = parts[2] ? parseFloat(parts[2]) || 0 : 0;
                    
                    if (name && category) {
                        const productCode = generateProductCode();
                        products.push({
                            code: productCode,
                            name: name,
                            category: category,
                            price: price, // Price from import or 0 if not provided
                            stock: 9999
                        });
                        importedCount++;
                    }
                }
            });
            
            if (importedCount > 0) {
                loadProducts();
                updateDashboardMetrics();
                document.getElementById('productImportData').value = '';
                alert(`Successfully imported ${importedCount} products!`);
            } else {
                alert('No valid products found. Please check the format.');
            }
        }

        function saveSystemPreferences() {
            const currency = document.getElementById('systemCurrency').value;
            const dateFormat = document.getElementById('dateFormat').value;
            const timeZone = document.getElementById('timeZone').value;
            
            // In a real application, these would be saved to a database
            localStorage.setItem('systemCurrency', currency);
            localStorage.setItem('dateFormat', dateFormat);
            localStorage.setItem('timeZone', timeZone);
            
            alert('System preferences saved successfully!');
        }

        // OneDrive Cloud Sync Functions
        function exportToOneDrive() {
            const allData = {
                products: products,
                customers: customers,
                invoices: invoices,
                users: users,
                companyInfo: JSON.parse(localStorage.getItem('companyInfo') || '{}'),
                templateSettings: JSON.parse(localStorage.getItem('templateSettings') || '{}'),
                systemSettings: {
                    currency: localStorage.getItem('systemCurrency') || 'BDT',
                    dateFormat: localStorage.getItem('dateFormat') || 'DD/MM/YYYY',
                    timeZone: localStorage.getItem('timeZone') || 'EST'
                },
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'erp_backup.json';
            link.click();
            URL.revokeObjectURL(url);
            
            // Track export timestamp
            localStorage.setItem('lastCloudExport', new Date().toISOString());
            updateCloudSyncStatus();
            
            alert('✅ Export Complete!\n\nFile "erp_backup.json" has been downloaded to your Downloads folder.\n\nNext Steps:\n1. Move this file to your OneDrive folder\n2. On other devices, download this file from OneDrive\n3. Use "Import All Data" to sync your data');
        }

        function importFromOneDrive(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.json')) {
                alert('❌ Please select a valid JSON backup file');
                return;
            }
            
            const confirmImport = confirm('⚠️ IMPORTANT WARNING ⚠️\n\nThis will REPLACE ALL current data including:\n• All Products\n• All Customers\n• All Invoices\n• All Users\n• All Settings\n\nMake sure you have exported your current data first!\n\nDo you want to continue?');
            
            if (!confirmImport) {
                event.target.value = ''; // Reset file input
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (!importedData.products || !importedData.customers || !importedData.invoices) {
                        throw new Error('Invalid backup file format');
                    }
                    
                    // Import all data
                    products.length = 0;
                    products.push(...importedData.products);
                    
                    customers.length = 0;
                    customers.push(...importedData.customers);
                    
                    invoices.length = 0;
                    invoices.push(...importedData.invoices);
                    
                    if (importedData.users) {
                        users.length = 0;
                        users.push(...importedData.users);
                    }
                    
                    // Import settings
                    if (importedData.companyInfo) {
                        localStorage.setItem('companyInfo', JSON.stringify(importedData.companyInfo));
                    }
                    
                    if (importedData.templateSettings) {
                        localStorage.setItem('templateSettings', JSON.stringify(importedData.templateSettings));
                    }
                    
                    if (importedData.systemSettings) {
                        localStorage.setItem('systemCurrency', importedData.systemSettings.currency || 'BDT');
                        localStorage.setItem('dateFormat', importedData.systemSettings.dateFormat || 'DD/MM/YYYY');
                        localStorage.setItem('timeZone', importedData.systemSettings.timeZone || 'EST');
                    }
                    
                    // Refresh all displays
                    loadProducts();
                    loadCustomers();
                    loadInvoices();
                    loadUsers();
                    updateDashboardMetrics();
                    
                    // Update company form if on settings page
                    const companyInfo = importedData.companyInfo || {};
                    if (document.getElementById('companyName')) {
                        document.getElementById('companyName').value = companyInfo.name || 'MS/ KAMAL & SON\'S';
                        document.getElementById('companySlogan').value = companyInfo.slogan || 'Thank you for your business!';
                        document.getElementById('companyAddress').value = companyInfo.address || 'Dhaka, Bangladesh';
                        document.getElementById('companyPhone').value = companyInfo.phone || '+880 1234 567890';
                        document.getElementById('companyEmail').value = companyInfo.email || 'info@kamalson.com';
                    }
                    
                    const importDate = importedData.exportDate ? new Date(importedData.exportDate).toLocaleString() : 'Unknown';
                    
                    alert(`✅ Import Successful!\n\nData imported from backup created on: ${importDate}\n\nImported:\n• ${importedData.products.length} Products\n• ${importedData.customers.length} Customers\n• ${importedData.invoices.length} Invoices\n• ${importedData.users ? importedData.users.length : 0} Users\n• Company Settings\n• Template Settings\n\nAll data has been synced successfully!`);
                    
                } catch (error) {
                    alert(`❌ Import Failed!\n\nError: ${error.message}\n\nPlease make sure you selected the correct "erp_backup.json" file exported from this software.`);
                }
                
                // Reset file input
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        function exportData(type) {
            let data, filename;
            
            switch(type) {
                case 'products':
                    data = products;
                    filename = 'products_export.json';
                    break;
                case 'customers':
                    data = customers;
                    filename = 'customers_export.json';
                    break;
                case 'invoices':
                    data = invoices;
                    filename = 'invoices_export.json';
                    break;
                default:
                    return;
            }
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Company form submission
        document.getElementById('companyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const companyData = {
                name: document.getElementById('companyName').value,
                slogan: document.getElementById('companySlogan').value,
                address: document.getElementById('companyAddress').value,
                phone: document.getElementById('companyPhone').value,
                email: document.getElementById('companyEmail').value,
                logo: companyLogo
            };
            
            // In a real application, this would be saved to a database
            localStorage.setItem('companyInfo', JSON.stringify(companyData));
            alert('Company information saved successfully!');
        });

        // Notification System
        let notificationQueue = [];
        let notificationTimeout;

        function showNotification(message, type = 'info', duration = 5000) {
            const notification = {
                id: Date.now(),
                message: message,
                type: type, // 'success', 'error', 'warning', 'info'
                timestamp: new Date().toLocaleTimeString()
            };
            
            notificationQueue.push(notification);
            displayNotifications();
            
            // Auto-hide notification after duration
            setTimeout(() => {
                removeNotification(notification.id);
            }, duration);
        }

        function displayNotifications() {
            const tablet = document.getElementById('notificationTablet');
            const content = document.getElementById('notificationContent');
            
            if (notificationQueue.length === 0) {
                tablet.classList.add('hidden');
                return;
            }
            
            tablet.classList.remove('hidden');
            
            content.innerHTML = notificationQueue.map(notification => {
                const iconClass = {
                    'success': 'fas fa-check-circle text-green-400',
                    'error': 'fas fa-exclamation-circle text-red-400',
                    'warning': 'fas fa-exclamation-triangle text-yellow-400',
                    'info': 'fas fa-info-circle text-blue-400'
                }[notification.type];
                
                const bgClass = {
                    'success': 'bg-green-900 bg-opacity-30 border-green-700',
                    'error': 'bg-red-900 bg-opacity-30 border-red-700',
                    'warning': 'bg-yellow-900 bg-opacity-30 border-yellow-700',
                    'info': 'bg-blue-900 bg-opacity-30 border-blue-700'
                }[notification.type];
                
                return `
                    <div class="notification-item ${bgClass} border rounded-lg p-3 flex items-start space-x-3" data-id="${notification.id}">
                        <i class="${iconClass} mt-0.5"></i>
                        <div class="flex-1">
                            <p class="text-gray-100 text-sm">${notification.message}</p>
                            <p class="text-gray-400 text-xs mt-1">${notification.timestamp}</p>
                        </div>
                        <button onclick="removeNotification(${notification.id})" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function removeNotification(id) {
            notificationQueue = notificationQueue.filter(n => n.id !== id);
            displayNotifications();
        }

        function closeNotificationTablet() {
            notificationQueue = [];
            document.getElementById('notificationTablet').classList.add('hidden');
        }

        // Override alert function to use notification system
        const originalAlert = window.alert;
        window.alert = function(message) {
            if (message.includes('✅') || message.includes('successfully') || message.includes('Complete')) {
                showNotification(message.replace(/✅|❌|⚠️/g, '').trim(), 'success');
            } else if (message.includes('❌') || message.includes('Error') || message.includes('Failed')) {
                showNotification(message.replace(/✅|❌|⚠️/g, '').trim(), 'error');
            } else if (message.includes('⚠️') || message.includes('Warning') || message.includes('IMPORTANT')) {
                showNotification(message.replace(/✅|❌|⚠️/g, '').trim(), 'warning');
            } else {
                showNotification(message, 'info');
            }
        };

        // Override confirm function to use notification system
        const originalConfirm = window.confirm;
        window.confirm = function(message) {
            const result = originalConfirm(message);
            if (result) {
                showNotification('Action confirmed', 'info', 2000);
            } else {
                showNotification('Action cancelled', 'warning', 2000);
            }
            return result;
        };

        // Browser Memory Storage System
        let autoSaveEnabled = true;
        
        function autoSaveData() {
            if (autoSaveEnabled) {
                const allData = {
                    products: products,
                    customers: customers,
                    invoices: invoices,
                    users: users,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('erpData', JSON.stringify(allData));
                updateBrowserStorageStatus();
            }
        }
        
        function manualSaveData() {
            const allData = {
                products: products,
                customers: customers,
                invoices: invoices,
                users: users,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('erpData', JSON.stringify(allData));
            updateBrowserStorageStatus();
            showNotification('Data saved to browser memory successfully!', 'success');
        }
        
        function loadDataFromBrowser() {
            const savedData = localStorage.getItem('erpData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    products.length = 0;
                    products.push(...(data.products || []));
                    customers.length = 0;
                    customers.push(...(data.customers || []));
                    invoices.length = 0;
                    invoices.push(...(data.invoices || []));
                    users.length = 0;
                    users.push(...(data.users || []));
                    
                    loadProducts();
                    loadCustomers();
                    loadInvoices();
                    loadUsers();
                    updateDashboardMetrics();
                    
                    showNotification('Data loaded from browser memory successfully!', 'success');
                } catch (error) {
                    showNotification('Error loading data from browser memory', 'error');
                }
            } else {
                showNotification('No saved data found in browser memory', 'warning');
            }
        }
        
        function clearBrowserMemory() {
            if (confirm('Are you sure you want to clear all data from browser memory? This action cannot be undone.')) {
                localStorage.removeItem('erpData');
                updateBrowserStorageStatus();
                showNotification('Browser memory cleared successfully!', 'success');
            }
        }
        
        function toggleAutoSave() {
            autoSaveEnabled = !autoSaveEnabled;
            localStorage.setItem('autoSaveEnabled', autoSaveEnabled.toString());
            updateBrowserStorageStatus();
            showNotification(`Auto-save ${autoSaveEnabled ? 'enabled' : 'disabled'}`, 'info');
        }
        
        function updateBrowserStorageStatus() {
            const savedData = localStorage.getItem('erpData');
            const statusElement = document.getElementById('browserStorageStatus');
            
            if (statusElement) {
                if (savedData) {
                    const data = JSON.parse(savedData);
                    const lastSaved = data.lastSaved ? new Date(data.lastSaved).toLocaleString() : 'Unknown';
                    const dataSize = (JSON.stringify(savedData).length / 1024).toFixed(2);
                    
                    statusElement.innerHTML = `
                        <div class="text-sm text-gray-300">
                            <div class="flex justify-between items-center mb-2">
                                <span>Storage Status:</span>
                                <span class="text-green-400">Active</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span>Data Size:</span>
                                <span>${dataSize} KB</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span>Last Saved:</span>
                                <span class="text-xs">${lastSaved}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Auto-Save:</span>
                                <span class="${autoSaveEnabled ? 'text-green-400' : 'text-red-400'}">${autoSaveEnabled ? 'ON' : 'OFF'}</span>
                            </div>
                        </div>
                    `;
                } else {
                    statusElement.innerHTML = `
                        <div class="text-sm text-gray-400">
                            <div class="text-center">
                                <i class="fas fa-database text-2xl mb-2"></i>
                                <p>No data saved yet</p>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        function updateCloudSyncStatus() {
            const statusElement = document.getElementById('cloudSyncStatus');
            if (statusElement) {
                const lastExport = localStorage.getItem('lastCloudExport');
                if (lastExport) {
                    const exportDate = new Date(lastExport).toLocaleString();
                    statusElement.innerHTML = `
                        <div class="text-sm text-gray-300">
                            <div class="flex justify-between items-center mb-2">
                                <span>Last Export:</span>
                                <span class="text-blue-400">${exportDate}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>Status:</span>
                                <span class="text-green-400">Ready</span>
                            </div>
                        </div>
                    `;
                } else {
                    statusElement.innerHTML = `
                        <div class="text-sm text-gray-400">
                            <div class="text-center">
                                <i class="fas fa-cloud text-2xl mb-2"></i>
                                <p>No cloud sync yet</p>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // Initialize dashboard on load
        showPage('dashboard');
        
        // Initialize storage settings
        const savedAutoSave = localStorage.getItem('autoSaveEnabled');
        if (savedAutoSave !== null) {
            autoSaveEnabled = savedAutoSave === 'true';
        }
        
        // Load existing data from browser memory if available
        const existingData = localStorage.getItem('erpData');
        if (existingData) {
            try {
                const data = JSON.parse(existingData);
                if (data.products) products.push(...data.products);
                if (data.customers) customers.push(...data.customers);
                if (data.invoices) invoices.push(...data.invoices);
                if (data.users && data.users.length > 0) {
                    users.length = 0;
                    users.push(...data.users);
                }
            } catch (error) {
                console.log('Error loading saved data:', error);
            }
        }
        
        // Update dashboard when page loads
        setTimeout(() => {
            updateDashboardMetrics();
            updateBrowserStorageStatus();
            updateCloudSyncStatus();
            showNotification('Welcome to MS/ KAMAL & SON\'S ERP System! System is ready to use.', 'success');
        }, 100);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964ca9efa77d4e9f',t:'MTc1MzQ1NzA2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
